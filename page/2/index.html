<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 4.2.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"yoursite.com","root":"/","scheme":"Pisces","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="擅长C&#x2F;Go编程;https:&#x2F;&#x2F;github.com&#x2F;perrynzhou。">
<meta property="og:type" content="website">
<meta property="og:title" content="perrynzhou">
<meta property="og:url" content="http://yoursite.com/page/2/index.html">
<meta property="og:site_name" content="perrynzhou">
<meta property="og:description" content="擅长C&#x2F;Go编程;https:&#x2F;&#x2F;github.com&#x2F;perrynzhou。">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="perrynzhou">
<meta property="article:tag" content="C">
<meta property="article:tag" content=" Go">
<meta property="article:tag" content=" nginx">
<meta property="article:tag" content="glusterfs">
<meta property="article:tag" content="redis">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://yoursite.com/page/2/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'zh-CN'
  };
</script>

  <title>perrynzhou</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">perrynzhou</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">专注于系统组件研发</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/06/27/%E8%BF%9B%E7%A8%8B%E9%97%B4%E5%AE%9E%E6%97%B6%E9%80%9A%E4%BF%A1%E6%A8%A1%E5%9D%97%E8%AE%BE%E8%AE%A1%E5%92%8C%E5%AE%9E%E7%8E%B0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="perrynzhou">
      <meta itemprop="description" content="擅长C/Go编程;https://github.com/perrynzhou。">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="perrynzhou">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/06/27/%E8%BF%9B%E7%A8%8B%E9%97%B4%E5%AE%9E%E6%97%B6%E9%80%9A%E4%BF%A1%E6%A8%A1%E5%9D%97%E8%AE%BE%E8%AE%A1%E5%92%8C%E5%AE%9E%E7%8E%B0/" class="post-title-link" itemprop="url">进程间实时通信模块设计和实现</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2020-06-27 10:31:22 / 修改时间：10:48:11" itemprop="dateCreated datePublished" datetime="2020-06-27T10:31:22+08:00">2020-06-27</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="进程间实时通信模块设计和实现"><a href="#进程间实时通信模块设计和实现" class="headerlink" title="进程间实时通信模块设计和实现"></a>进程间实时通信模块设计和实现</h2><h3 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h3><ul>
<li>基于设备文件作为数据传输介质，一切皆文件</li>
<li>设备文件必须可以读可以写</li>
<li>通过linux kernel的file_operations来实现设备的读写</li>
</ul>
<h3 id="原理"><a href="#原理" class="headerlink" title="原理"></a>原理</h3><p><img src="/2020/06/27/%E8%BF%9B%E7%A8%8B%E9%97%B4%E5%AE%9E%E6%97%B6%E9%80%9A%E4%BF%A1%E6%A8%A1%E5%9D%97%E8%AE%BE%E8%AE%A1%E5%92%8C%E5%AE%9E%E7%8E%B0/%E8%BF%9B%E7%A8%8B%E9%97%B4%E5%AE%9E%E6%97%B6%E9%80%9A%E4%BF%A1.png" alt></p>
<ul>
<li>设计一个内核模块，客户端A写数据客户端B，客户端A到某个字符设备，然后通过设计的内核模块主动推送客户端B，这样就能达到进程间实时通信的效果.</li>
<li>设备文件也是文件，通过绑定内核的file_operations的函数实现设备的open/release/read/write/mmap等接口，客户端当open/read/write时候会对应调用内核模块的open/read/write函数</li>
</ul>
<h3 id="实现"><a href="#实现" class="headerlink" title="实现"></a>实现</h3><ul>
<li>进程A写数据</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">echo &quot;aaaa&quot; &gt; &#x2F;dev&#x2F;memchan</span><br></pre></td></tr></table></figure>
<ul>
<li>进程B接收数据</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;*************************************************************************</span><br><span class="line">  &gt; File Name: mem_channel_reader.c</span><br><span class="line">  &gt; Author:perrynzhou </span><br><span class="line">  &gt; Mail:perrynzhou@gmail.com </span><br><span class="line">  &gt; Created Time: Fri 26 Jun 2020 01:35:15 PM CST</span><br><span class="line"> ************************************************************************&#x2F;</span><br><span class="line"></span><br><span class="line">#include &lt;stdio.h&gt;</span><br><span class="line">#include &lt;stdio.h&gt;</span><br><span class="line">#include &lt;stdlib.h&gt;</span><br><span class="line">#include &lt;string.h&gt;</span><br><span class="line">#include &lt;errno.h&gt;</span><br><span class="line">#include &lt;sys&#x2F;types.h&gt;</span><br><span class="line">#include &lt;sys&#x2F;stat.h&gt;</span><br><span class="line">#include &lt;fcntl.h&gt;</span><br><span class="line">#include &lt;unistd.h&gt;</span><br><span class="line">#include &lt;sys&#x2F;mman.h&gt;</span><br><span class="line"></span><br><span class="line">#define BUFFER_LENGTH 128</span><br><span class="line">static const char *device_name &#x3D; &quot;&#x2F;dev&#x2F;memchan&quot;;</span><br><span class="line">int main(void)</span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">  int fd &#x3D; open(device_name, O_RDWR);</span><br><span class="line">  if (fd &lt; 0)</span><br><span class="line">  &#123;</span><br><span class="line">    fprintf(stdout, &quot;%s,err:%s\n&quot;, device_name, strerror(errno));</span><br><span class="line">    return -1;</span><br><span class="line">  &#125;</span><br><span class="line">  char *buffer &#x3D; (char *)malloc(BUFFER_LENGTH);</span><br><span class="line">  memset(buffer, 0, BUFFER_LENGTH);</span><br><span class="line"></span><br><span class="line">  char *start &#x3D; mmap(NULL, BUFFER_LENGTH, PROT_READ | PROT_WRITE, MAP_SHARED, fd, 0);</span><br><span class="line"></span><br><span class="line">  fd_set rds;</span><br><span class="line"></span><br><span class="line">  FD_ZERO(&amp;rds);</span><br><span class="line">  FD_SET(fd, &amp;rds);</span><br><span class="line"></span><br><span class="line">  while (1)</span><br><span class="line">  &#123;</span><br><span class="line">    int ret &#x3D; select(fd + 1, &amp;rds, NULL, NULL, NULL);</span><br><span class="line">    if (ret &lt; 0)</span><br><span class="line">    &#123;</span><br><span class="line">      printf(&quot;select error\n&quot;);</span><br><span class="line">      exit(1);</span><br><span class="line">    &#125;</span><br><span class="line">    if (FD_ISSET(fd, &amp;rds))</span><br><span class="line">    &#123;</span><br><span class="line">#if 0</span><br><span class="line">			strcpy(buffer, start);</span><br><span class="line">			printf(&quot;ntychannel: %s\n&quot;, buffer);</span><br><span class="line">#else</span><br><span class="line">      read(fd, buffer, BUFFER_LENGTH);</span><br><span class="line">      printf(&quot;channel: %s\n&quot;, buffer);</span><br><span class="line">#endif</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  munmap(start, BUFFER_LENGTH);</span><br><span class="line">  free(buffer);</span><br><span class="line">  close(fd);</span><br><span class="line"></span><br><span class="line">  return 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>内核模块</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;*************************************************************************</span><br><span class="line">  &gt; File Name: mem_channel.c</span><br><span class="line">  &gt; Author:perrynzhou </span><br><span class="line">  &gt; Mail:perrynzhou@gmail.com </span><br><span class="line">  &gt; Created Time: Fri 26 Jun 2020 12:59:42 PM CST</span><br><span class="line"> ************************************************************************&#x2F;</span><br><span class="line"></span><br><span class="line">#include &lt;linux&#x2F;module.h&gt;</span><br><span class="line">#include &lt;linux&#x2F;types.h&gt;</span><br><span class="line">#include &lt;linux&#x2F;fs.h&gt;</span><br><span class="line">#include &lt;linux&#x2F;errno.h&gt;</span><br><span class="line">#include &lt;linux&#x2F;mm.h&gt;</span><br><span class="line">#include &lt;linux&#x2F;sched.h&gt;</span><br><span class="line">#include &lt;linux&#x2F;init.h&gt;</span><br><span class="line">#include &lt;linux&#x2F;cdev.h&gt;</span><br><span class="line">#include &lt;asm&#x2F;io.h&gt;</span><br><span class="line">#include &lt;asm&#x2F;uaccess.h&gt;</span><br><span class="line">#include &lt;linux&#x2F;slab.h&gt;</span><br><span class="line">#include &lt;linux&#x2F;poll.h&gt;</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; first device id in kernel</span><br><span class="line">#ifndef MEM_CHANNEL_MAJOR</span><br><span class="line">#define MEM_CHANNEL_MAJOR 110</span><br><span class="line">#endif</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F;second device id in kernel</span><br><span class="line">#ifndef MEM_CHANNEL_MINOR</span><br><span class="line">#define MEM_CHANNEL_MINOR 2</span><br><span class="line">#endif</span><br><span class="line"></span><br><span class="line">#ifndef MEM_CHANNEL_DATA_LENGTH</span><br><span class="line">#define MEM_CHANNEL_DATA_LENGTH 4096</span><br><span class="line">#endif</span><br><span class="line"></span><br><span class="line">#define ENABLE_POLL 1</span><br><span class="line">#if ENABLE_POLL</span><br><span class="line">uint8_t is_have_data &#x3D; 0;</span><br><span class="line">#endif</span><br><span class="line">static const char *mem_channel_device &#x3D; &quot;memchan&quot;;</span><br><span class="line">static struct cdev mem_channel_dev;</span><br><span class="line">struct mem_channel</span><br><span class="line">&#123;</span><br><span class="line">  char *data;</span><br><span class="line">  size_t size;</span><br><span class="line">#if ENABLE_POLL</span><br><span class="line">  wait_queue_head_t queue;</span><br><span class="line">#endif</span><br><span class="line">&#125;;</span><br><span class="line">static struct mem_channel *chan;</span><br><span class="line">int mem_channel_open(struct inode *node, struct file *pfile)</span><br><span class="line">&#123;</span><br><span class="line">  struct mem_channel *mem &#x3D; NULL;</span><br><span class="line">  int num &#x3D; node-&gt;i_rdev;</span><br><span class="line">  if (num &gt; MEM_CHANNEL_MINOR || num &#x3D;&#x3D; 0)</span><br><span class="line">  &#123;</span><br><span class="line">    return -ENODEV;</span><br><span class="line">  &#125;</span><br><span class="line">  mem &#x3D; &amp;chan[num];</span><br><span class="line">  pfile-&gt;private_data &#x3D; mem;</span><br><span class="line">  printk(KERN_INFO &quot;mem_channel_open %d device success\n&quot;, num);</span><br><span class="line">  return 0;</span><br><span class="line">&#125;</span><br><span class="line">int mem_channel_release(struct inode *node, struct file *pfile)</span><br><span class="line">&#123;</span><br><span class="line">  return 0;</span><br><span class="line">&#125;</span><br><span class="line">ssize_t mem_channel_read(struct file *pfile, char __user *buffer, size_t size, loff_t *ppos)</span><br><span class="line">&#123;</span><br><span class="line">  int ret;</span><br><span class="line">  unsigned long p &#x3D; *ppos;</span><br><span class="line">  unsigned int count &#x3D; size;</span><br><span class="line">  struct mem_channel *mem &#x3D; pfile-&gt;private_data;</span><br><span class="line">  if (p &gt; MEM_CHANNEL_DATA_LENGTH)</span><br><span class="line">  &#123;</span><br><span class="line">    return 0;</span><br><span class="line">  &#125;</span><br><span class="line">  if (count &gt; (MEM_CHANNEL_DATA_LENGTH - p))</span><br><span class="line">  &#123;</span><br><span class="line">    count &#x3D; MEM_CHANNEL_DATA_LENGTH - p;</span><br><span class="line">  &#125;</span><br><span class="line">#if ENABLE_POLL</span><br><span class="line">  while (!is_have_data)</span><br><span class="line">  &#123;</span><br><span class="line">    if (pfile-&gt;f_flags &amp; O_NONBLOCK)</span><br><span class="line">    &#123;</span><br><span class="line">      return -EAGAIN;</span><br><span class="line">    &#125;</span><br><span class="line">    wait_event_interruptible(mem-&gt;queue, is_have_data);</span><br><span class="line">  &#125;</span><br><span class="line">#endif</span><br><span class="line">  if (copy_to_user(buffer, (void *)(mem-&gt;data + p), count))</span><br><span class="line">  &#123;</span><br><span class="line">    ret &#x3D; -EFAULT;</span><br><span class="line">  &#125;</span><br><span class="line">  else</span><br><span class="line">  &#123;</span><br><span class="line">    ret &#x3D; strlen(buffer);</span><br><span class="line">    mem-&gt;size -&#x3D; ret;</span><br><span class="line">  &#125;</span><br><span class="line">  printk(KERN_INFO &quot;read %d bytes from %ld\n&quot;, ret, p);</span><br><span class="line">  return ret;</span><br><span class="line">&#125;</span><br><span class="line">ssize_t mem_channel_write(struct file *pfile, const char __user *buffer, size_t size, loff_t *ppos)</span><br><span class="line">&#123;</span><br><span class="line">  int ret;</span><br><span class="line">  unsigned long p &#x3D; *ppos;</span><br><span class="line">  unsigned int count &#x3D; size;</span><br><span class="line">  struct mem_channel *mem &#x3D; (struct mem_channel *)pfile-&gt;private_data;</span><br><span class="line">  if (p &gt; MEM_CHANNEL_DATA_LENGTH)</span><br><span class="line">  &#123;</span><br><span class="line">    return 0;</span><br><span class="line">  &#125;</span><br><span class="line">  if (count &gt; (MEM_CHANNEL_DATA_LENGTH - p))</span><br><span class="line">  &#123;</span><br><span class="line">    count &#x3D; MEM_CHANNEL_DATA_LENGTH - p;</span><br><span class="line">  &#125;</span><br><span class="line">  if (copy_from_user((void *)(mem-&gt;data + p), buffer, count))</span><br><span class="line">  &#123;</span><br><span class="line">    ret &#x3D; -EFAULT;</span><br><span class="line">  &#125;</span><br><span class="line">  else</span><br><span class="line">  &#123;</span><br><span class="line">    *ppos +&#x3D; count;</span><br><span class="line">    ret &#x3D; count;</span><br><span class="line">    mem-&gt;size +&#x3D; count;</span><br><span class="line">    *(mem-&gt;data + p + count) &#x3D; &#39;\0&#39;;</span><br><span class="line">    printk(KERN_INFO &quot;write %d bytes from %ld\n&quot;, count, p);</span><br><span class="line">  &#125;</span><br><span class="line">#if ENABLE_POLL</span><br><span class="line">  is_have_data &#x3D; 1;</span><br><span class="line">  wake_up(&amp;mem-&gt;queue);</span><br><span class="line">#endif</span><br><span class="line">  return ret;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#if ENABLE_POLL</span><br><span class="line">unsigned int mem_channel_poll(struct file *pfile, struct poll_table_struct *wait)</span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">  struct mem_channel *mem &#x3D; pfile-&gt;private_data;</span><br><span class="line">  unsigned int mask &#x3D; 0;</span><br><span class="line"></span><br><span class="line">  poll_wait(pfile, &amp;mem-&gt;queue, wait);</span><br><span class="line"></span><br><span class="line">  if (is_have_data)</span><br><span class="line">  &#123;</span><br><span class="line">    mask |&#x3D; (POLLIN | POLLRDNORM);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  return mask;</span><br><span class="line">&#125;</span><br><span class="line">#endif</span><br><span class="line">int mem_channel_mmap(struct file *pfile, struct vm_area_struct *vma)</span><br><span class="line">&#123;</span><br><span class="line">  struct mem_channel *mem &#x3D; pfile-&gt;private_data;</span><br><span class="line"></span><br><span class="line">  vma-&gt;vm_flags |&#x3D; VM_IO;</span><br><span class="line">  vma-&gt;vm_flags |&#x3D; (VM_DONTEXPAND | VM_DONTDUMP);</span><br><span class="line"></span><br><span class="line">  if (remap_pfn_range(vma, vma-&gt;vm_start, virt_to_phys(mem-&gt;data) &gt;&gt; PAGE_SHIFT,</span><br><span class="line">                      vma-&gt;vm_end - vma-&gt;vm_start, vma-&gt;vm_page_prot))</span><br><span class="line">  &#123;</span><br><span class="line">    return -EAGAIN;</span><br><span class="line">  &#125;</span><br><span class="line">  return 0;</span><br><span class="line">&#125;</span><br><span class="line">static const struct file_operations fops &#x3D; &#123;</span><br><span class="line">    .owner &#x3D; THIS_MODULE,</span><br><span class="line">    .open &#x3D; mem_channel_open,</span><br><span class="line">    .release &#x3D; mem_channel_release,</span><br><span class="line">    .read &#x3D; mem_channel_read,</span><br><span class="line">    .write &#x3D; mem_channel_write,</span><br><span class="line">    .poll &#x3D; mem_channel_poll,</span><br><span class="line">    .mmap &#x3D; mem_channel_mmap,</span><br><span class="line">&#125;;</span><br><span class="line">&#x2F;&#x2F;when execute insmod xx.ko,mem_channel_init will be called</span><br><span class="line">static int mem_channel_init(void)</span><br><span class="line">&#123;</span><br><span class="line">  int result;</span><br><span class="line">  int i &#x3D; 0;</span><br><span class="line">  &#x2F;&#x2F;init first device no</span><br><span class="line">  dev_t devno &#x3D; MKDEV(MEM_CHANNEL_MAJOR, 0);</span><br><span class="line">  &#x2F;&#x2F;init minor device array for first device</span><br><span class="line">  result &#x3D; register_chrdev_region(devno, MEM_CHANNEL_MINOR, mem_channel_device);</span><br><span class="line">  if (result !&#x3D; 0)</span><br><span class="line">  &#123;</span><br><span class="line">    return result;</span><br><span class="line">  &#125;</span><br><span class="line">  cdev_init(&amp;mem_channel_dev, &amp;fops);</span><br><span class="line">  mem_channel_dev.owner &#x3D; THIS_MODULE;</span><br><span class="line">  &#x2F;&#x2F;add device to kernel device list,that save data</span><br><span class="line">  cdev_add(&amp;mem_channel_dev, devno, MEM_CHANNEL_MINOR);</span><br><span class="line">  chan &#x3D; kmalloc(MEM_CHANNEL_MINOR * sizeof(struct mem_channel), GFP_KERNEL);</span><br><span class="line">  if (chan &#x3D;&#x3D; NULL)</span><br><span class="line">  &#123;</span><br><span class="line">    result &#x3D; -ENOMEM;</span><br><span class="line">    goto failed;</span><br><span class="line">  &#125;</span><br><span class="line">  memset(chan, 0, sizeof(struct mem_channel) * MEM_CHANNEL_MINOR);</span><br><span class="line">  for (; i &lt; MEM_CHANNEL_MINOR; i++)</span><br><span class="line">  &#123;</span><br><span class="line">    chan[i].size &#x3D; MEM_CHANNEL_DATA_LENGTH;</span><br><span class="line">    chan[i].data &#x3D; kmalloc(MEM_CHANNEL_DATA_LENGTH * sizeof(char), GFP_KERNEL);</span><br><span class="line">    if (chan[i].data &#x3D;&#x3D; NULL)</span><br><span class="line">    &#123;</span><br><span class="line">      goto failed;</span><br><span class="line">    &#125;</span><br><span class="line">    memset(chan[i].data, 0, MEM_CHANNEL_DATA_LENGTH);</span><br><span class="line">  &#125;</span><br><span class="line">  printk(KERN_INFO &quot;mem_channel init success\n&quot;);</span><br><span class="line">  return 0;</span><br><span class="line">failed:</span><br><span class="line">  unregister_chrdev_region(devno, MEM_CHANNEL_MINOR);</span><br><span class="line">  for (i &#x3D; 0; i &lt; MEM_CHANNEL_MINOR; i++)</span><br><span class="line">  &#123;</span><br><span class="line">    if (chan[i].data !&#x3D; NULL)</span><br><span class="line">    &#123;</span><br><span class="line">      kfree(chan[i].data);</span><br><span class="line">      chan[i].data &#x3D; NULL;</span><br><span class="line">    &#125;</span><br><span class="line">    chan[i].size &#x3D; 0;</span><br><span class="line">  &#125;</span><br><span class="line">  if (chan !&#x3D; NULL)</span><br><span class="line">  &#123;</span><br><span class="line">    kfree(chan);</span><br><span class="line">    chan &#x3D; NULL;</span><br><span class="line">  &#125;</span><br><span class="line">  return result;</span><br><span class="line">&#125;</span><br><span class="line">&#x2F;&#x2F;when rmmod xx.ko,mem_channel_exit will be called</span><br><span class="line">static void mem_channel_exit(void)</span><br><span class="line">&#123;</span><br><span class="line">  int i;</span><br><span class="line">  cdev_del(&amp;mem_channel_dev);</span><br><span class="line">  for (i &#x3D; 0; i &lt; MEM_CHANNEL_MINOR; i++)</span><br><span class="line">  &#123;</span><br><span class="line"></span><br><span class="line">    kfree(chan[i].data);</span><br><span class="line">    chan[i].data &#x3D; NULL;</span><br><span class="line">    chan[i].size &#x3D; 0;</span><br><span class="line">  &#125;</span><br><span class="line">  if (chan !&#x3D; NULL)</span><br><span class="line">  &#123;</span><br><span class="line">    kfree(chan);</span><br><span class="line">    chan &#x3D; NULL;</span><br><span class="line">  &#125;</span><br><span class="line">  unregister_chrdev_region(MKDEV(MEM_CHANNEL_MAJOR, 0), MEM_CHANNEL_MINOR);</span><br><span class="line">  printk(KERN_INFO &quot;mem_channel_exit succes\n&quot;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">MODULE_AUTHOR(&quot;perrynzhou@gmail.com&quot;);</span><br><span class="line">MODULE_LICENSE(&quot;GPL&quot;);</span><br><span class="line"></span><br><span class="line">module_init(mem_channel_init);</span><br><span class="line">module_exit(mem_channel_exit);</span><br></pre></td></tr></table></figure>

<ul>
<li>Makefile</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">KERNEL_SRC &#x3D; &#x2F;usr&#x2F;src&#x2F;kernels&#x2F;3.10.0-1127.8.2.el7.x86_64</span><br><span class="line">obj-m :&#x3D; mem_channel.o</span><br><span class="line">module-objs :&#x3D; mem_channel.o</span><br><span class="line"></span><br><span class="line">all:</span><br><span class="line">	$(MAKE)    -C $(KERNEL_SRC)   M&#x3D;$(PWD) modules</span><br><span class="line">	gcc -g -std&#x3D;gnu99 mem_channel_reader.c -o mem_channel_reader</span><br><span class="line">clean:</span><br><span class="line">	rm *.ko *.o</span><br><span class="line">	rm -rf  mem_channel_reader</span><br><span class="line">	rm -rf .mem_channel*</span><br><span class="line">	rm -rf modules.order  Module.symvers</span><br></pre></td></tr></table></figure>




      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/06/25/start-kernel-plan/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="perrynzhou">
      <meta itemprop="description" content="擅长C/Go编程;https://github.com/perrynzhou。">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="perrynzhou">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/06/25/start-kernel-plan/" class="post-title-link" itemprop="url">start kernel plan</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2020-06-25 18:34:57 / 修改时间：19:39:29" itemprop="dateCreated datePublished" datetime="2020-06-25T18:34:57+08:00">2020-06-25</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h3 id="Kernel-About-Linux"><a href="#Kernel-About-Linux" class="headerlink" title="Kernel About Linux"></a>Kernel About Linux</h3><h4 id="Kernel-计划"><a href="#Kernel-计划" class="headerlink" title="Kernel 计划"></a>Kernel 计划</h4><p> <img src="/2020/06/25/start-kernel-plan/kernel-plan.png" alt></p>
<h4 id="Kernel-架构"><a href="#Kernel-架构" class="headerlink" title="Kernel 架构"></a>Kernel 架构</h4><p> <img src="/2020/06/25/start-kernel-plan/kernel-01.png" alt></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/06/25/epoll%E4%B8%AD%E6%83%8A%E7%BE%A4%E6%95%88%E5%BA%94%E8%A7%A3%E5%86%B3%E6%96%B9%E6%B3%95/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="perrynzhou">
      <meta itemprop="description" content="擅长C/Go编程;https://github.com/perrynzhou。">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="perrynzhou">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/06/25/epoll%E4%B8%AD%E6%83%8A%E7%BE%A4%E6%95%88%E5%BA%94%E8%A7%A3%E5%86%B3%E6%96%B9%E6%B3%95/" class="post-title-link" itemprop="url">epoll中惊群效应解决方法</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2020-06-25 08:57:58 / 修改时间：09:06:36" itemprop="dateCreated datePublished" datetime="2020-06-25T08:57:58+08:00">2020-06-25</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="epoll中惊群效应解决方法"><a href="#epoll中惊群效应解决方法" class="headerlink" title="epoll中惊群效应解决方法"></a>epoll中惊群效应解决方法</h2><h3 id="epoll惊群效应复现"><a href="#epoll惊群效应复现" class="headerlink" title="epoll惊群效应复现"></a>epoll惊群效应复现</h3><ul>
<li><p>创建5个进程，父进程负责fork所有的子进程，然后等待子进程退出，每个子进程监听监听同一个端口，接受来自客户单请求</p>
<p><img src="/2020/06/25/epoll%E4%B8%AD%E6%83%8A%E7%BE%A4%E6%95%88%E5%BA%94%E8%A7%A3%E5%86%B3%E6%96%B9%E6%B3%95/%E7%88%B6%E8%BF%9B%E7%A8%8B%E5%90%AF%E5%8A%A8.png" alt></p>
</li>
<li><p>客户端连接服务端的同一个端口，服务端只有一个子进程响应该请求</p>
<p><img src="/2020/06/25/epoll%E4%B8%AD%E6%83%8A%E7%BE%A4%E6%95%88%E5%BA%94%E8%A7%A3%E5%86%B3%E6%96%B9%E6%B3%95/%E5%AE%A2%E6%88%B7%E7%AB%AF%E8%AF%B7%E6%B1%82.png" alt></p>
</li>
<li><p>strace每个子进程的系统调用，可以发现客户端的请求仅仅只有一个子进程响应，其他的子进程都做了无效的系统调用，这种现象叫做惊群效应，假设在10W个并发链接的情况下，这种无效的系统调用非常影响请求处理的吞吐量和处理性能。子进程10012、10014、10015，出现了“accept(3, 0x7fff66a88dc0, [16])         = -1 EAGAIN (Resource temporarily unavailable)”，接受客户端请求失败，仅仅是10013接受客户端请求成功，并且处理了客户端请求。<br><img src="/2020/06/25/epoll%E4%B8%AD%E6%83%8A%E7%BE%A4%E6%95%88%E5%BA%94%E8%A7%A3%E5%86%B3%E6%96%B9%E6%B3%95/strace-1.png" alt></p>
<p><img src="/2020/06/25/epoll%E4%B8%AD%E6%83%8A%E7%BE%A4%E6%95%88%E5%BA%94%E8%A7%A3%E5%86%B3%E6%96%B9%E6%B3%95/strace-2.png" alt></p>
<p><img src="/2020/06/25/epoll%E4%B8%AD%E6%83%8A%E7%BE%A4%E6%95%88%E5%BA%94%E8%A7%A3%E5%86%B3%E6%96%B9%E6%B3%95/strace-3.png" alt></p>
<p><img src="/2020/06/25/epoll%E4%B8%AD%E6%83%8A%E7%BE%A4%E6%95%88%E5%BA%94%E8%A7%A3%E5%86%B3%E6%96%B9%E6%B3%95/strace-4.png" alt></p>
</li>
</ul>
<h3 id="解决方法"><a href="#解决方法" class="headerlink" title="解决方法"></a>解决方法</h3><ul>
<li><p>linux 内核中accept惊群问题：linux 内核accept之所以阻塞是因为条件等待，这种现象和线程池的惊群效应是一致的，2.6内核之前是通过广播方式通知,2.6内核之后采用了发送信号量，解决了accept的惊群问题。</p>
</li>
<li><p>epoll的惊群问题：</p>
<ul>
<li>互斥锁：在epoll_wait前后加互斥锁会导致线程或者进程挂起，在高并发的情况下，严重影响请求处理的图屯粮，这种性能损耗基本无法接受。</li>
<li>自旋锁: 在epoll_wait前后加spinlock，spinlock是独占的，虽然不会导致线程切换，但是会导致其他的监听进程或者线程饿死，这种情况也是无法接受的。</li>
<li>原子操作/CAS：惊群问题通用解决方法是通过原子操作，原子操作通过汇编实现。</li>
</ul>
</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/06/24/new-mallc-delete-free%E7%9A%84%E5%8C%BA%E5%88%AB/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="perrynzhou">
      <meta itemprop="description" content="擅长C/Go编程;https://github.com/perrynzhou。">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="perrynzhou">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/06/24/new-mallc-delete-free%E7%9A%84%E5%8C%BA%E5%88%AB/" class="post-title-link" itemprop="url">new/mallc/delete/free的区别</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2020-06-24 18:02:43 / 修改时间：18:06:09" itemprop="dateCreated datePublished" datetime="2020-06-24T18:02:43+08:00">2020-06-24</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p><strong>在使用C/C++开发使用，很多对于mallc和new、free和delete搞不清楚的，这里能简单说下区别</strong></p>
<ul>
<li>1.malloc和free是库函数;new和delete是C++的关键字</li>
<li>2.malloc是以字节来申请堆内存;new是以类型申请堆空间</li>
<li>3.malloc和free是单纯的申请内存和释放内存</li>
<li>4.new和delete分别负责申请内存调用calss的构造函数初始化和调用析构函数释放资源</li>
<li>5.new申请的内存使用free释放，是不会触发调用析构函数的，一般会造成资源泄露</li>
</ul>
<p><strong>代码示例</strong></p>
<ul>
<li>代码<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;new&gt;</span><br><span class="line">#include &lt;cstdlib&gt;</span><br><span class="line">#include &lt;iostream&gt;</span><br><span class="line">using namespace std;</span><br><span class="line">class T &#123;</span><br><span class="line">        public:</span><br><span class="line">                T()&#123;cout&lt;&lt;&quot;Call T()&quot;&lt;&lt;endl;iv &#x3D; 100;&#125;;</span><br><span class="line">                ~T()&#123;cout&lt;&lt;&quot;Call ~T()&quot;&lt;&lt;endl;&#125;</span><br><span class="line">                int GetIv()&#123;return iv;&#125;</span><br><span class="line">        private:</span><br><span class="line">                int iv;</span><br><span class="line">&#125;;</span><br><span class="line">void func()</span><br><span class="line">&#123;</span><br><span class="line">        int *t1 &#x3D; static_cast&lt;int *&gt;(malloc(sizeof(int)));</span><br><span class="line">        int *t2 &#x3D; new int(10);&#x2F;&#x2F;new 可以申请内存同时也可以赋值</span><br><span class="line">        *t1 &#x3D; 88;&#x2F;&#x2F;malloc则不行</span><br><span class="line">        cout &lt;&lt; &quot;begin :*t1&quot;&lt;&lt;*t1&lt;&lt;&quot;,*t2&#x3D;&quot;&lt;&lt;*t2&lt;&lt;endl;</span><br><span class="line">        free(t1);</span><br><span class="line">        delete t2;</span><br><span class="line">        cout &lt;&lt; &quot;end :t1&quot;&lt;&lt;t1&lt;&lt;&quot;,t2&#x3D;&quot;&lt;&lt;t2&lt;&lt;endl;</span><br><span class="line"> </span><br><span class="line">&#125;</span><br><span class="line">int main(void)</span><br><span class="line">&#123;</span><br><span class="line">        &#x2F;&#x2F;func();</span><br><span class="line">        T *t1 &#x3D; new T();&#x2F;&#x2F;她会调用构造函数，以类型申请堆空间</span><br><span class="line">        T *t2 &#x3D; static_cast&lt;T *&gt;(malloc(sizeof(T))); &#x2F;&#x2F;不会调用构造和析构函数，以字节申请堆空间</span><br><span class="line">        cout&lt;&lt;&quot;t1.iv &#x3D; &quot;&lt;&lt;t1-&gt;GetIv()&lt;&lt;endl;</span><br><span class="line">        </span><br><span class="line">        delete t2;&#x2F;&#x2F;触发析构函数，析构函数用于释放资源</span><br><span class="line">        cout&lt;&lt;&quot;t2.iv &#x3D; &quot;&lt;&lt;t2-&gt;GetIv()&lt;&lt;endl;</span><br><span class="line">	free(t1);&#x2F;&#x2F;如果new申请的空间，用free释放，析构函数是不会调用，会造成资源泄露 </span><br><span class="line">	return 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>运行</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">perryn@:&#x2F;data&#x2F;source&#x2F;Cpp&#x2F;demo:.&#x2F;a.out</span><br><span class="line">Call T()</span><br><span class="line">t1.iv &#x3D; 100</span><br><span class="line">t2.iv &#x3D; 0</span><br><span class="line">Call ~T()</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/06/24/nginx-%E7%AE%80%E5%8D%95%E4%BB%8B%E7%BB%8D/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="perrynzhou">
      <meta itemprop="description" content="擅长C/Go编程;https://github.com/perrynzhou。">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="perrynzhou">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/06/24/nginx-%E7%AE%80%E5%8D%95%E4%BB%8B%E7%BB%8D/" class="post-title-link" itemprop="url">nginx 简单介绍</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2020-06-24 11:08:14 / 修改时间：14:53:22" itemprop="dateCreated datePublished" datetime="2020-06-24T11:08:14+08:00">2020-06-24</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h3 id="nginx-简单介绍"><a href="#nginx-简单介绍" class="headerlink" title="nginx 简单介绍"></a>nginx 简单介绍</h3><h4 id="什么是nginx"><a href="#什么是nginx" class="headerlink" title="什么是nginx?"></a>什么是nginx?</h4><ul>
<li>nginx是用纯C开发的一套web服务器软件，运行于用户态度</li>
<li>nginx 是一款web服务器，类似的产品还有apache<h4 id="nginx-能做什么？"><a href="#nginx-能做什么？" class="headerlink" title="nginx 能做什么？"></a>nginx 能做什么？</h4></li>
</ul>
<p><img src="/2020/06/24/nginx-%E7%AE%80%E5%8D%95%E4%BB%8B%E7%BB%8D/%E6%AD%A3%E5%90%91-%E5%8F%8D%E5%90%91%E4%BB%A3%E7%90%86.png" alt></p>
<ul>
<li>反向代理：后端服务器被代理的过程叫反向代理过程，代理后端服务器的节点叫做反向代理节点。举个例子，现在我们业务搭建了4个节点的服务集群，这4个节点是对等的，业务的一次请求不会请求4个节点的IP来完成任务，对外提供的只有一个公网IP，公网IP是请求流量的入口，这个时候就需要另外一个节点来代理内网中的4个节点集群服务，用户请求流量都是通过这个公网IP的节点进入，用nginx来做方向代理，把请求流量转发到服务集群中。</li>
<li>正向代理: 客户端被代理的过程叫正向代理，比如我们使用企业的VPN，安装VPN后，浏览器请求google，这个时候可以使用nginx来代理你的客户端来请求google的服务。</li>
<li>负载均衡:在反向代理中，每个被代理服务器可以设置不同的权重，用户请求到反向代理服务节点上会根据权重，把请求下发到不同权重的后端服务器上。比如每个服务节点的配置不同，为了达到配置比较好的节点能处理更多流量，配置低的节点处理少量流量的目的，我们使用nginx来为每个被代理节点设置权重来达到负载均衡。</li>
</ul>
<h4 id="nginx-应用场景有哪些？"><a href="#nginx-应用场景有哪些？" class="headerlink" title="nginx 应用场景有哪些？"></a>nginx 应用场景有哪些？</h4><p><img src="/2020/06/24/nginx-%E7%AE%80%E5%8D%95%E4%BB%8B%E7%BB%8D/nginx%E5%9C%BA%E6%99%AF.png" alt></p>
<ul>
<li>静态资源:访问的资源和nginx部署的节点是在同一个服务器上。</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; 路径为:&#x2F;home&#x2F;perrynzhou&#x2F;images下面有2张png图片</span><br><span class="line">&#x2F;&#x2F;修改配置文件nginx.conf</span><br><span class="line">   server &#123;</span><br><span class="line">        listen       80;</span><br><span class="line">        server_name  localhost;</span><br><span class="line"></span><br><span class="line">        #charset koi8-r;</span><br><span class="line"></span><br><span class="line">        #access_log  logs&#x2F;host.access.log  main;</span><br><span class="line"></span><br><span class="line">        location &#x2F; &#123;</span><br><span class="line">            root   &#x2F;home&#x2F;perrynzhou&#x2F;images&#x2F;;</span><br><span class="line">            index  index.html index.htm;</span><br><span class="line">        &#125;</span><br><span class="line"> &#x2F;&#x2F; nginx -s reload</span><br><span class="line"> &#x2F;&#x2F; http:&#x2F;&#x2F;172.25.14.71&#x2F;2.png 即可访问图片</span><br></pre></td></tr></table></figure>
<ul>
<li>API服务：代理后端API服务，比如代理redis api服务</li>
<li>反向代理: 代理后端服务器</li>
<li>缓存加速：nginx能否缓存请求的资源</li>
<li>负载均衡: nginx按照权重设置代理服务或者节点的优先级，按照优先级转发请求的流量</li>
</ul>
<h4 id="nginx的同类产品分析"><a href="#nginx的同类产品分析" class="headerlink" title="nginx的同类产品分析"></a>nginx的同类产品分析</h4><p><img src="/2020/06/24/nginx-%E7%AE%80%E5%8D%95%E4%BB%8B%E7%BB%8D/%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1%E5%99%A8.png" alt></p>
<ul>
<li>F5：硬件F5负载均衡器工作在数据链路层，基于mac地址的负载均衡。</li>
<li>lvs: 软件层的负载均衡，工作在网络层(IP层)，基于IP地址的负载均衡。</li>
<li>haproxy:工作在传输层，基于tcp/ip的聚在均衡器</li>
<li>nginx:工作在应用层的HTTP协议，基于http的聚在负载均衡器。</li>
</ul>
<h4 id="nginx-进程结构"><a href="#nginx-进程结构" class="headerlink" title="nginx 进程结构"></a>nginx 进程结构</h4><p><img src="/2020/06/24/nginx-%E7%AE%80%E5%8D%95%E4%BB%8B%E7%BB%8D/nginx%E8%BF%9B%E7%A8%8B%E7%BB%93%E6%9E%84.jpg" alt></p>
<ul>
<li><p>nginx进程结构分为master和worker进程，master进程和worker进程是1对多的关系。</p>
</li>
<li><p>master进程：主要用来管理worker进程，接收来自外界的信号，向各个worker进程发送信号，监控worker进程的运行状态当worker进程退出后，会自动情动新的worker进程,master进程扮演用户和worker进程的交互接口角色，同时对进程进行监护，他不需要处理网络事件，不负责业务执行，只会通过worker进程来实现重启服务，平滑升级，更换日志文件，配置文件生效等功能</p>
</li>
<li><p>worker进程 ： worker进程相互之间隔离和对等的，具有相同的几率去处理请求，所有的worker进程都是从master进程fork出来的,所有worker进程的listenfd会在新连接到来时变得可读，为保证只有一个进程处理该连接，所有worker进程在注册listenfd读事件前抢accept_mutex，抢到互斥锁的那个进程注册listenfd读事件，在读事件里调用accept接受该连接。当一个worker进程在accept这个连接之后，就开始读取请求，解析请求，处理请求，产生数据后，再返回给客户端，最后才断开连接，这样一个完整的请求就是这样的了。一个请求，完全由worker进程来处理，而且只在一个worker进程中处理。</p>
</li>
</ul>
<h4 id="nginx的核心模块"><a href="#nginx的核心模块" class="headerlink" title="nginx的核心模块"></a>nginx的核心模块</h4><ul>
<li><p>nginx 采用的模块方式组装整个nginx的功能，在编译阶段会产生一个ngx_modules.c的文件，该文件中定义了所有nginx的处理模块,其中有一个ngx_modules的数组。</p>
</li>
<li><p>当一个请求同时符合多个模块的处理规则时候，按照ngx_modules数组中的顺序选择最靠前的模块优先处理。</p>
</li>
<li><p>针对http的过滤模块而言则是相反的，因为http框架在初始化时候，会在ngx_modules的数组中将过滤模块按先后顺序向filter list中添加，每次添加都是添加到表头，因此针对http模块，越是靠后的模块越是优先响应http.</p>
</li>
<li><p>ngx_modules.c  定义</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;ngx_config.h&gt;</span><br><span class="line">#include &lt;ngx_core.h&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">extern ngx_module_t  ngx_core_module;</span><br><span class="line">extern ngx_module_t  ngx_errlog_module;</span><br><span class="line">extern ngx_module_t  ngx_conf_module;</span><br><span class="line">extern ngx_module_t  ngx_regex_module;</span><br><span class="line">extern ngx_module_t  ngx_events_module;</span><br><span class="line">extern ngx_module_t  ngx_event_core_module;</span><br><span class="line">extern ngx_module_t  ngx_epoll_module;</span><br><span class="line">extern ngx_module_t  ngx_http_module;</span><br><span class="line">extern ngx_module_t  ngx_http_core_module;</span><br><span class="line">extern ngx_module_t  ngx_http_log_module;</span><br><span class="line">extern ngx_module_t  ngx_http_upstream_module;</span><br><span class="line">extern ngx_module_t  ngx_http_static_module;</span><br><span class="line">extern ngx_module_t  ngx_http_autoindex_module;</span><br><span class="line">extern ngx_module_t  ngx_http_index_module;</span><br><span class="line">extern ngx_module_t  ngx_http_mirror_module;</span><br><span class="line">extern ngx_module_t  ngx_http_try_files_module;</span><br><span class="line">extern ngx_module_t  ngx_http_auth_basic_module;</span><br><span class="line">extern ngx_module_t  ngx_http_access_module;</span><br><span class="line">extern ngx_module_t  ngx_http_limit_conn_module;</span><br><span class="line">extern ngx_module_t  ngx_http_limit_req_module;</span><br><span class="line">extern ngx_module_t  ngx_http_geo_module;</span><br><span class="line">extern ngx_module_t  ngx_http_map_module;</span><br><span class="line">extern ngx_module_t  ngx_http_split_clients_module;</span><br><span class="line">extern ngx_module_t  ngx_http_referer_module;</span><br><span class="line">extern ngx_module_t  ngx_http_rewrite_module;</span><br><span class="line">extern ngx_module_t  ngx_http_proxy_module;</span><br><span class="line">extern ngx_module_t  ngx_http_fastcgi_module;</span><br><span class="line">extern ngx_module_t  ngx_http_uwsgi_module;</span><br><span class="line">extern ngx_module_t  ngx_http_scgi_module;</span><br><span class="line">extern ngx_module_t  ngx_http_memcached_module;</span><br><span class="line">extern ngx_module_t  ngx_http_empty_gif_module;</span><br><span class="line">extern ngx_module_t  ngx_http_browser_module;</span><br><span class="line">extern ngx_module_t  ngx_http_upstream_hash_module;</span><br><span class="line">extern ngx_module_t  ngx_http_upstream_ip_hash_module;</span><br><span class="line">extern ngx_module_t  ngx_http_upstream_least_conn_module;</span><br><span class="line">extern ngx_module_t  ngx_http_upstream_random_module;</span><br><span class="line">extern ngx_module_t  ngx_http_upstream_keepalive_module;</span><br><span class="line">extern ngx_module_t  ngx_http_upstream_zone_module;</span><br><span class="line">extern ngx_module_t  ngx_http_write_filter_module;</span><br><span class="line">extern ngx_module_t  ngx_http_header_filter_module;</span><br><span class="line">extern ngx_module_t  ngx_http_chunked_filter_module;</span><br><span class="line">extern ngx_module_t  ngx_http_range_header_filter_module;</span><br><span class="line">extern ngx_module_t  ngx_http_gzip_filter_module;</span><br><span class="line">extern ngx_module_t  ngx_http_postpone_filter_module;</span><br><span class="line">extern ngx_module_t  ngx_http_ssi_filter_module;</span><br><span class="line">extern ngx_module_t  ngx_http_charset_filter_module;</span><br><span class="line">extern ngx_module_t  ngx_http_userid_filter_module;</span><br><span class="line">extern ngx_module_t  ngx_http_headers_filter_module;</span><br><span class="line">extern ngx_module_t  ngx_http_copy_filter_module;</span><br><span class="line">extern ngx_module_t  ngx_http_range_body_filter_module;</span><br><span class="line">extern ngx_module_t  ngx_http_not_modified_filter_module;</span><br><span class="line"></span><br><span class="line">ngx_module_t *ngx_modules[] &#x3D; &#123;</span><br><span class="line">    &amp;ngx_core_module,</span><br><span class="line">    &amp;ngx_errlog_module,</span><br><span class="line">    &amp;ngx_conf_module,</span><br><span class="line">    &amp;ngx_regex_module,</span><br><span class="line">    &amp;ngx_events_module,</span><br><span class="line">    &amp;ngx_event_core_module,</span><br><span class="line">    &amp;ngx_epoll_module,</span><br><span class="line">    &amp;ngx_http_module,</span><br><span class="line">    &amp;ngx_http_core_module,</span><br><span class="line">    &amp;ngx_http_log_module,</span><br><span class="line">    &amp;ngx_http_upstream_module,</span><br><span class="line">    &amp;ngx_http_static_module,</span><br><span class="line">    &amp;ngx_http_autoindex_module,</span><br><span class="line">    &amp;ngx_http_index_module,</span><br><span class="line">    &amp;ngx_http_mirror_module,</span><br><span class="line">    &amp;ngx_http_try_files_module,</span><br><span class="line">    &amp;ngx_http_auth_basic_module,</span><br><span class="line">    &amp;ngx_http_access_module,</span><br><span class="line">    &amp;ngx_http_limit_conn_module,</span><br><span class="line">    &amp;ngx_http_limit_req_module,</span><br><span class="line">    &amp;ngx_http_geo_module,</span><br><span class="line">    &amp;ngx_http_map_module,</span><br><span class="line">    &amp;ngx_http_split_clients_module,</span><br><span class="line">    &amp;ngx_http_referer_module,</span><br><span class="line">    &amp;ngx_http_rewrite_module,</span><br><span class="line">    &amp;ngx_http_proxy_module,</span><br><span class="line">    &amp;ngx_http_fastcgi_module,</span><br><span class="line">    &amp;ngx_http_uwsgi_module,</span><br><span class="line">    &amp;ngx_http_scgi_module,</span><br><span class="line">    &amp;ngx_http_memcached_module,</span><br><span class="line">    &amp;ngx_http_empty_gif_module,</span><br><span class="line">    &amp;ngx_http_browser_module,</span><br><span class="line">    &amp;ngx_http_upstream_hash_module,</span><br><span class="line">    &amp;ngx_http_upstream_ip_hash_module,</span><br><span class="line">    &amp;ngx_http_upstream_least_conn_module,</span><br><span class="line">    &amp;ngx_http_upstream_random_module,</span><br><span class="line">    &amp;ngx_http_upstream_keepalive_module,</span><br><span class="line">    &amp;ngx_http_upstream_zone_module,</span><br><span class="line">    &amp;ngx_http_write_filter_module,</span><br><span class="line">    &amp;ngx_http_header_filter_module,</span><br><span class="line">    &amp;ngx_http_chunked_filter_module,</span><br><span class="line">    &amp;ngx_http_range_header_filter_module,</span><br><span class="line">    &amp;ngx_http_gzip_filter_module,</span><br><span class="line">    &amp;ngx_http_postpone_filter_module,</span><br><span class="line">    &amp;ngx_http_ssi_filter_module,</span><br><span class="line">    &amp;ngx_http_charset_filter_module,</span><br><span class="line">    &amp;ngx_http_userid_filter_module,</span><br><span class="line">    &amp;ngx_http_headers_filter_module,</span><br><span class="line">    &amp;ngx_http_copy_filter_module,</span><br><span class="line">    &amp;ngx_http_range_body_filter_module,</span><br><span class="line">    &amp;ngx_http_not_modified_filter_module,</span><br><span class="line">    NULL</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">char *ngx_module_names[] &#x3D; &#123;</span><br><span class="line">    &quot;ngx_core_module&quot;,</span><br><span class="line">    &quot;ngx_errlog_module&quot;,</span><br><span class="line">    &quot;ngx_conf_module&quot;,</span><br><span class="line">    &quot;ngx_regex_module&quot;,</span><br><span class="line">    &quot;ngx_events_module&quot;,</span><br><span class="line">    &quot;ngx_event_core_module&quot;,</span><br><span class="line">    &quot;ngx_epoll_module&quot;,</span><br><span class="line">    &quot;ngx_http_module&quot;,</span><br><span class="line">    &quot;ngx_http_core_module&quot;,</span><br><span class="line">    &quot;ngx_http_log_module&quot;,</span><br><span class="line">    &quot;ngx_http_upstream_module&quot;,</span><br><span class="line">    &quot;ngx_http_static_module&quot;,</span><br><span class="line">    &quot;ngx_http_autoindex_module&quot;,</span><br><span class="line">    &quot;ngx_http_index_module&quot;,</span><br><span class="line">    &quot;ngx_http_mirror_module&quot;,</span><br><span class="line">    &quot;ngx_http_try_files_module&quot;,</span><br><span class="line">    &quot;ngx_http_auth_basic_module&quot;,</span><br><span class="line">    &quot;ngx_http_access_module&quot;,</span><br><span class="line">    &quot;ngx_http_limit_conn_module&quot;,</span><br><span class="line">    &quot;ngx_http_limit_req_module&quot;,</span><br><span class="line">    &quot;ngx_http_geo_module&quot;,</span><br><span class="line">    &quot;ngx_http_map_module&quot;,</span><br><span class="line">    &quot;ngx_http_split_clients_module&quot;,</span><br><span class="line">    &quot;ngx_http_referer_module&quot;,</span><br><span class="line">    &quot;ngx_http_rewrite_module&quot;,</span><br><span class="line">    &quot;ngx_http_proxy_module&quot;,</span><br><span class="line">    &quot;ngx_http_fastcgi_module&quot;,</span><br><span class="line">    &quot;ngx_http_uwsgi_module&quot;,</span><br><span class="line">    &quot;ngx_http_scgi_module&quot;,</span><br><span class="line">    &quot;ngx_http_memcached_module&quot;,</span><br><span class="line">    &quot;ngx_http_empty_gif_module&quot;,</span><br><span class="line">    &quot;ngx_http_browser_module&quot;,</span><br><span class="line">    &quot;ngx_http_upstream_hash_module&quot;,</span><br><span class="line">    &quot;ngx_http_upstream_ip_hash_module&quot;,</span><br><span class="line">    &quot;ngx_http_upstream_least_conn_module&quot;,</span><br><span class="line">    &quot;ngx_http_upstream_random_module&quot;,</span><br><span class="line">    &quot;ngx_http_upstream_keepalive_module&quot;,</span><br><span class="line">    &quot;ngx_http_upstream_zone_module&quot;,</span><br><span class="line">    &quot;ngx_http_write_filter_module&quot;,</span><br><span class="line">    &quot;ngx_http_header_filter_module&quot;,</span><br><span class="line">    &quot;ngx_http_chunked_filter_module&quot;,</span><br><span class="line">    &quot;ngx_http_range_header_filter_module&quot;,</span><br><span class="line">    &quot;ngx_http_gzip_filter_module&quot;,</span><br><span class="line">    &quot;ngx_http_postpone_filter_module&quot;,</span><br><span class="line">    &quot;ngx_http_ssi_filter_module&quot;,</span><br><span class="line">    &quot;ngx_http_charset_filter_module&quot;,</span><br><span class="line">    &quot;ngx_http_userid_filter_module&quot;,</span><br><span class="line">    &quot;ngx_http_headers_filter_module&quot;,</span><br><span class="line">    &quot;ngx_http_copy_filter_module&quot;,</span><br><span class="line">    &quot;ngx_http_range_body_filter_module&quot;,</span><br><span class="line">    &quot;ngx_http_not_modified_filter_module&quot;,</span><br><span class="line">    NULL</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>



</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/06/23/epoll%E4%B8%AD%E7%9A%84%E6%83%8A%E7%BE%A4%E6%95%88%E5%BA%94/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="perrynzhou">
      <meta itemprop="description" content="擅长C/Go编程;https://github.com/perrynzhou。">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="perrynzhou">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/06/23/epoll%E4%B8%AD%E7%9A%84%E6%83%8A%E7%BE%A4%E6%95%88%E5%BA%94/" class="post-title-link" itemprop="url">epoll中的惊群效应</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2020-06-23 18:03:13 / 修改时间：18:17:15" itemprop="dateCreated datePublished" datetime="2020-06-23T18:03:13+08:00">2020-06-23</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h3 id="多进程-使用epoll-select-poll-监听同一个端口的惊群效应解决方案"><a href="#多进程-使用epoll-select-poll-监听同一个端口的惊群效应解决方案" class="headerlink" title="多进程(使用epoll/select/poll)监听同一个端口的惊群效应解决方案"></a>多进程(使用epoll/select/poll)监听同一个端口的惊群效应解决方案</h3><h4 id="1-什么是惊群效应"><a href="#1-什么是惊群效应" class="headerlink" title="1.什么是惊群效应?"></a>1.什么是惊群效应?</h4><p><img src="/2020/06/23/epoll%E4%B8%AD%E7%9A%84%E6%83%8A%E7%BE%A4%E6%95%88%E5%BA%94/1.png" alt></p>
<ul>
<li>多个进程(A、B、C、D的worker进程)使用epoll/poll/select等函数监听同一个端口时候，当有一个TCP请求连接到该端口时候，A、B、C、D进程会被同时唤醒，但是仅仅有一个进程会accept接受来自客户端的连接，其他的进程则会挂起。</li>
</ul>
<ul>
<li>举个例子，假设你去银行柜台取钱，银行有4个窗口，每个窗口的营业员都在等待客户来取钱，叫到某个号码时候(就该手持某个号码的人去柜台取钱),这个人就去柜台，在这个时候4个窗口营业员同时叫那个人去自己窗口办理，但是仅仅只会有一个窗口的营业员提供服务给你，但是这4个窗口的营业员会去“招呼”你去她哪里办理业务。4个窗口的营业员同时叫你自己的号码时候，只有一个窗口提供服务，这个效应就是惊群</li>
</ul>
<h4 id="2-如何产生惊群效应"><a href="#2-如何产生惊群效应" class="headerlink" title="2.如何产生惊群效应"></a>2.如何产生惊群效应</h4><ul>
<li>在早期的Linux版本中，内核对于阻塞在epoll_wait的进程，也是采用全部唤醒的机制，所以存在和accept相似的“惊群”问题。新版本的的解决方案也是只会唤醒等待队列上的第一个进程或线程，所以，新版本Linux 部分的解决了epoll的“惊群”问题。所谓部分的解决，意思就是：对于部分特殊场景，使用epoll机制，已经不存在“惊群”的问题了，但是对于大多数场景，epoll机制仍然存在“惊群”.</li>
<li>多个进程同时监听同一个端口时候，当有请求连接到该端口时候，多个进程会被同时唤醒，但是仅仅有一个进程会accept的请求，其他的进程则会挂起</li>
</ul>
<h4 id="3-惊群效应影响"><a href="#3-惊群效应影响" class="headerlink" title="3.惊群效应影响"></a>3.惊群效应影响</h4><ul>
<li>假设有10万tcp请求，后端有64个worker进程,这些进程的唤醒和挂起之间的切换开销非常大，会严重影响服务器的处理请求的吞吐量</li>
</ul>
<h4 id="4-如何解决惊群效应"><a href="#4-如何解决惊群效应" class="headerlink" title="4.如何解决惊群效应"></a>4.如何解决惊群效应</h4><ul>
<li>多进程方式下，在共享内存设置一个变量，在多个进程accept请求之前针对该变量加锁，哪个进程获取到锁，哪个进程就accept请求。</li>
</ul>
<h4 id="5-解决惊群效应解决思路"><a href="#5-解决惊群效应解决思路" class="headerlink" title="5.解决惊群效应解决思路"></a>5.解决惊群效应解决思路</h4><p><img src="/2020/06/23/epoll%E4%B8%AD%E7%9A%84%E6%83%8A%E7%BE%A4%E6%95%88%E5%BA%94/2.png" alt></p>
<ul>
<li>在epoll_wait返回，获取锁，如果获得锁就继续accept新的request;否则继续epoll_wait</li>
</ul>
<h4 id="6-惊群效应例子"><a href="#6-惊群效应例子" class="headerlink" title="6.惊群效应例子"></a>6.惊群效应例子</h4><ul>
<li>运行实例</li>
</ul>
<p><img src="/2020/06/23/epoll%E4%B8%AD%E7%9A%84%E6%83%8A%E7%BE%A4%E6%95%88%E5%BA%94/3.jpg" alt><br><img src="/2020/06/23/epoll%E4%B8%AD%E7%9A%84%E6%83%8A%E7%BE%A4%E6%95%88%E5%BA%94/4.jpg" alt></p>
<ul>
<li>代码<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;*************************************************************************</span><br><span class="line">  &gt; File Name: epoll_test.c</span><br><span class="line">  &gt; Author:perrynzhou </span><br><span class="line">  &gt; Mail:perrynzhou@gmail.com </span><br><span class="line">  &gt; Created Time: Tuesday, June 23, 2020 AM08:45:28 HKT</span><br><span class="line"> ************************************************************************&#x2F;</span><br><span class="line"></span><br><span class="line">#include &lt;stdio.h&gt;</span><br><span class="line">#include &lt;assert.h&gt;</span><br><span class="line">#include &lt;sys&#x2F;types.h&gt;</span><br><span class="line">#include &lt;sys&#x2F;socket.h&gt;</span><br><span class="line">#include &lt;sys&#x2F;epoll.h&gt;</span><br><span class="line">#include &lt;netdb.h&gt;</span><br><span class="line">#include &lt;string.h&gt;</span><br><span class="line">#include &lt;stdio.h&gt;</span><br><span class="line">#include &lt;unistd.h&gt;</span><br><span class="line">#include &lt;fcntl.h&gt;</span><br><span class="line">#include &lt;stdlib.h&gt;</span><br><span class="line">#include &lt;errno.h&gt;</span><br><span class="line">#include &lt;sys&#x2F;wait.h&gt;</span><br><span class="line">#include &lt;unistd.h&gt;</span><br><span class="line">#include &lt;netinet&#x2F;in.h&gt;</span><br><span class="line">#include &lt;arpa&#x2F;inet.h&gt;</span><br><span class="line"></span><br><span class="line">#define NET_SERVICE_BUFFER_LEN (1024)</span><br><span class="line"></span><br><span class="line">typedef struct net_service_t</span><br><span class="line">&#123;</span><br><span class="line">  int sfd;</span><br><span class="line">  int efd;</span><br><span class="line">  int worker_process_num;</span><br><span class="line">  struct epoll_event event;</span><br><span class="line">  struct epoll_event *events;</span><br><span class="line">&#125; net_service;</span><br><span class="line">inline static int net_service_accept_request(net_service *ns)</span><br><span class="line">&#123;</span><br><span class="line">  struct sockaddr client_addr;</span><br><span class="line">  socklen_t len &#x3D; sizeof(struct sockaddr);</span><br><span class="line">  return accept(ns-&gt;sfd, &amp;client_addr, &amp;len);</span><br><span class="line">&#125;</span><br><span class="line">inline static void net_service_fetch_client_addr(int newfd, char *buf, size_t sz)</span><br><span class="line">&#123;</span><br><span class="line">  struct sockaddr_in addr;</span><br><span class="line">  socklen_t addr_size &#x3D; sizeof(struct sockaddr_in);</span><br><span class="line">  int res &#x3D; getpeername(newfd, (struct sockaddr *)&amp;addr, &amp;addr_size);</span><br><span class="line">  strncpy(buf, inet_ntoa(addr.sin_addr), sz);</span><br><span class="line">&#125;</span><br><span class="line">void net_service_handle_request(net_service *ns, int k)</span><br><span class="line">&#123;</span><br><span class="line">  int max_event &#x3D; 1024;</span><br><span class="line">  int efd &#x3D; ns-&gt;efd;</span><br><span class="line">  int sfd &#x3D; ns-&gt;sfd;</span><br><span class="line">  struct epoll_event *events &#x3D; ns-&gt;events;</span><br><span class="line">  while (1)</span><br><span class="line">  &#123;</span><br><span class="line">    int n &#x3D; epoll_wait(efd, events, max_event, -1);</span><br><span class="line">    usleep(100);</span><br><span class="line">    for (int i &#x3D; 0; i &lt; n; i++)</span><br><span class="line">    &#123;</span><br><span class="line">      if (events[i].events &amp; EPOLLERR)</span><br><span class="line">      &#123;</span><br><span class="line">        fprintf(stdout, &quot;epoll error\n&quot;);</span><br><span class="line">        close(events[i].data.fd);</span><br><span class="line">        continue;</span><br><span class="line">      &#125;</span><br><span class="line">      else if (sfd &#x3D;&#x3D; events[i].data.fd)</span><br><span class="line">      &#123;</span><br><span class="line">        int client_fd &#x3D; net_service_accept_request(ns);</span><br><span class="line">        if (client_fd &#x3D;&#x3D; -1)</span><br><span class="line">        &#123;</span><br><span class="line">          fprintf(stdout, &quot;worker-%d-[%d] process return from  epoll_wait,accept failed\n&quot;, k, getpid());</span><br><span class="line">          break;</span><br><span class="line">        &#125;</span><br><span class="line">        char b[NET_SERVICE_BUFFER_LEN];</span><br><span class="line">        net_service_fetch_client_addr(client_fd, (char *)&amp;b, NET_SERVICE_BUFFER_LEN);</span><br><span class="line">        fprintf(stdout, &quot;worker-%d-[%d] process return from  epoll_wait,accept %s success\n&quot;, k, getpid(), (char *)&amp;b);</span><br><span class="line">        close(client_fd);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">static int net_service_create_and_bind(net_service *ns, const char *addr, int port)</span><br><span class="line">&#123;</span><br><span class="line">  int fd &#x3D; socket(PF_INET, SOCK_STREAM, 0);</span><br><span class="line">  struct sockaddr_in serveraddr;</span><br><span class="line">  serveraddr.sin_family &#x3D; AF_INET;</span><br><span class="line">  inet_pton(AF_INET, addr, &amp;serveraddr.sin_addr);</span><br><span class="line">  serveraddr.sin_port &#x3D; htons(port);</span><br><span class="line">  bind(fd, (struct sockaddr *)&amp;serveraddr, sizeof(serveraddr));</span><br><span class="line"></span><br><span class="line">  ns-&gt;sfd &#x3D; fd;</span><br><span class="line">  return 0;</span><br><span class="line">&#125;</span><br><span class="line">static int net_service_setsockopt(net_service *ns)</span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">  int flags, s;</span><br><span class="line">  flags &#x3D; fcntl(ns-&gt;sfd, F_GETFL, 0);</span><br><span class="line">  if (flags &#x3D;&#x3D; -1)</span><br><span class="line">  &#123;</span><br><span class="line">    perror(&quot;fcntl&quot;);</span><br><span class="line">    return -1;</span><br><span class="line">  &#125;</span><br><span class="line">  flags |&#x3D; O_NONBLOCK;</span><br><span class="line">  if (fcntl(ns-&gt;sfd, F_SETFL, flags) &#x3D;&#x3D; -1)</span><br><span class="line">  &#123;</span><br><span class="line">    perror(&quot;fcntl&quot;);</span><br><span class="line">    return -1;</span><br><span class="line">  &#125;</span><br><span class="line">  int reuse &#x3D; 0;</span><br><span class="line">  setsockopt(s, SOL_SOCKET, SO_REUSEADDR, (const char *)&amp;reuse, sizeof(int));</span><br><span class="line">  return 0;</span><br><span class="line">&#125;</span><br><span class="line">int net_service_init(net_service *ns, const char *addr, int port, int num)</span><br><span class="line">&#123;</span><br><span class="line">  int max_events &#x3D; 1024;</span><br><span class="line">  if (addr !&#x3D; NULL &amp;&amp; net_service_create_and_bind(ns, addr, port) !&#x3D; -1)</span><br><span class="line">  &#123;</span><br><span class="line">    net_service_setsockopt(ns);</span><br><span class="line">    listen(ns-&gt;sfd, 1024);</span><br><span class="line">    ns-&gt;efd &#x3D; epoll_create(max_events);</span><br><span class="line">    ns-&gt;event.data.fd &#x3D; ns-&gt;sfd;</span><br><span class="line">    ns-&gt;event.events &#x3D; EPOLLIN;</span><br><span class="line">    epoll_ctl(ns-&gt;efd, EPOLL_CTL_ADD, ns-&gt;sfd, &amp;ns-&gt;event);</span><br><span class="line">    ns-&gt;events &#x3D; calloc(max_events, sizeof(struct epoll_event));</span><br><span class="line">    assert(ns-&gt;events !&#x3D; NULL);</span><br><span class="line">    ns-&gt;worker_process_num &#x3D; num;</span><br><span class="line">  &#125;</span><br><span class="line">  return -1;</span><br><span class="line">&#125;</span><br><span class="line">int net_service_run(net_service *ns)</span><br><span class="line">&#123;</span><br><span class="line">  pid_t pid &#x3D; 0;</span><br><span class="line">  for (int i &#x3D; 0; i &lt; ns-&gt;worker_process_num; i++)</span><br><span class="line">  &#123;</span><br><span class="line">    fflush(NULL);</span><br><span class="line">    pid &#x3D; fork();</span><br><span class="line">    if (pid &#x3D;&#x3D; 0)</span><br><span class="line">    &#123;</span><br><span class="line">      fprintf(stdout, &quot;start worker-%d-%d\n&quot;, i, getpid());</span><br><span class="line">      net_service_handle_request(ns, i);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  while ((pid &#x3D; waitpid(-1, NULL, 0)))</span><br><span class="line">  &#123;</span><br><span class="line">    if (errno &#x3D;&#x3D; ECHILD)</span><br><span class="line">    &#123;</span><br><span class="line">      break;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">void net_service_deinit(net_service *ns)</span><br><span class="line">&#123;</span><br><span class="line">  if (ns !&#x3D; NULL)</span><br><span class="line">  &#123;</span><br><span class="line">    if (ns-&gt;efd !&#x3D; -1)</span><br><span class="line">    &#123;</span><br><span class="line">      close(ns-&gt;efd);</span><br><span class="line">    &#125;</span><br><span class="line">    if (ns-&gt;sfd !&#x3D; -1)</span><br><span class="line">    &#123;</span><br><span class="line">      close(ns-&gt;sfd);</span><br><span class="line">    &#125;</span><br><span class="line">    ns-&gt;sfd &#x3D; ns-&gt;efd &#x3D; -1;</span><br><span class="line">    if (ns-&gt;events !&#x3D; NULL)</span><br><span class="line">    &#123;</span><br><span class="line">      free(ns-&gt;events);</span><br><span class="line">      ns-&gt;events &#x3D; NULL;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">int main(void)</span><br><span class="line">&#123;</span><br><span class="line">  net_service net;</span><br><span class="line">  net_service_init(&amp;net, &quot;127.0.0.1&quot;, 9988, 4);</span><br><span class="line">  fprintf(stdout, &quot;run on %s:%d\n&quot;, &quot;127.0.0.1&quot;, 9988);</span><br><span class="line">  net_service_run(&amp;net);</span><br><span class="line">  net_service_deinit(&amp;net);</span><br><span class="line">  return 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/06/22/linux-%E9%94%81/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="perrynzhou">
      <meta itemprop="description" content="擅长C/Go编程;https://github.com/perrynzhou。">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="perrynzhou">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/06/22/linux-%E9%94%81/" class="post-title-link" itemprop="url"> linux 锁</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2020-06-22 19:14:43 / 修改时间：19:15:41" itemprop="dateCreated datePublished" datetime="2020-06-22T19:14:43+08:00">2020-06-22</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="linux-锁"><a href="#linux-锁" class="headerlink" title="linux 锁"></a>linux 锁</h2><h3 id="linux中有哪几种临界资源访问保护机制"><a href="#linux中有哪几种临界资源访问保护机制" class="headerlink" title="linux中有哪几种临界资源访问保护机制"></a>linux中有哪几种临界资源访问保护机制</h3><ul>
<li>互斥锁:核心以pthread_mutex_t为核心</li>
<li>自旋锁:核心以pthread_spinlock_t为核心</li>
<li>原子操作:自定义C函数封装汇编</li>
</ul>
<h3 id="各种临界资源保护机制的用法"><a href="#各种临界资源保护机制的用法" class="headerlink" title="各种临界资源保护机制的用法"></a>各种临界资源保护机制的用法</h3><ul>
<li>pthread_t :在多线程情况下,线程会切换，但是某个线程方法进入以pthread_mutex_t加锁的临界资源</li>
<li>pthread_spinlock_t:多线程情况下，不会产生线程切换，某个线程进入以pthread_spinlock_t加锁的临界资源时候，线程无法获取锁就会自旋等待，这个pthread_spinlock_t用在操作非常简单，等待时间非常短的情况下。</li>
<li>原子操作：在函数内部嵌入asm汇编，用一条汇编指令表达。</li>
</ul>
<h3 id="i-自增操"><a href="#i-自增操" class="headerlink" title="i++ 自增操"></a>i++ 自增操</h3><ul>
<li>i++ 操作：i++操作编译成汇编后，都是三条指令,线程执行任何一个汇编指令时候都可能发生线程切换，多线程情况下不能保证i++是原子操作<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1.move [var],%ebx</span><br><span class="line">2.incr %ebx</span><br><span class="line">3.move %ebx [var]</span><br></pre></td></tr></table></figure>
</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/06/20/tcp-ip-%E4%B8%89%E6%AC%A1%E6%8F%A1%E6%89%8B/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="perrynzhou">
      <meta itemprop="description" content="擅长C/Go编程;https://github.com/perrynzhou。">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="perrynzhou">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/06/20/tcp-ip-%E4%B8%89%E6%AC%A1%E6%8F%A1%E6%89%8B/" class="post-title-link" itemprop="url">tcp/ip 三次握手</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2020-06-20 16:29:28 / 修改时间：16:30:27" itemprop="dateCreated datePublished" datetime="2020-06-20T16:29:28+08:00">2020-06-20</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h4 id="tcp-ip-三次握手"><a href="#tcp-ip-三次握手" class="headerlink" title="tcp/ip 三次握手"></a>tcp/ip 三次握手</h4><p><img src="/2020/06/20/tcp-ip-%E4%B8%89%E6%AC%A1%E6%8F%A1%E6%89%8B/tcp-shandshark.png" alt="image-20200620161218149"></p>
<ul>
<li>tcp/ip和系统api有啥关系<ul>
<li>tcp/ip基于ip层来提供稳定的有连接的服务。tcp/ip编程中的socket是有几个元素组成，分别是:（文件描述符:源端IP、源端端口、目标端IP、目标端端口、协议）组成</li>
<li>tcp/ip中的发起第一次和服务端握手，体现在api中的connect是发起连接，第二次和第三次握手都是在网络协议栈中完成，其中服务端的api 中的accept完成了协议栈中从syn队列中取出握手信息到accept队列中。</li>
</ul>
</li>
<li>read和recv区别？write和send区别?<ul>
<li>linux系统调用read读取到fd,进入do_read函数，发现是网络socket套接字，最终执行的recv的函数；</li>
<li>同理write函数和read函数也是这么做，read/write对应的是文件描述符；send/recv对应的是网络协议栈中的源端IP、源端端口、目标端IP、目标端端口、协议.一切接文件是linux的抽象</li>
</ul>
</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/06/10/glusterfs-%E5%A6%82%E4%BD%95%E5%AE%9A%E4%BD%8D%E4%B8%80%E4%B8%AA%E6%96%87%E4%BB%B6%E4%BD%8D%E7%BD%AE/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="perrynzhou">
      <meta itemprop="description" content="擅长C/Go编程;https://github.com/perrynzhou。">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="perrynzhou">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/06/10/glusterfs-%E5%A6%82%E4%BD%95%E5%AE%9A%E4%BD%8D%E4%B8%80%E4%B8%AA%E6%96%87%E4%BB%B6%E4%BD%8D%E7%BD%AE/" class="post-title-link" itemprop="url">glusterfs 如何定位一个文件位置</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-06-10 18:06:31" itemprop="dateCreated datePublished" datetime="2020-06-10T18:06:31+08:00">2020-06-10</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-06-11 09:47:04" itemprop="dateModified" datetime="2020-06-11T09:47:04+08:00">2020-06-11</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h3 id="glusterfs-如何定位一个文件位置"><a href="#glusterfs-如何定位一个文件位置" class="headerlink" title="glusterfs 如何定位一个文件位置"></a>glusterfs 如何定位一个文件位置</h3><ul>
<li>volume 信息</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"># gluster volume info</span><br><span class="line"> </span><br><span class="line">Volume Name: rep3_vol</span><br><span class="line">Type: Distributed-Replicate</span><br><span class="line">Volume ID: 73360fc2-e105-4fd4-9b92-b5fa333ba75d</span><br><span class="line">Status: Started</span><br><span class="line">Snapshot Count: 0</span><br><span class="line">Number of Bricks: 12 x 3 &#x3D; 36</span><br><span class="line">Transport-type: tcp</span><br><span class="line">Bricks:</span><br><span class="line">Brick1: 10.193.189.153:&#x2F;debug&#x2F;glusterfs&#x2F;rep3_vol&#x2F;brick</span><br><span class="line">Brick2: 10.193.189.154:&#x2F;debug&#x2F;glusterfs&#x2F;rep3_vol&#x2F;brick</span><br><span class="line">Brick3: 10.193.189.155:&#x2F;debug&#x2F;glusterfs&#x2F;rep3_vol&#x2F;brick</span><br><span class="line">Brick4: 10.193.189.153:&#x2F;data2&#x2F;brick_rep3_vol</span><br><span class="line">Brick5: 10.193.189.154:&#x2F;data2&#x2F;brick_rep3_vol</span><br><span class="line">Brick6: 10.193.189.155:&#x2F;data2&#x2F;brick_rep3_vol</span><br><span class="line">Brick7: 10.193.189.153:&#x2F;data3&#x2F;brick_rep3_vol</span><br><span class="line">Brick8: 10.193.189.154:&#x2F;data3&#x2F;brick_rep3_vol</span><br><span class="line">Brick9: 10.193.189.155:&#x2F;data3&#x2F;brick_rep3_vol</span><br><span class="line">Brick10: 10.193.189.153:&#x2F;data4&#x2F;brick_rep3_vol</span><br><span class="line">Brick11: 10.193.189.154:&#x2F;data4&#x2F;brick_rep3_vol</span><br><span class="line">Brick12: 10.193.189.155:&#x2F;data4&#x2F;brick_rep3_vol</span><br><span class="line">Brick13: 10.193.189.153:&#x2F;data5&#x2F;brick_rep3_vol</span><br><span class="line">Brick14: 10.193.189.154:&#x2F;data5&#x2F;brick_rep3_vol</span><br><span class="line">Brick15: 10.193.189.155:&#x2F;data5&#x2F;brick_rep3_vol</span><br><span class="line">Brick16: 10.193.189.153:&#x2F;data6&#x2F;brick_rep3_vol</span><br><span class="line">Brick17: 10.193.189.154:&#x2F;data6&#x2F;brick_rep3_vol</span><br><span class="line">Brick18: 10.193.189.155:&#x2F;data6&#x2F;brick_rep3_vol</span><br><span class="line">Brick19: 10.193.189.153:&#x2F;data7&#x2F;brick_rep3_vol</span><br><span class="line">Brick20: 10.193.189.154:&#x2F;data7&#x2F;brick_rep3_vol</span><br><span class="line">Brick21: 10.193.189.155:&#x2F;data7&#x2F;brick_rep3_vol</span><br><span class="line">Brick22: 10.193.189.153:&#x2F;data8&#x2F;brick_rep3_vol</span><br><span class="line">Brick23: 10.193.189.154:&#x2F;data8&#x2F;brick_rep3_vol</span><br><span class="line">Brick24: 10.193.189.155:&#x2F;data8&#x2F;brick_rep3_vol</span><br><span class="line">Brick25: 10.193.189.153:&#x2F;data9&#x2F;brick_rep3_vol</span><br><span class="line">Brick26: 10.193.189.154:&#x2F;data9&#x2F;brick_rep3_vol</span><br><span class="line">Brick27: 10.193.189.155:&#x2F;data9&#x2F;brick_rep3_vol</span><br><span class="line">Brick28: 10.193.189.153:&#x2F;data10&#x2F;brick_rep3_vol</span><br><span class="line">Brick29: 10.193.189.154:&#x2F;data10&#x2F;brick_rep3_vol</span><br><span class="line">Brick30: 10.193.189.155:&#x2F;data10&#x2F;brick_rep3_vol</span><br><span class="line">Brick31: 10.193.189.153:&#x2F;data11&#x2F;brick_rep3_vol</span><br><span class="line">Brick32: 10.193.189.154:&#x2F;data11&#x2F;brick_rep3_vol</span><br><span class="line">Brick33: 10.193.189.155:&#x2F;data11&#x2F;brick_rep3_vol</span><br><span class="line">Brick34: 10.193.189.153:&#x2F;data12&#x2F;brick_rep3_vol</span><br><span class="line">Brick35: 10.193.189.154:&#x2F;data12&#x2F;brick_rep3_vol</span><br><span class="line">Brick36: 10.193.189.155:&#x2F;data12&#x2F;brick_rep3_vol</span><br><span class="line">Options Reconfigured:</span><br><span class="line">cluster.lookup-unhashed: off</span><br><span class="line">features.shard-block-size: 8GB</span><br><span class="line">features.shard: on</span><br><span class="line">diagnostics.brick-log-level: INFO</span><br><span class="line">performance.client-io-threads: off</span><br><span class="line">nfs.disable: on</span><br><span class="line">storage.fips-mode-rchecksum: on</span><br><span class="line">transport.address-family: inet</span><br><span class="line">diagnostics.client-log-level: DEBUG</span><br></pre></td></tr></table></figure>
<ul>
<li>cp或者rm一个文件，无论是dht/aft的模式，glusterfs都会先定位这个文件在哪个节点的哪个brick上，其使用的查找方法是dht_layout_search。</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; 参数传递一个目录名称或者文件名称，计算哈希值</span><br><span class="line">xlator_t *dht_layout_search(xlator_t *this, dht_layout_t *layout, const char *name)</span><br><span class="line">&#123;</span><br><span class="line">    uint32_t hash &#x3D; 0;</span><br><span class="line">    xlator_t *subvol &#x3D; NULL;</span><br><span class="line">    int i &#x3D; 0;</span><br><span class="line">    int ret &#x3D; 0;</span><br><span class="line">    &#x2F;&#x2F;哈希函数</span><br><span class="line">    ret &#x3D; dht_hash_compute(this, layout-&gt;type, name, &amp;hash);</span><br><span class="line">    &#x2F;&#x2F;如果是哈席卷,layout-&gt;cnt为brick的数量;如果是副本卷，layout-&gt;cnt则为副本的数量，比如12*3的副本卷模式，则layout-&gt;cnt为12</span><br><span class="line">    for (i &#x3D; 0; i &lt; layout-&gt;cnt; i++) &#123;</span><br><span class="line">        if (layout-&gt;list[i].start &lt;&#x3D; hash &amp;&amp; layout-&gt;list[i].stop &gt;&#x3D; hash) &#123;</span><br><span class="line">        	&#x2F;&#x2F; layout-&gt;list[i].xlator代表的是某个rep3_vol-replicate-&#123;n&#125;,的，而某个replicat有三个rep3_vol-client-&#123;n&#125;组成，rep3_vol-client是连接每个glusterfsd的进程的信息</span><br><span class="line">            subvol &#x3D; layout-&gt;list[i].xlator;</span><br><span class="line">            break;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">out:</span><br><span class="line">    return subvol;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>dht_layout_search并不是显示的调用该函数，而是通过dht_init_methods初始化<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">int</span><br><span class="line">dht_init_methods(xlator_t *this)</span><br><span class="line">&#123;</span><br><span class="line">    int ret &#x3D; -1;</span><br><span class="line">    dht_conf_t *conf &#x3D; NULL;</span><br><span class="line">    dht_methods_t *methods &#x3D; NULL;</span><br><span class="line"></span><br><span class="line">    GF_VALIDATE_OR_GOTO(&quot;dht&quot;, this, err);</span><br><span class="line"></span><br><span class="line">    conf &#x3D; this-&gt;private;</span><br><span class="line">    methods &#x3D; &amp;(conf-&gt;methods);</span><br><span class="line"></span><br><span class="line">    methods-&gt;migration_get_dst_subvol &#x3D; dht_migration_get_dst_subvol;</span><br><span class="line">    methods-&gt;migration_needed &#x3D; dht_migration_needed;</span><br><span class="line">    methods-&gt;migration_other &#x3D; NULL;</span><br><span class="line">    methods-&gt;layout_search &#x3D; dht_layout_search;</span><br><span class="line"></span><br><span class="line">    ret &#x3D; 0;</span><br><span class="line">err:</span><br><span class="line">    return ret;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>Final graph</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br><span class="line">505</span><br><span class="line">506</span><br><span class="line">507</span><br><span class="line">508</span><br><span class="line">509</span><br><span class="line">510</span><br><span class="line">511</span><br><span class="line">512</span><br><span class="line">513</span><br><span class="line">514</span><br><span class="line">515</span><br><span class="line">516</span><br><span class="line">517</span><br><span class="line">518</span><br><span class="line">519</span><br><span class="line">520</span><br><span class="line">521</span><br><span class="line">522</span><br><span class="line">523</span><br><span class="line">524</span><br><span class="line">525</span><br><span class="line">526</span><br><span class="line">527</span><br><span class="line">528</span><br><span class="line">529</span><br><span class="line">530</span><br><span class="line">531</span><br><span class="line">532</span><br><span class="line">533</span><br><span class="line">534</span><br><span class="line">535</span><br><span class="line">536</span><br><span class="line">537</span><br><span class="line">538</span><br><span class="line">539</span><br><span class="line">540</span><br><span class="line">541</span><br><span class="line">542</span><br><span class="line">543</span><br><span class="line">544</span><br><span class="line">545</span><br><span class="line">546</span><br><span class="line">547</span><br><span class="line">548</span><br><span class="line">549</span><br><span class="line">550</span><br><span class="line">551</span><br><span class="line">552</span><br><span class="line">553</span><br><span class="line">554</span><br><span class="line">555</span><br><span class="line">556</span><br><span class="line">557</span><br><span class="line">558</span><br><span class="line">559</span><br><span class="line">560</span><br><span class="line">561</span><br><span class="line">562</span><br><span class="line">563</span><br><span class="line">564</span><br><span class="line">565</span><br><span class="line">566</span><br><span class="line">567</span><br><span class="line">568</span><br><span class="line">569</span><br><span class="line">570</span><br><span class="line">571</span><br><span class="line">572</span><br><span class="line">573</span><br><span class="line">574</span><br><span class="line">575</span><br><span class="line">576</span><br><span class="line">577</span><br><span class="line">578</span><br><span class="line">579</span><br><span class="line">580</span><br><span class="line">581</span><br><span class="line">582</span><br><span class="line">583</span><br><span class="line">584</span><br><span class="line">585</span><br><span class="line">586</span><br><span class="line">587</span><br><span class="line">588</span><br><span class="line">589</span><br><span class="line">590</span><br><span class="line">591</span><br><span class="line">592</span><br><span class="line">593</span><br><span class="line">594</span><br><span class="line">595</span><br><span class="line">596</span><br><span class="line">597</span><br><span class="line">598</span><br><span class="line">599</span><br><span class="line">600</span><br><span class="line">601</span><br><span class="line">602</span><br><span class="line">603</span><br><span class="line">604</span><br><span class="line">605</span><br><span class="line">606</span><br><span class="line">607</span><br><span class="line">608</span><br><span class="line">609</span><br><span class="line">610</span><br><span class="line">611</span><br><span class="line">612</span><br><span class="line">613</span><br><span class="line">614</span><br><span class="line">615</span><br><span class="line">616</span><br><span class="line">617</span><br><span class="line">618</span><br><span class="line">619</span><br><span class="line">620</span><br><span class="line">621</span><br><span class="line">622</span><br><span class="line">623</span><br><span class="line">624</span><br><span class="line">625</span><br><span class="line">626</span><br><span class="line">627</span><br><span class="line">628</span><br><span class="line">629</span><br><span class="line">630</span><br><span class="line">631</span><br><span class="line">632</span><br><span class="line">633</span><br><span class="line">634</span><br><span class="line">635</span><br><span class="line">636</span><br><span class="line">637</span><br><span class="line">638</span><br><span class="line">639</span><br><span class="line">640</span><br><span class="line">641</span><br><span class="line">642</span><br><span class="line">643</span><br><span class="line">644</span><br><span class="line">645</span><br><span class="line">646</span><br><span class="line">647</span><br><span class="line">648</span><br><span class="line">649</span><br><span class="line">650</span><br><span class="line">651</span><br><span class="line">652</span><br><span class="line">653</span><br><span class="line">654</span><br><span class="line">655</span><br><span class="line">656</span><br><span class="line">657</span><br><span class="line">658</span><br><span class="line">659</span><br><span class="line">660</span><br><span class="line">661</span><br><span class="line">662</span><br><span class="line">663</span><br><span class="line">664</span><br><span class="line">665</span><br><span class="line">666</span><br><span class="line">667</span><br><span class="line">668</span><br><span class="line">669</span><br><span class="line">670</span><br><span class="line">671</span><br><span class="line">672</span><br><span class="line">673</span><br><span class="line">674</span><br><span class="line">675</span><br><span class="line">676</span><br><span class="line">677</span><br><span class="line">678</span><br><span class="line">679</span><br><span class="line">680</span><br><span class="line">681</span><br><span class="line">682</span><br><span class="line">683</span><br><span class="line">684</span><br><span class="line">685</span><br><span class="line">686</span><br><span class="line">687</span><br><span class="line">688</span><br><span class="line">689</span><br><span class="line">690</span><br><span class="line">691</span><br><span class="line">692</span><br><span class="line">693</span><br><span class="line">694</span><br><span class="line">695</span><br><span class="line">696</span><br><span class="line">697</span><br><span class="line">698</span><br><span class="line">699</span><br><span class="line">700</span><br><span class="line">701</span><br><span class="line">702</span><br><span class="line">703</span><br><span class="line">704</span><br><span class="line">705</span><br><span class="line">706</span><br><span class="line">707</span><br><span class="line">708</span><br><span class="line">709</span><br><span class="line">710</span><br><span class="line">711</span><br><span class="line">712</span><br><span class="line">713</span><br><span class="line">714</span><br><span class="line">715</span><br><span class="line">716</span><br><span class="line">717</span><br><span class="line">718</span><br><span class="line">719</span><br><span class="line">720</span><br><span class="line">721</span><br><span class="line">722</span><br><span class="line">723</span><br><span class="line">724</span><br><span class="line">725</span><br><span class="line">726</span><br><span class="line">727</span><br><span class="line">728</span><br><span class="line">729</span><br><span class="line">730</span><br><span class="line">731</span><br><span class="line">732</span><br><span class="line">733</span><br><span class="line">734</span><br><span class="line">735</span><br><span class="line">736</span><br><span class="line">737</span><br><span class="line">738</span><br><span class="line">739</span><br><span class="line">740</span><br><span class="line">741</span><br><span class="line">742</span><br><span class="line">743</span><br><span class="line">744</span><br><span class="line">745</span><br><span class="line">746</span><br><span class="line">747</span><br><span class="line">748</span><br><span class="line">749</span><br><span class="line">750</span><br><span class="line">751</span><br><span class="line">752</span><br><span class="line">753</span><br><span class="line">754</span><br><span class="line">755</span><br><span class="line">756</span><br><span class="line">757</span><br><span class="line">758</span><br><span class="line">759</span><br><span class="line">760</span><br><span class="line">761</span><br><span class="line">762</span><br><span class="line">763</span><br><span class="line">764</span><br><span class="line">765</span><br><span class="line">766</span><br><span class="line">767</span><br><span class="line">768</span><br><span class="line">769</span><br><span class="line">770</span><br><span class="line">771</span><br><span class="line">772</span><br><span class="line">773</span><br><span class="line">774</span><br><span class="line">775</span><br><span class="line">776</span><br><span class="line">777</span><br><span class="line">778</span><br><span class="line">779</span><br><span class="line">780</span><br><span class="line">781</span><br><span class="line">782</span><br><span class="line">783</span><br><span class="line">784</span><br><span class="line">785</span><br><span class="line">786</span><br><span class="line">787</span><br><span class="line">788</span><br><span class="line">789</span><br><span class="line">790</span><br><span class="line">791</span><br><span class="line">792</span><br><span class="line">793</span><br><span class="line">794</span><br><span class="line">795</span><br><span class="line">796</span><br><span class="line">797</span><br><span class="line">798</span><br><span class="line">799</span><br><span class="line">800</span><br><span class="line">801</span><br><span class="line">802</span><br><span class="line">803</span><br><span class="line">804</span><br><span class="line">805</span><br><span class="line">806</span><br><span class="line">807</span><br><span class="line">808</span><br><span class="line">809</span><br><span class="line">810</span><br><span class="line">811</span><br><span class="line">812</span><br><span class="line">813</span><br><span class="line">814</span><br><span class="line">815</span><br><span class="line">816</span><br><span class="line">817</span><br><span class="line">818</span><br><span class="line">819</span><br><span class="line">820</span><br><span class="line">821</span><br><span class="line">822</span><br><span class="line">823</span><br><span class="line">824</span><br><span class="line">825</span><br><span class="line">826</span><br><span class="line">827</span><br><span class="line">828</span><br><span class="line">829</span><br><span class="line">830</span><br><span class="line">831</span><br><span class="line">832</span><br><span class="line">833</span><br><span class="line">834</span><br><span class="line">835</span><br><span class="line">836</span><br><span class="line">837</span><br><span class="line">838</span><br><span class="line">839</span><br><span class="line">840</span><br><span class="line">841</span><br><span class="line">842</span><br><span class="line">843</span><br><span class="line">844</span><br><span class="line">845</span><br><span class="line">846</span><br><span class="line">847</span><br><span class="line">848</span><br><span class="line">849</span><br><span class="line">850</span><br><span class="line">851</span><br><span class="line">852</span><br><span class="line">853</span><br><span class="line">854</span><br><span class="line">855</span><br><span class="line">856</span><br><span class="line">857</span><br><span class="line">858</span><br><span class="line">859</span><br><span class="line">860</span><br><span class="line">861</span><br><span class="line">862</span><br><span class="line">863</span><br><span class="line">864</span><br><span class="line">865</span><br><span class="line">866</span><br><span class="line">867</span><br><span class="line">868</span><br><span class="line">869</span><br><span class="line">870</span><br><span class="line">871</span><br><span class="line">872</span><br><span class="line">873</span><br><span class="line">874</span><br><span class="line">875</span><br><span class="line">876</span><br><span class="line">877</span><br><span class="line">878</span><br><span class="line">879</span><br><span class="line">880</span><br><span class="line">881</span><br><span class="line">882</span><br><span class="line">883</span><br><span class="line">884</span><br><span class="line">885</span><br><span class="line">886</span><br><span class="line">887</span><br><span class="line">888</span><br><span class="line">889</span><br><span class="line">890</span><br><span class="line">891</span><br><span class="line">892</span><br><span class="line">893</span><br><span class="line">894</span><br><span class="line">895</span><br><span class="line">896</span><br><span class="line">897</span><br><span class="line">898</span><br><span class="line">899</span><br><span class="line">900</span><br><span class="line">901</span><br><span class="line">902</span><br><span class="line">903</span><br><span class="line">904</span><br><span class="line">905</span><br><span class="line">906</span><br><span class="line">907</span><br><span class="line">908</span><br><span class="line">909</span><br><span class="line">910</span><br><span class="line">911</span><br><span class="line">912</span><br><span class="line">913</span><br><span class="line">914</span><br><span class="line">915</span><br><span class="line">916</span><br><span class="line">917</span><br><span class="line">918</span><br><span class="line">919</span><br><span class="line">920</span><br><span class="line">921</span><br><span class="line">922</span><br><span class="line">923</span><br><span class="line">924</span><br><span class="line">925</span><br><span class="line">926</span><br><span class="line">927</span><br><span class="line">928</span><br><span class="line">929</span><br><span class="line">930</span><br><span class="line">931</span><br><span class="line">932</span><br><span class="line">933</span><br><span class="line">934</span><br><span class="line">935</span><br><span class="line">936</span><br><span class="line">937</span><br><span class="line">938</span><br><span class="line">939</span><br><span class="line">940</span><br><span class="line">941</span><br><span class="line">942</span><br><span class="line">943</span><br><span class="line">944</span><br><span class="line">945</span><br><span class="line">946</span><br><span class="line">947</span><br><span class="line">948</span><br><span class="line">949</span><br><span class="line">950</span><br><span class="line">951</span><br><span class="line">952</span><br><span class="line">953</span><br><span class="line">954</span><br><span class="line">955</span><br><span class="line">956</span><br><span class="line">957</span><br><span class="line">958</span><br><span class="line">959</span><br><span class="line">960</span><br><span class="line">961</span><br><span class="line">962</span><br><span class="line">963</span><br><span class="line">964</span><br><span class="line">965</span><br><span class="line">966</span><br><span class="line">967</span><br><span class="line">968</span><br><span class="line">969</span><br><span class="line">970</span><br><span class="line">971</span><br><span class="line">972</span><br><span class="line">973</span><br><span class="line">974</span><br><span class="line">975</span><br><span class="line">976</span><br><span class="line">977</span><br><span class="line">978</span><br><span class="line">979</span><br><span class="line">980</span><br><span class="line">981</span><br><span class="line">982</span><br><span class="line">983</span><br><span class="line">984</span><br><span class="line">985</span><br><span class="line">986</span><br><span class="line">987</span><br><span class="line">988</span><br><span class="line">989</span><br><span class="line">990</span><br><span class="line">991</span><br><span class="line">992</span><br><span class="line">993</span><br><span class="line">994</span><br><span class="line">995</span><br><span class="line">996</span><br><span class="line">997</span><br><span class="line">998</span><br><span class="line">999</span><br><span class="line">1000</span><br><span class="line">1001</span><br><span class="line">1002</span><br><span class="line">1003</span><br><span class="line">1004</span><br><span class="line">1005</span><br><span class="line">1006</span><br><span class="line">1007</span><br><span class="line">1008</span><br><span class="line">1009</span><br><span class="line">1010</span><br><span class="line">1011</span><br><span class="line">1012</span><br><span class="line">1013</span><br><span class="line">1014</span><br><span class="line">1015</span><br><span class="line">1016</span><br><span class="line">1017</span><br><span class="line">1018</span><br><span class="line">1019</span><br><span class="line">1020</span><br><span class="line">1021</span><br><span class="line">1022</span><br><span class="line">1023</span><br><span class="line">1024</span><br><span class="line">1025</span><br><span class="line">1026</span><br><span class="line">1027</span><br><span class="line">1028</span><br><span class="line">1029</span><br><span class="line">1030</span><br><span class="line">1031</span><br><span class="line">1032</span><br><span class="line">1033</span><br><span class="line">1034</span><br><span class="line">1035</span><br><span class="line">1036</span><br><span class="line">1037</span><br><span class="line">1038</span><br><span class="line">1039</span><br><span class="line">1040</span><br><span class="line">1041</span><br><span class="line">1042</span><br><span class="line">1043</span><br><span class="line">1044</span><br><span class="line">1045</span><br><span class="line">1046</span><br><span class="line">1047</span><br><span class="line">1048</span><br><span class="line">1049</span><br><span class="line">1050</span><br><span class="line">1051</span><br><span class="line">1052</span><br><span class="line">1053</span><br><span class="line">1054</span><br><span class="line">1055</span><br></pre></td><td class="code"><pre><span class="line">Final graph:</span><br><span class="line">+------------------------------------------------------------------------------+</span><br><span class="line"> volume rep3_vol-client-0</span><br><span class="line">     type protocol&#x2F;client</span><br><span class="line">     option opversion 70200</span><br><span class="line">     option clnt-lk-version 1</span><br><span class="line">     option volfile-checksum 0</span><br><span class="line">     option volfile-key rep3_vol</span><br><span class="line">     option client-version 2020.05.12</span><br><span class="line">     option process-name fuse</span><br><span class="line">     option process-uuid CTX_ID:da279c3e-54cc-4d0e-b921-1395feeeae9a-GRAPH_ID:0-PID:93273-HOST:ai-storage-prd-10-193-189-153.v-bj-4.vivo.lan-PC_NAME:rep3_vol-client-0-RECON_NO:-0</span><br><span class="line">     option fops-version 1298437</span><br><span class="line">     option ping-timeout 42</span><br><span class="line">     option remote-host 10.193.189.153</span><br><span class="line">     option remote-subvolume &#x2F;debug&#x2F;glusterfs&#x2F;rep3_vol&#x2F;brick</span><br><span class="line">     option transport-type socket</span><br><span class="line">     option transport.address-family inet</span><br><span class="line">     option username bdb0a45d-e70d-445d-8fe6-76118dfdb738</span><br><span class="line">     option password 7e9a1877-0837-4563-b73d-aa4cde754c91</span><br><span class="line">     option transport.socket.ssl-enabled off</span><br><span class="line">     option transport.tcp-user-timeout 0</span><br><span class="line">     option transport.socket.keepalive-time 20</span><br><span class="line">     option transport.socket.keepalive-interval 2</span><br><span class="line">     option transport.socket.keepalive-count 9</span><br><span class="line">     option send-gids true</span><br><span class="line"> end-volume</span><br><span class="line">  </span><br><span class="line"> volume rep3_vol-client-1</span><br><span class="line">     type protocol&#x2F;client</span><br><span class="line">     option opversion 70200</span><br><span class="line">     option clnt-lk-version 1</span><br><span class="line">     option volfile-checksum 0</span><br><span class="line">     option volfile-key rep3_vol</span><br><span class="line">     option client-version 2020.05.12</span><br><span class="line">     option process-name fuse</span><br><span class="line">     option process-uuid CTX_ID:da279c3e-54cc-4d0e-b921-1395feeeae9a-GRAPH_ID:0-PID:93273-HOST:ai-storage-prd-10-193-189-153.v-bj-4.vivo.lan-PC_NAME:rep3_vol-client-1-RECON_NO:-0</span><br><span class="line">     option fops-version 1298437</span><br><span class="line">     option ping-timeout 42</span><br><span class="line">     option remote-host 10.193.189.154</span><br><span class="line">     option remote-subvolume &#x2F;debug&#x2F;glusterfs&#x2F;rep3_vol&#x2F;brick</span><br><span class="line">     option transport-type socket</span><br><span class="line">     option transport.address-family inet</span><br><span class="line">     option username bdb0a45d-e70d-445d-8fe6-76118dfdb738</span><br><span class="line">     option password 7e9a1877-0837-4563-b73d-aa4cde754c91</span><br><span class="line">     option transport.socket.ssl-enabled off</span><br><span class="line">     option transport.tcp-user-timeout 0</span><br><span class="line">     option transport.socket.keepalive-time 20</span><br><span class="line">     option transport.socket.keepalive-interval 2</span><br><span class="line">     option transport.socket.keepalive-count 9</span><br><span class="line">     option send-gids true</span><br><span class="line"> end-volume</span><br><span class="line">  </span><br><span class="line"> volume rep3_vol-client-2</span><br><span class="line">     type protocol&#x2F;client</span><br><span class="line">     option opversion 70200</span><br><span class="line">     option clnt-lk-version 1</span><br><span class="line">     option volfile-checksum 0</span><br><span class="line">     option volfile-key rep3_vol</span><br><span class="line">     option client-version 2020.05.12</span><br><span class="line">     option process-name fuse</span><br><span class="line">     option process-uuid CTX_ID:da279c3e-54cc-4d0e-b921-1395feeeae9a-GRAPH_ID:0-PID:93273-HOST:ai-storage-prd-10-193-189-153.v-bj-4.vivo.lan-PC_NAME:rep3_vol-client-2-RECON_NO:-0</span><br><span class="line">     option fops-version 1298437</span><br><span class="line">     option ping-timeout 42</span><br><span class="line">     option remote-host 10.193.189.155</span><br><span class="line">     option remote-subvolume &#x2F;debug&#x2F;glusterfs&#x2F;rep3_vol&#x2F;brick</span><br><span class="line">     option transport-type socket</span><br><span class="line">     option transport.address-family inet</span><br><span class="line">     option username bdb0a45d-e70d-445d-8fe6-76118dfdb738</span><br><span class="line">     option password 7e9a1877-0837-4563-b73d-aa4cde754c91</span><br><span class="line">     option transport.socket.ssl-enabled off</span><br><span class="line">     option transport.tcp-user-timeout 0</span><br><span class="line">     option transport.socket.keepalive-time 20</span><br><span class="line">     option transport.socket.keepalive-interval 2</span><br><span class="line">     option transport.socket.keepalive-count 9</span><br><span class="line">     option send-gids true</span><br><span class="line"> end-volume</span><br><span class="line">  </span><br><span class="line"> volume rep3_vol-replicate-0</span><br><span class="line">     type cluster&#x2F;replicate</span><br><span class="line">     option afr-pending-xattr rep3_vol-client-0,rep3_vol-client-1,rep3_vol-client-2</span><br><span class="line">     option use-compound-fops off</span><br><span class="line">     subvolumes rep3_vol-client-0 rep3_vol-client-1 rep3_vol-client-2</span><br><span class="line"> end-volume</span><br><span class="line">  </span><br><span class="line"> volume rep3_vol-client-3</span><br><span class="line">     type protocol&#x2F;client</span><br><span class="line">     option opversion 70200</span><br><span class="line">     option clnt-lk-version 1</span><br><span class="line">     option volfile-checksum 0</span><br><span class="line">     option volfile-key rep3_vol</span><br><span class="line">     option client-version 2020.05.12</span><br><span class="line">     option process-name fuse</span><br><span class="line">     option process-uuid CTX_ID:da279c3e-54cc-4d0e-b921-1395feeeae9a-GRAPH_ID:0-PID:93273-HOST:ai-storage-prd-10-193-189-153.v-bj-4.vivo.lan-PC_NAME:rep3_vol-client-3-RECON_NO:-0</span><br><span class="line">     option fops-version 1298437</span><br><span class="line">     option ping-timeout 42</span><br><span class="line">     option remote-host 10.193.189.153</span><br><span class="line">     option remote-subvolume &#x2F;data2&#x2F;brick_rep3_vol</span><br><span class="line">     option transport-type socket</span><br><span class="line">     option transport.address-family inet</span><br><span class="line">     option username bdb0a45d-e70d-445d-8fe6-76118dfdb738</span><br><span class="line">     option password 7e9a1877-0837-4563-b73d-aa4cde754c91</span><br><span class="line">     option transport.socket.ssl-enabled off</span><br><span class="line">     option transport.tcp-user-timeout 0</span><br><span class="line">     option transport.socket.keepalive-time 20</span><br><span class="line">     option transport.socket.keepalive-interval 2</span><br><span class="line">     option transport.socket.keepalive-count 9</span><br><span class="line">     option send-gids true</span><br><span class="line"> end-volume</span><br><span class="line">  </span><br><span class="line"> volume rep3_vol-client-4</span><br><span class="line">     type protocol&#x2F;client</span><br><span class="line">     option opversion 70200</span><br><span class="line">     option clnt-lk-version 1</span><br><span class="line">     option volfile-checksum 0</span><br><span class="line">     option volfile-key rep3_vol</span><br><span class="line">     option client-version 2020.05.12</span><br><span class="line">     option process-name fuse</span><br><span class="line">     option process-uuid CTX_ID:da279c3e-54cc-4d0e-b921-1395feeeae9a-GRAPH_ID:0-PID:93273-HOST:ai-storage-prd-10-193-189-153.v-bj-4.vivo.lan-PC_NAME:rep3_vol-client-4-RECON_NO:-0</span><br><span class="line">     option fops-version 1298437</span><br><span class="line">     option ping-timeout 42</span><br><span class="line">     option remote-host 10.193.189.154</span><br><span class="line">     option remote-subvolume &#x2F;data2&#x2F;brick_rep3_vol</span><br><span class="line">     option transport-type socket</span><br><span class="line">     option transport.address-family inet</span><br><span class="line">     option username bdb0a45d-e70d-445d-8fe6-76118dfdb738</span><br><span class="line">     option password 7e9a1877-0837-4563-b73d-aa4cde754c91</span><br><span class="line">     option transport.socket.ssl-enabled off</span><br><span class="line">     option transport.tcp-user-timeout 0</span><br><span class="line">     option transport.socket.keepalive-time 20</span><br><span class="line">     option transport.socket.keepalive-interval 2</span><br><span class="line">     option transport.socket.keepalive-count 9</span><br><span class="line">     option send-gids true</span><br><span class="line"> end-volume</span><br><span class="line">  </span><br><span class="line"> volume rep3_vol-client-5</span><br><span class="line">     type protocol&#x2F;client</span><br><span class="line">     option opversion 70200</span><br><span class="line">     option clnt-lk-version 1</span><br><span class="line">     option volfile-checksum 0</span><br><span class="line">     option volfile-key rep3_vol</span><br><span class="line">     option client-version 2020.05.12</span><br><span class="line">     option process-name fuse</span><br><span class="line">     option process-uuid CTX_ID:da279c3e-54cc-4d0e-b921-1395feeeae9a-GRAPH_ID:0-PID:93273-HOST:ai-storage-prd-10-193-189-153.v-bj-4.vivo.lan-PC_NAME:rep3_vol-client-5-RECON_NO:-0</span><br><span class="line">     option fops-version 1298437</span><br><span class="line">     option ping-timeout 42</span><br><span class="line">     option remote-host 10.193.189.155</span><br><span class="line">     option remote-subvolume &#x2F;data2&#x2F;brick_rep3_vol</span><br><span class="line">     option transport-type socket</span><br><span class="line">     option transport.address-family inet</span><br><span class="line">     option username bdb0a45d-e70d-445d-8fe6-76118dfdb738</span><br><span class="line">     option password 7e9a1877-0837-4563-b73d-aa4cde754c91</span><br><span class="line">     option transport.socket.ssl-enabled off</span><br><span class="line">     option transport.tcp-user-timeout 0</span><br><span class="line">     option transport.socket.keepalive-time 20</span><br><span class="line">     option transport.socket.keepalive-interval 2</span><br><span class="line">     option transport.socket.keepalive-count 9</span><br><span class="line">     option send-gids true</span><br><span class="line"> end-volume</span><br><span class="line">  </span><br><span class="line"> volume rep3_vol-replicate-1</span><br><span class="line">     type cluster&#x2F;replicate</span><br><span class="line">     option afr-pending-xattr rep3_vol-client-3,rep3_vol-client-4,rep3_vol-client-5</span><br><span class="line">     option use-compound-fops off</span><br><span class="line">     subvolumes rep3_vol-client-3 rep3_vol-client-4 rep3_vol-client-5</span><br><span class="line"> end-volume</span><br><span class="line">  </span><br><span class="line"> volume rep3_vol-client-6</span><br><span class="line">     type protocol&#x2F;client</span><br><span class="line">     option opversion 70200</span><br><span class="line">     option clnt-lk-version 1</span><br><span class="line">     option volfile-checksum 0</span><br><span class="line">     option volfile-key rep3_vol</span><br><span class="line">     option client-version 2020.05.12</span><br><span class="line">     option process-name fuse</span><br><span class="line">     option process-uuid CTX_ID:da279c3e-54cc-4d0e-b921-1395feeeae9a-GRAPH_ID:0-PID:93273-HOST:ai-storage-prd-10-193-189-153.v-bj-4.vivo.lan-PC_NAME:rep3_vol-client-6-RECON_NO:-0</span><br><span class="line">     option fops-version 1298437</span><br><span class="line">     option ping-timeout 42</span><br><span class="line">     option remote-host 10.193.189.153</span><br><span class="line">     option remote-subvolume &#x2F;data3&#x2F;brick_rep3_vol</span><br><span class="line">     option transport-type socket</span><br><span class="line">     option transport.address-family inet</span><br><span class="line">     option username bdb0a45d-e70d-445d-8fe6-76118dfdb738</span><br><span class="line">     option password 7e9a1877-0837-4563-b73d-aa4cde754c91</span><br><span class="line">     option transport.socket.ssl-enabled off</span><br><span class="line">     option transport.tcp-user-timeout 0</span><br><span class="line">     option transport.socket.keepalive-time 20</span><br><span class="line">     option transport.socket.keepalive-interval 2</span><br><span class="line">     option transport.socket.keepalive-count 9</span><br><span class="line">     option send-gids true</span><br><span class="line"> end-volume</span><br><span class="line">  </span><br><span class="line"> volume rep3_vol-client-7</span><br><span class="line">     type protocol&#x2F;client</span><br><span class="line">     option opversion 70200</span><br><span class="line">     option clnt-lk-version 1</span><br><span class="line">     option volfile-checksum 0</span><br><span class="line">     option volfile-key rep3_vol</span><br><span class="line">     option client-version 2020.05.12</span><br><span class="line">     option process-name fuse</span><br><span class="line">     option process-uuid CTX_ID:da279c3e-54cc-4d0e-b921-1395feeeae9a-GRAPH_ID:0-PID:93273-HOST:ai-storage-prd-10-193-189-153.v-bj-4.vivo.lan-PC_NAME:rep3_vol-client-7-RECON_NO:-0</span><br><span class="line">     option fops-version 1298437</span><br><span class="line">     option ping-timeout 42</span><br><span class="line">     option remote-host 10.193.189.154</span><br><span class="line">     option remote-subvolume &#x2F;data3&#x2F;brick_rep3_vol</span><br><span class="line">     option transport-type socket</span><br><span class="line">     option transport.address-family inet</span><br><span class="line">     option username bdb0a45d-e70d-445d-8fe6-76118dfdb738</span><br><span class="line">     option password 7e9a1877-0837-4563-b73d-aa4cde754c91</span><br><span class="line">     option transport.socket.ssl-enabled off</span><br><span class="line">     option transport.tcp-user-timeout 0</span><br><span class="line">     option transport.socket.keepalive-time 20</span><br><span class="line">     option transport.socket.keepalive-interval 2</span><br><span class="line">     option transport.socket.keepalive-count 9</span><br><span class="line">     option send-gids true</span><br><span class="line"> end-volume</span><br><span class="line">  </span><br><span class="line"> volume rep3_vol-client-8</span><br><span class="line">     type protocol&#x2F;client</span><br><span class="line">     option opversion 70200</span><br><span class="line">     option clnt-lk-version 1</span><br><span class="line">     option volfile-checksum 0</span><br><span class="line">     option volfile-key rep3_vol</span><br><span class="line">     option client-version 2020.05.12</span><br><span class="line">     option process-name fuse</span><br><span class="line">     option process-uuid CTX_ID:da279c3e-54cc-4d0e-b921-1395feeeae9a-GRAPH_ID:0-PID:93273-HOST:ai-storage-prd-10-193-189-153.v-bj-4.vivo.lan-PC_NAME:rep3_vol-client-8-RECON_NO:-0</span><br><span class="line">     option fops-version 1298437</span><br><span class="line">     option ping-timeout 42</span><br><span class="line">     option remote-host 10.193.189.155</span><br><span class="line">     option remote-subvolume &#x2F;data3&#x2F;brick_rep3_vol</span><br><span class="line">     option transport-type socket</span><br><span class="line">     option transport.address-family inet</span><br><span class="line">     option username bdb0a45d-e70d-445d-8fe6-76118dfdb738</span><br><span class="line">     option password 7e9a1877-0837-4563-b73d-aa4cde754c91</span><br><span class="line">     option transport.socket.ssl-enabled off</span><br><span class="line">     option transport.tcp-user-timeout 0</span><br><span class="line">     option transport.socket.keepalive-time 20</span><br><span class="line">     option transport.socket.keepalive-interval 2</span><br><span class="line">     option transport.socket.keepalive-count 9</span><br><span class="line">     option send-gids true</span><br><span class="line"> end-volume</span><br><span class="line">  </span><br><span class="line"> volume rep3_vol-replicate-2</span><br><span class="line">     type cluster&#x2F;replicate</span><br><span class="line">     option afr-pending-xattr rep3_vol-client-6,rep3_vol-client-7,rep3_vol-client-8</span><br><span class="line">     option use-compound-fops off</span><br><span class="line">     subvolumes rep3_vol-client-6 rep3_vol-client-7 rep3_vol-client-8</span><br><span class="line"> end-volume</span><br><span class="line">  </span><br><span class="line"> volume rep3_vol-client-9</span><br><span class="line">     type protocol&#x2F;client</span><br><span class="line">     option opversion 70200</span><br><span class="line">     option clnt-lk-version 1</span><br><span class="line">     option volfile-checksum 0</span><br><span class="line">     option volfile-key rep3_vol</span><br><span class="line">     option client-version 2020.05.12</span><br><span class="line">     option process-name fuse</span><br><span class="line">     option process-uuid CTX_ID:da279c3e-54cc-4d0e-b921-1395feeeae9a-GRAPH_ID:0-PID:93273-HOST:ai-storage-prd-10-193-189-153.v-bj-4.vivo.lan-PC_NAME:rep3_vol-client-9-RECON_NO:-0</span><br><span class="line">     option fops-version 1298437</span><br><span class="line">     option ping-timeout 42</span><br><span class="line">     option remote-host 10.193.189.153</span><br><span class="line">     option remote-subvolume &#x2F;data4&#x2F;brick_rep3_vol</span><br><span class="line">     option transport-type socket</span><br><span class="line">     option transport.address-family inet</span><br><span class="line">     option username bdb0a45d-e70d-445d-8fe6-76118dfdb738</span><br><span class="line">     option password 7e9a1877-0837-4563-b73d-aa4cde754c91</span><br><span class="line">     option transport.socket.ssl-enabled off</span><br><span class="line">     option transport.tcp-user-timeout 0</span><br><span class="line">     option transport.socket.keepalive-time 20</span><br><span class="line">     option transport.socket.keepalive-interval 2</span><br><span class="line">     option transport.socket.keepalive-count 9</span><br><span class="line">     option send-gids true</span><br><span class="line"> end-volume</span><br><span class="line">  </span><br><span class="line"> volume rep3_vol-client-10</span><br><span class="line">     type protocol&#x2F;client</span><br><span class="line">     option opversion 70200</span><br><span class="line">     option clnt-lk-version 1</span><br><span class="line">     option volfile-checksum 0</span><br><span class="line">     option volfile-key rep3_vol</span><br><span class="line">     option client-version 2020.05.12</span><br><span class="line">     option process-name fuse</span><br><span class="line">     option process-uuid CTX_ID:da279c3e-54cc-4d0e-b921-1395feeeae9a-GRAPH_ID:0-PID:93273-HOST:ai-storage-prd-10-193-189-153.v-bj-4.vivo.lan-PC_NAME:rep3_vol-client-10-RECON_NO:-0</span><br><span class="line">     option fops-version 1298437</span><br><span class="line">     option ping-timeout 42</span><br><span class="line">     option remote-host 10.193.189.154</span><br><span class="line">     option remote-subvolume &#x2F;data4&#x2F;brick_rep3_vol</span><br><span class="line">     option transport-type socket</span><br><span class="line">     option transport.address-family inet</span><br><span class="line">     option username bdb0a45d-e70d-445d-8fe6-76118dfdb738</span><br><span class="line">     option password 7e9a1877-0837-4563-b73d-aa4cde754c91</span><br><span class="line">     option transport.socket.ssl-enabled off</span><br><span class="line">     option transport.tcp-user-timeout 0</span><br><span class="line">     option transport.socket.keepalive-time 20</span><br><span class="line">     option transport.socket.keepalive-interval 2</span><br><span class="line">     option transport.socket.keepalive-count 9</span><br><span class="line">     option send-gids true</span><br><span class="line"> end-volume</span><br><span class="line">  </span><br><span class="line"> volume rep3_vol-client-11</span><br><span class="line">     type protocol&#x2F;client</span><br><span class="line">     option opversion 70200</span><br><span class="line">     option clnt-lk-version 1</span><br><span class="line">     option volfile-checksum 0</span><br><span class="line">     option volfile-key rep3_vol</span><br><span class="line">     option client-version 2020.05.12</span><br><span class="line">     option process-name fuse</span><br><span class="line">     option process-uuid CTX_ID:da279c3e-54cc-4d0e-b921-1395feeeae9a-GRAPH_ID:0-PID:93273-HOST:ai-storage-prd-10-193-189-153.v-bj-4.vivo.lan-PC_NAME:rep3_vol-client-11-RECON_NO:-0</span><br><span class="line">     option fops-version 1298437</span><br><span class="line">     option ping-timeout 42</span><br><span class="line">     option remote-host 10.193.189.155</span><br><span class="line">     option remote-subvolume &#x2F;data4&#x2F;brick_rep3_vol</span><br><span class="line">     option transport-type socket</span><br><span class="line">     option transport.address-family inet</span><br><span class="line">     option username bdb0a45d-e70d-445d-8fe6-76118dfdb738</span><br><span class="line">     option password 7e9a1877-0837-4563-b73d-aa4cde754c91</span><br><span class="line">     option transport.socket.ssl-enabled off</span><br><span class="line">     option transport.tcp-user-timeout 0</span><br><span class="line">     option transport.socket.keepalive-time 20</span><br><span class="line">     option transport.socket.keepalive-interval 2</span><br><span class="line">     option transport.socket.keepalive-count 9</span><br><span class="line">     option send-gids true</span><br><span class="line"> end-volume</span><br><span class="line">  </span><br><span class="line"> volume rep3_vol-replicate-3</span><br><span class="line">     type cluster&#x2F;replicate</span><br><span class="line">     option afr-pending-xattr rep3_vol-client-9,rep3_vol-client-10,rep3_vol-client-11</span><br><span class="line">     option use-compound-fops off</span><br><span class="line">     subvolumes rep3_vol-client-9 rep3_vol-client-10 rep3_vol-client-11</span><br><span class="line"> end-volume</span><br><span class="line">  </span><br><span class="line"> volume rep3_vol-client-12</span><br><span class="line">     type protocol&#x2F;client</span><br><span class="line">     option opversion 70200</span><br><span class="line">     option clnt-lk-version 1</span><br><span class="line">     option volfile-checksum 0</span><br><span class="line">     option volfile-key rep3_vol</span><br><span class="line">     option client-version 2020.05.12</span><br><span class="line">     option process-name fuse</span><br><span class="line">     option process-uuid CTX_ID:da279c3e-54cc-4d0e-b921-1395feeeae9a-GRAPH_ID:0-PID:93273-HOST:ai-storage-prd-10-193-189-153.v-bj-4.vivo.lan-PC_NAME:rep3_vol-client-12-RECON_NO:-0</span><br><span class="line">     option fops-version 1298437</span><br><span class="line">     option ping-timeout 42</span><br><span class="line">     option remote-host 10.193.189.153</span><br><span class="line">     option remote-subvolume &#x2F;data5&#x2F;brick_rep3_vol</span><br><span class="line">     option transport-type socket</span><br><span class="line">     option transport.address-family inet</span><br><span class="line">     option username bdb0a45d-e70d-445d-8fe6-76118dfdb738</span><br><span class="line">     option password 7e9a1877-0837-4563-b73d-aa4cde754c91</span><br><span class="line">     option transport.socket.ssl-enabled off</span><br><span class="line">     option transport.tcp-user-timeout 0</span><br><span class="line">     option transport.socket.keepalive-time 20</span><br><span class="line">     option transport.socket.keepalive-interval 2</span><br><span class="line">     option transport.socket.keepalive-count 9</span><br><span class="line">     option send-gids true</span><br><span class="line"> end-volume</span><br><span class="line">  </span><br><span class="line"> volume rep3_vol-client-13</span><br><span class="line">     type protocol&#x2F;client</span><br><span class="line">     option opversion 70200</span><br><span class="line">     option clnt-lk-version 1</span><br><span class="line">     option volfile-checksum 0</span><br><span class="line">     option volfile-key rep3_vol</span><br><span class="line">     option client-version 2020.05.12</span><br><span class="line">     option process-name fuse</span><br><span class="line">     option process-uuid CTX_ID:da279c3e-54cc-4d0e-b921-1395feeeae9a-GRAPH_ID:0-PID:93273-HOST:ai-storage-prd-10-193-189-153.v-bj-4.vivo.lan-PC_NAME:rep3_vol-client-13-RECON_NO:-0</span><br><span class="line">     option fops-version 1298437</span><br><span class="line">     option ping-timeout 42</span><br><span class="line">     option remote-host 10.193.189.154</span><br><span class="line">     option remote-subvolume &#x2F;data5&#x2F;brick_rep3_vol</span><br><span class="line">     option transport-type socket</span><br><span class="line">     option transport.address-family inet</span><br><span class="line">     option username bdb0a45d-e70d-445d-8fe6-76118dfdb738</span><br><span class="line">     option password 7e9a1877-0837-4563-b73d-aa4cde754c91</span><br><span class="line">     option transport.socket.ssl-enabled off</span><br><span class="line">     option transport.tcp-user-timeout 0</span><br><span class="line">     option transport.socket.keepalive-time 20</span><br><span class="line">     option transport.socket.keepalive-interval 2</span><br><span class="line">     option transport.socket.keepalive-count 9</span><br><span class="line">     option send-gids true</span><br><span class="line"> end-volume</span><br><span class="line">  </span><br><span class="line"> volume rep3_vol-client-14</span><br><span class="line">     type protocol&#x2F;client</span><br><span class="line">     option opversion 70200</span><br><span class="line">     option clnt-lk-version 1</span><br><span class="line">     option volfile-checksum 0</span><br><span class="line">     option volfile-key rep3_vol</span><br><span class="line">     option client-version 2020.05.12</span><br><span class="line">     option process-name fuse</span><br><span class="line">     option process-uuid CTX_ID:da279c3e-54cc-4d0e-b921-1395feeeae9a-GRAPH_ID:0-PID:93273-HOST:ai-storage-prd-10-193-189-153.v-bj-4.vivo.lan-PC_NAME:rep3_vol-client-14-RECON_NO:-0</span><br><span class="line">     option fops-version 1298437</span><br><span class="line">     option ping-timeout 42</span><br><span class="line">     option remote-host 10.193.189.155</span><br><span class="line">     option remote-subvolume &#x2F;data5&#x2F;brick_rep3_vol</span><br><span class="line">     option transport-type socket</span><br><span class="line">     option transport.address-family inet</span><br><span class="line">     option username bdb0a45d-e70d-445d-8fe6-76118dfdb738</span><br><span class="line">     option password 7e9a1877-0837-4563-b73d-aa4cde754c91</span><br><span class="line">     option transport.socket.ssl-enabled off</span><br><span class="line">     option transport.tcp-user-timeout 0</span><br><span class="line">     option transport.socket.keepalive-time 20</span><br><span class="line">     option transport.socket.keepalive-interval 2</span><br><span class="line">     option transport.socket.keepalive-count 9</span><br><span class="line">     option send-gids true</span><br><span class="line"> end-volume</span><br><span class="line">  </span><br><span class="line"> volume rep3_vol-replicate-4</span><br><span class="line">     type cluster&#x2F;replicate</span><br><span class="line">     option afr-pending-xattr rep3_vol-client-12,rep3_vol-client-13,rep3_vol-client-14</span><br><span class="line">     option use-compound-fops off</span><br><span class="line">     subvolumes rep3_vol-client-12 rep3_vol-client-13 rep3_vol-client-14</span><br><span class="line"> end-volume</span><br><span class="line">  </span><br><span class="line"> volume rep3_vol-client-15</span><br><span class="line">     type protocol&#x2F;client</span><br><span class="line">     option opversion 70200</span><br><span class="line">     option clnt-lk-version 1</span><br><span class="line">     option volfile-checksum 0</span><br><span class="line">     option volfile-key rep3_vol</span><br><span class="line">     option client-version 2020.05.12</span><br><span class="line">     option process-name fuse</span><br><span class="line">     option process-uuid CTX_ID:da279c3e-54cc-4d0e-b921-1395feeeae9a-GRAPH_ID:0-PID:93273-HOST:ai-storage-prd-10-193-189-153.v-bj-4.vivo.lan-PC_NAME:rep3_vol-client-15-RECON_NO:-0</span><br><span class="line">     option fops-version 1298437</span><br><span class="line">     option ping-timeout 42</span><br><span class="line">     option remote-host 10.193.189.153</span><br><span class="line">     option remote-subvolume &#x2F;data6&#x2F;brick_rep3_vol</span><br><span class="line">     option transport-type socket</span><br><span class="line">     option transport.address-family inet</span><br><span class="line">     option username bdb0a45d-e70d-445d-8fe6-76118dfdb738</span><br><span class="line">     option password 7e9a1877-0837-4563-b73d-aa4cde754c91</span><br><span class="line">     option transport.socket.ssl-enabled off</span><br><span class="line">     option transport.tcp-user-timeout 0</span><br><span class="line">     option transport.socket.keepalive-time 20</span><br><span class="line">     option transport.socket.keepalive-interval 2</span><br><span class="line">     option transport.socket.keepalive-count 9</span><br><span class="line">     option send-gids true</span><br><span class="line"> end-volume</span><br><span class="line">  </span><br><span class="line"> volume rep3_vol-client-16</span><br><span class="line">     type protocol&#x2F;client</span><br><span class="line">     option opversion 70200</span><br><span class="line">     option clnt-lk-version 1</span><br><span class="line">     option volfile-checksum 0</span><br><span class="line">     option volfile-key rep3_vol</span><br><span class="line">     option client-version 2020.05.12</span><br><span class="line">     option process-name fuse</span><br><span class="line">     option process-uuid CTX_ID:da279c3e-54cc-4d0e-b921-1395feeeae9a-GRAPH_ID:0-PID:93273-HOST:ai-storage-prd-10-193-189-153.v-bj-4.vivo.lan-PC_NAME:rep3_vol-client-16-RECON_NO:-0</span><br><span class="line">     option fops-version 1298437</span><br><span class="line">     option ping-timeout 42</span><br><span class="line">     option remote-host 10.193.189.154</span><br><span class="line">     option remote-subvolume &#x2F;data6&#x2F;brick_rep3_vol</span><br><span class="line">     option transport-type socket</span><br><span class="line">     option transport.address-family inet</span><br><span class="line">     option username bdb0a45d-e70d-445d-8fe6-76118dfdb738</span><br><span class="line">     option password 7e9a1877-0837-4563-b73d-aa4cde754c91</span><br><span class="line">     option transport.socket.ssl-enabled off</span><br><span class="line">     option transport.tcp-user-timeout 0</span><br><span class="line">     option transport.socket.keepalive-time 20</span><br><span class="line">     option transport.socket.keepalive-interval 2</span><br><span class="line">     option transport.socket.keepalive-count 9</span><br><span class="line">     option send-gids true</span><br><span class="line"> end-volume</span><br><span class="line">  </span><br><span class="line"> volume rep3_vol-client-17</span><br><span class="line">     type protocol&#x2F;client</span><br><span class="line">     option opversion 70200</span><br><span class="line">     option clnt-lk-version 1</span><br><span class="line">     option volfile-checksum 0</span><br><span class="line">     option volfile-key rep3_vol</span><br><span class="line">     option client-version 2020.05.12</span><br><span class="line">     option process-name fuse</span><br><span class="line">     option process-uuid CTX_ID:da279c3e-54cc-4d0e-b921-1395feeeae9a-GRAPH_ID:0-PID:93273-HOST:ai-storage-prd-10-193-189-153.v-bj-4.vivo.lan-PC_NAME:rep3_vol-client-17-RECON_NO:-0</span><br><span class="line">     option fops-version 1298437</span><br><span class="line">     option ping-timeout 42</span><br><span class="line">     option remote-host 10.193.189.155</span><br><span class="line">     option remote-subvolume &#x2F;data6&#x2F;brick_rep3_vol</span><br><span class="line">     option transport-type socket</span><br><span class="line">     option transport.address-family inet</span><br><span class="line">     option username bdb0a45d-e70d-445d-8fe6-76118dfdb738</span><br><span class="line">     option password 7e9a1877-0837-4563-b73d-aa4cde754c91</span><br><span class="line">     option transport.socket.ssl-enabled off</span><br><span class="line">     option transport.tcp-user-timeout 0</span><br><span class="line">     option transport.socket.keepalive-time 20</span><br><span class="line">     option transport.socket.keepalive-interval 2</span><br><span class="line">     option transport.socket.keepalive-count 9</span><br><span class="line">     option send-gids true</span><br><span class="line"> end-volume</span><br><span class="line">  </span><br><span class="line"> volume rep3_vol-replicate-5</span><br><span class="line">     type cluster&#x2F;replicate</span><br><span class="line">     option afr-pending-xattr rep3_vol-client-15,rep3_vol-client-16,rep3_vol-client-17</span><br><span class="line">     option use-compound-fops off</span><br><span class="line">     subvolumes rep3_vol-client-15 rep3_vol-client-16 rep3_vol-client-17</span><br><span class="line"> end-volume</span><br><span class="line">  </span><br><span class="line"> volume rep3_vol-client-18</span><br><span class="line">     type protocol&#x2F;client</span><br><span class="line">     option opversion 70200</span><br><span class="line">     option clnt-lk-version 1</span><br><span class="line">     option volfile-checksum 0</span><br><span class="line">     option volfile-key rep3_vol</span><br><span class="line">     option client-version 2020.05.12</span><br><span class="line">     option process-name fuse</span><br><span class="line">     option process-uuid CTX_ID:da279c3e-54cc-4d0e-b921-1395feeeae9a-GRAPH_ID:0-PID:93273-HOST:ai-storage-prd-10-193-189-153.v-bj-4.vivo.lan-PC_NAME:rep3_vol-client-18-RECON_NO:-0</span><br><span class="line">     option fops-version 1298437</span><br><span class="line">     option ping-timeout 42</span><br><span class="line">     option remote-host 10.193.189.153</span><br><span class="line">     option remote-subvolume &#x2F;data7&#x2F;brick_rep3_vol</span><br><span class="line">     option transport-type socket</span><br><span class="line">     option transport.address-family inet</span><br><span class="line">     option username bdb0a45d-e70d-445d-8fe6-76118dfdb738</span><br><span class="line">     option password 7e9a1877-0837-4563-b73d-aa4cde754c91</span><br><span class="line">     option transport.socket.ssl-enabled off</span><br><span class="line">     option transport.tcp-user-timeout 0</span><br><span class="line">     option transport.socket.keepalive-time 20</span><br><span class="line">     option transport.socket.keepalive-interval 2</span><br><span class="line">     option transport.socket.keepalive-count 9</span><br><span class="line">     option send-gids true</span><br><span class="line"> end-volume</span><br><span class="line">  </span><br><span class="line"> volume rep3_vol-client-19</span><br><span class="line">     type protocol&#x2F;client</span><br><span class="line">     option opversion 70200</span><br><span class="line">     option clnt-lk-version 1</span><br><span class="line">     option volfile-checksum 0</span><br><span class="line">     option volfile-key rep3_vol</span><br><span class="line">     option client-version 2020.05.12</span><br><span class="line">     option process-name fuse</span><br><span class="line">     option process-uuid CTX_ID:da279c3e-54cc-4d0e-b921-1395feeeae9a-GRAPH_ID:0-PID:93273-HOST:ai-storage-prd-10-193-189-153.v-bj-4.vivo.lan-PC_NAME:rep3_vol-client-19-RECON_NO:-0</span><br><span class="line">     option fops-version 1298437</span><br><span class="line">     option ping-timeout 42</span><br><span class="line">     option remote-host 10.193.189.154</span><br><span class="line">     option remote-subvolume &#x2F;data7&#x2F;brick_rep3_vol</span><br><span class="line">     option transport-type socket</span><br><span class="line">     option transport.address-family inet</span><br><span class="line">     option username bdb0a45d-e70d-445d-8fe6-76118dfdb738</span><br><span class="line">     option password 7e9a1877-0837-4563-b73d-aa4cde754c91</span><br><span class="line">     option transport.socket.ssl-enabled off</span><br><span class="line">     option transport.tcp-user-timeout 0</span><br><span class="line">     option transport.socket.keepalive-time 20</span><br><span class="line">     option transport.socket.keepalive-interval 2</span><br><span class="line">     option transport.socket.keepalive-count 9</span><br><span class="line">     option send-gids true</span><br><span class="line"> end-volume</span><br><span class="line">  </span><br><span class="line"> volume rep3_vol-client-20</span><br><span class="line">     type protocol&#x2F;client</span><br><span class="line">     option opversion 70200</span><br><span class="line">     option clnt-lk-version 1</span><br><span class="line">     option volfile-checksum 0</span><br><span class="line">     option volfile-key rep3_vol</span><br><span class="line">     option client-version 2020.05.12</span><br><span class="line">     option process-name fuse</span><br><span class="line">     option process-uuid CTX_ID:da279c3e-54cc-4d0e-b921-1395feeeae9a-GRAPH_ID:0-PID:93273-HOST:ai-storage-prd-10-193-189-153.v-bj-4.vivo.lan-PC_NAME:rep3_vol-client-20-RECON_NO:-0</span><br><span class="line">     option fops-version 1298437</span><br><span class="line">     option ping-timeout 42</span><br><span class="line">     option remote-host 10.193.189.155</span><br><span class="line">     option remote-subvolume &#x2F;data7&#x2F;brick_rep3_vol</span><br><span class="line">     option transport-type socket</span><br><span class="line">     option transport.address-family inet</span><br><span class="line">     option username bdb0a45d-e70d-445d-8fe6-76118dfdb738</span><br><span class="line">     option password 7e9a1877-0837-4563-b73d-aa4cde754c91</span><br><span class="line">     option transport.socket.ssl-enabled off</span><br><span class="line">     option transport.tcp-user-timeout 0</span><br><span class="line">     option transport.socket.keepalive-time 20</span><br><span class="line">     option transport.socket.keepalive-interval 2</span><br><span class="line">     option transport.socket.keepalive-count 9</span><br><span class="line">     option send-gids true</span><br><span class="line"> end-volume</span><br><span class="line">  </span><br><span class="line"> volume rep3_vol-replicate-6</span><br><span class="line">     type cluster&#x2F;replicate</span><br><span class="line">     option afr-pending-xattr rep3_vol-client-18,rep3_vol-client-19,rep3_vol-client-20</span><br><span class="line">     option use-compound-fops off</span><br><span class="line">     subvolumes rep3_vol-client-18 rep3_vol-client-19 rep3_vol-client-20</span><br><span class="line"> end-volume</span><br><span class="line">  </span><br><span class="line"> volume rep3_vol-client-21</span><br><span class="line">     type protocol&#x2F;client</span><br><span class="line">     option opversion 70200</span><br><span class="line">     option clnt-lk-version 1</span><br><span class="line">     option volfile-checksum 0</span><br><span class="line">     option volfile-key rep3_vol</span><br><span class="line">     option client-version 2020.05.12</span><br><span class="line">     option process-name fuse</span><br><span class="line">     option process-uuid CTX_ID:da279c3e-54cc-4d0e-b921-1395feeeae9a-GRAPH_ID:0-PID:93273-HOST:ai-storage-prd-10-193-189-153.v-bj-4.vivo.lan-PC_NAME:rep3_vol-client-21-RECON_NO:-0</span><br><span class="line">     option fops-version 1298437</span><br><span class="line">     option ping-timeout 42</span><br><span class="line">     option remote-host 10.193.189.153</span><br><span class="line">     option remote-subvolume &#x2F;data8&#x2F;brick_rep3_vol</span><br><span class="line">     option transport-type socket</span><br><span class="line">     option transport.address-family inet</span><br><span class="line">     option username bdb0a45d-e70d-445d-8fe6-76118dfdb738</span><br><span class="line">     option password 7e9a1877-0837-4563-b73d-aa4cde754c91</span><br><span class="line">     option transport.socket.ssl-enabled off</span><br><span class="line">     option transport.tcp-user-timeout 0</span><br><span class="line">     option transport.socket.keepalive-time 20</span><br><span class="line">     option transport.socket.keepalive-interval 2</span><br><span class="line">     option transport.socket.keepalive-count 9</span><br><span class="line">     option send-gids true</span><br><span class="line"> end-volume</span><br><span class="line">  </span><br><span class="line"> volume rep3_vol-client-22</span><br><span class="line">     type protocol&#x2F;client</span><br><span class="line">     option opversion 70200</span><br><span class="line">     option clnt-lk-version 1</span><br><span class="line">     option volfile-checksum 0</span><br><span class="line">     option volfile-key rep3_vol</span><br><span class="line">     option client-version 2020.05.12</span><br><span class="line">     option process-name fuse</span><br><span class="line">     option process-uuid CTX_ID:da279c3e-54cc-4d0e-b921-1395feeeae9a-GRAPH_ID:0-PID:93273-HOST:ai-storage-prd-10-193-189-153.v-bj-4.vivo.lan-PC_NAME:rep3_vol-client-22-RECON_NO:-0</span><br><span class="line">     option fops-version 1298437</span><br><span class="line">     option ping-timeout 42</span><br><span class="line">     option remote-host 10.193.189.154</span><br><span class="line">     option remote-subvolume &#x2F;data8&#x2F;brick_rep3_vol</span><br><span class="line">     option transport-type socket</span><br><span class="line">     option transport.address-family inet</span><br><span class="line">     option username bdb0a45d-e70d-445d-8fe6-76118dfdb738</span><br><span class="line">     option password 7e9a1877-0837-4563-b73d-aa4cde754c91</span><br><span class="line">     option transport.socket.ssl-enabled off</span><br><span class="line">     option transport.tcp-user-timeout 0</span><br><span class="line">     option transport.socket.keepalive-time 20</span><br><span class="line">     option transport.socket.keepalive-interval 2</span><br><span class="line">     option transport.socket.keepalive-count 9</span><br><span class="line">     option send-gids true</span><br><span class="line"> end-volume</span><br><span class="line">  </span><br><span class="line"> volume rep3_vol-client-23</span><br><span class="line">     type protocol&#x2F;client</span><br><span class="line">     option opversion 70200</span><br><span class="line">     option clnt-lk-version 1</span><br><span class="line">     option volfile-checksum 0</span><br><span class="line">     option volfile-key rep3_vol</span><br><span class="line">     option client-version 2020.05.12</span><br><span class="line">     option process-name fuse</span><br><span class="line">     option process-uuid CTX_ID:da279c3e-54cc-4d0e-b921-1395feeeae9a-GRAPH_ID:0-PID:93273-HOST:ai-storage-prd-10-193-189-153.v-bj-4.vivo.lan-PC_NAME:rep3_vol-client-23-RECON_NO:-0</span><br><span class="line">     option fops-version 1298437</span><br><span class="line">     option ping-timeout 42</span><br><span class="line">     option remote-host 10.193.189.155</span><br><span class="line">     option remote-subvolume &#x2F;data8&#x2F;brick_rep3_vol</span><br><span class="line">     option transport-type socket</span><br><span class="line">     option transport.address-family inet</span><br><span class="line">     option username bdb0a45d-e70d-445d-8fe6-76118dfdb738</span><br><span class="line">     option password 7e9a1877-0837-4563-b73d-aa4cde754c91</span><br><span class="line">     option transport.socket.ssl-enabled off</span><br><span class="line">     option transport.tcp-user-timeout 0</span><br><span class="line">     option transport.socket.keepalive-time 20</span><br><span class="line">     option transport.socket.keepalive-interval 2</span><br><span class="line">     option transport.socket.keepalive-count 9</span><br><span class="line">     option send-gids true</span><br><span class="line"> end-volume</span><br><span class="line">  </span><br><span class="line"> volume rep3_vol-replicate-7</span><br><span class="line">     type cluster&#x2F;replicate</span><br><span class="line">     option afr-pending-xattr rep3_vol-client-21,rep3_vol-client-22,rep3_vol-client-23</span><br><span class="line">     option use-compound-fops off</span><br><span class="line">     subvolumes rep3_vol-client-21 rep3_vol-client-22 rep3_vol-client-23</span><br><span class="line"> end-volume</span><br><span class="line">  </span><br><span class="line"> volume rep3_vol-client-24</span><br><span class="line">     type protocol&#x2F;client</span><br><span class="line">     option opversion 70200</span><br><span class="line">     option clnt-lk-version 1</span><br><span class="line">     option volfile-checksum 0</span><br><span class="line">     option volfile-key rep3_vol</span><br><span class="line">     option client-version 2020.05.12</span><br><span class="line">     option process-name fuse</span><br><span class="line">     option process-uuid CTX_ID:da279c3e-54cc-4d0e-b921-1395feeeae9a-GRAPH_ID:0-PID:93273-HOST:ai-storage-prd-10-193-189-153.v-bj-4.vivo.lan-PC_NAME:rep3_vol-client-24-RECON_NO:-0</span><br><span class="line">     option fops-version 1298437</span><br><span class="line">     option ping-timeout 42</span><br><span class="line">     option remote-host 10.193.189.153</span><br><span class="line">     option remote-subvolume &#x2F;data9&#x2F;brick_rep3_vol</span><br><span class="line">     option transport-type socket</span><br><span class="line">     option transport.address-family inet</span><br><span class="line">     option username bdb0a45d-e70d-445d-8fe6-76118dfdb738</span><br><span class="line">     option password 7e9a1877-0837-4563-b73d-aa4cde754c91</span><br><span class="line">     option transport.socket.ssl-enabled off</span><br><span class="line">     option transport.tcp-user-timeout 0</span><br><span class="line">     option transport.socket.keepalive-time 20</span><br><span class="line">     option transport.socket.keepalive-interval 2</span><br><span class="line">     option transport.socket.keepalive-count 9</span><br><span class="line">     option send-gids true</span><br><span class="line"> end-volume</span><br><span class="line">  </span><br><span class="line"> volume rep3_vol-client-25</span><br><span class="line">     type protocol&#x2F;client</span><br><span class="line">     option opversion 70200</span><br><span class="line">     option clnt-lk-version 1</span><br><span class="line">     option volfile-checksum 0</span><br><span class="line">     option volfile-key rep3_vol</span><br><span class="line">     option client-version 2020.05.12</span><br><span class="line">     option process-name fuse</span><br><span class="line">     option process-uuid CTX_ID:da279c3e-54cc-4d0e-b921-1395feeeae9a-GRAPH_ID:0-PID:93273-HOST:ai-storage-prd-10-193-189-153.v-bj-4.vivo.lan-PC_NAME:rep3_vol-client-25-RECON_NO:-0</span><br><span class="line">     option fops-version 1298437</span><br><span class="line">     option ping-timeout 42</span><br><span class="line">     option remote-host 10.193.189.154</span><br><span class="line">     option remote-subvolume &#x2F;data9&#x2F;brick_rep3_vol</span><br><span class="line">     option transport-type socket</span><br><span class="line">     option transport.address-family inet</span><br><span class="line">     option username bdb0a45d-e70d-445d-8fe6-76118dfdb738</span><br><span class="line">     option password 7e9a1877-0837-4563-b73d-aa4cde754c91</span><br><span class="line">     option transport.socket.ssl-enabled off</span><br><span class="line">     option transport.tcp-user-timeout 0</span><br><span class="line">     option transport.socket.keepalive-time 20</span><br><span class="line">     option transport.socket.keepalive-interval 2</span><br><span class="line">     option transport.socket.keepalive-count 9</span><br><span class="line">     option send-gids true</span><br><span class="line"> end-volume</span><br><span class="line">  </span><br><span class="line"> volume rep3_vol-client-26</span><br><span class="line">     type protocol&#x2F;client</span><br><span class="line">     option opversion 70200</span><br><span class="line">     option clnt-lk-version 1</span><br><span class="line">     option volfile-checksum 0</span><br><span class="line">     option volfile-key rep3_vol</span><br><span class="line">     option client-version 2020.05.12</span><br><span class="line">     option process-name fuse</span><br><span class="line">     option process-uuid CTX_ID:da279c3e-54cc-4d0e-b921-1395feeeae9a-GRAPH_ID:0-PID:93273-HOST:ai-storage-prd-10-193-189-153.v-bj-4.vivo.lan-PC_NAME:rep3_vol-client-26-RECON_NO:-0</span><br><span class="line">     option fops-version 1298437</span><br><span class="line">     option ping-timeout 42</span><br><span class="line">     option remote-host 10.193.189.155</span><br><span class="line">     option remote-subvolume &#x2F;data9&#x2F;brick_rep3_vol</span><br><span class="line">     option transport-type socket</span><br><span class="line">     option transport.address-family inet</span><br><span class="line">     option username bdb0a45d-e70d-445d-8fe6-76118dfdb738</span><br><span class="line">     option password 7e9a1877-0837-4563-b73d-aa4cde754c91</span><br><span class="line">     option transport.socket.ssl-enabled off</span><br><span class="line">     option transport.tcp-user-timeout 0</span><br><span class="line">     option transport.socket.keepalive-time 20</span><br><span class="line">     option transport.socket.keepalive-interval 2</span><br><span class="line">     option transport.socket.keepalive-count 9</span><br><span class="line">     option send-gids true</span><br><span class="line"> end-volume</span><br><span class="line">  </span><br><span class="line"> volume rep3_vol-replicate-8</span><br><span class="line">     type cluster&#x2F;replicate</span><br><span class="line">     option afr-pending-xattr rep3_vol-client-24,rep3_vol-client-25,rep3_vol-client-26</span><br><span class="line">     option use-compound-fops off</span><br><span class="line">     subvolumes rep3_vol-client-24 rep3_vol-client-25 rep3_vol-client-26</span><br><span class="line"> end-volume</span><br><span class="line">  </span><br><span class="line"> volume rep3_vol-client-27</span><br><span class="line">     type protocol&#x2F;client</span><br><span class="line">     option opversion 70200</span><br><span class="line">     option clnt-lk-version 1</span><br><span class="line">     option volfile-checksum 0</span><br><span class="line">     option volfile-key rep3_vol</span><br><span class="line">     option client-version 2020.05.12</span><br><span class="line">     option process-name fuse</span><br><span class="line">     option process-uuid CTX_ID:da279c3e-54cc-4d0e-b921-1395feeeae9a-GRAPH_ID:0-PID:93273-HOST:ai-storage-prd-10-193-189-153.v-bj-4.vivo.lan-PC_NAME:rep3_vol-client-27-RECON_NO:-0</span><br><span class="line">     option fops-version 1298437</span><br><span class="line">     option ping-timeout 42</span><br><span class="line">     option remote-host 10.193.189.153</span><br><span class="line">     option remote-subvolume &#x2F;data10&#x2F;brick_rep3_vol</span><br><span class="line">     option transport-type socket</span><br><span class="line">     option transport.address-family inet</span><br><span class="line">     option username bdb0a45d-e70d-445d-8fe6-76118dfdb738</span><br><span class="line">     option password 7e9a1877-0837-4563-b73d-aa4cde754c91</span><br><span class="line">     option transport.socket.ssl-enabled off</span><br><span class="line">     option transport.tcp-user-timeout 0</span><br><span class="line">     option transport.socket.keepalive-time 20</span><br><span class="line">     option transport.socket.keepalive-interval 2</span><br><span class="line">     option transport.socket.keepalive-count 9</span><br><span class="line">     option send-gids true</span><br><span class="line"> end-volume</span><br><span class="line">  </span><br><span class="line"> volume rep3_vol-client-28</span><br><span class="line">     type protocol&#x2F;client</span><br><span class="line">     option opversion 70200</span><br><span class="line">     option clnt-lk-version 1</span><br><span class="line">     option volfile-checksum 0</span><br><span class="line">     option volfile-key rep3_vol</span><br><span class="line">     option client-version 2020.05.12</span><br><span class="line">     option process-name fuse</span><br><span class="line">     option process-uuid CTX_ID:da279c3e-54cc-4d0e-b921-1395feeeae9a-GRAPH_ID:0-PID:93273-HOST:ai-storage-prd-10-193-189-153.v-bj-4.vivo.lan-PC_NAME:rep3_vol-client-28-RECON_NO:-0</span><br><span class="line">     option fops-version 1298437</span><br><span class="line">     option ping-timeout 42</span><br><span class="line">     option remote-host 10.193.189.154</span><br><span class="line">     option remote-subvolume &#x2F;data10&#x2F;brick_rep3_vol</span><br><span class="line">     option transport-type socket</span><br><span class="line">     option transport.address-family inet</span><br><span class="line">     option username bdb0a45d-e70d-445d-8fe6-76118dfdb738</span><br><span class="line">     option password 7e9a1877-0837-4563-b73d-aa4cde754c91</span><br><span class="line">     option transport.socket.ssl-enabled off</span><br><span class="line">     option transport.tcp-user-timeout 0</span><br><span class="line">     option transport.socket.keepalive-time 20</span><br><span class="line">     option transport.socket.keepalive-interval 2</span><br><span class="line">     option transport.socket.keepalive-count 9</span><br><span class="line">     option send-gids true</span><br><span class="line"> end-volume</span><br><span class="line">  </span><br><span class="line"> volume rep3_vol-client-29</span><br><span class="line">     type protocol&#x2F;client</span><br><span class="line">     option opversion 70200</span><br><span class="line">     option clnt-lk-version 1</span><br><span class="line">     option volfile-checksum 0</span><br><span class="line">     option volfile-key rep3_vol</span><br><span class="line">     option client-version 2020.05.12</span><br><span class="line">     option process-name fuse</span><br><span class="line">     option process-uuid CTX_ID:da279c3e-54cc-4d0e-b921-1395feeeae9a-GRAPH_ID:0-PID:93273-HOST:ai-storage-prd-10-193-189-153.v-bj-4.vivo.lan-PC_NAME:rep3_vol-client-29-RECON_NO:-0</span><br><span class="line">     option fops-version 1298437</span><br><span class="line">     option ping-timeout 42</span><br><span class="line">     option remote-host 10.193.189.155</span><br><span class="line">     option remote-subvolume &#x2F;data10&#x2F;brick_rep3_vol</span><br><span class="line">     option transport-type socket</span><br><span class="line">     option transport.address-family inet</span><br><span class="line">     option username bdb0a45d-e70d-445d-8fe6-76118dfdb738</span><br><span class="line">     option password 7e9a1877-0837-4563-b73d-aa4cde754c91</span><br><span class="line">     option transport.socket.ssl-enabled off</span><br><span class="line">     option transport.tcp-user-timeout 0</span><br><span class="line">     option transport.socket.keepalive-time 20</span><br><span class="line">     option transport.socket.keepalive-interval 2</span><br><span class="line">     option transport.socket.keepalive-count 9</span><br><span class="line">     option send-gids true</span><br><span class="line"> end-volume</span><br><span class="line">  </span><br><span class="line"> volume rep3_vol-replicate-9</span><br><span class="line">     type cluster&#x2F;replicate</span><br><span class="line">     option afr-pending-xattr rep3_vol-client-27,rep3_vol-client-28,rep3_vol-client-29</span><br><span class="line">     option use-compound-fops off</span><br><span class="line">     subvolumes rep3_vol-client-27 rep3_vol-client-28 rep3_vol-client-29</span><br><span class="line"> end-volume</span><br><span class="line">  </span><br><span class="line"> volume rep3_vol-client-30</span><br><span class="line">     type protocol&#x2F;client</span><br><span class="line">     option opversion 70200</span><br><span class="line">     option clnt-lk-version 1</span><br><span class="line">     option volfile-checksum 0</span><br><span class="line">     option volfile-key rep3_vol</span><br><span class="line">     option client-version 2020.05.12</span><br><span class="line">     option process-name fuse</span><br><span class="line">     option process-uuid CTX_ID:da279c3e-54cc-4d0e-b921-1395feeeae9a-GRAPH_ID:0-PID:93273-HOST:ai-storage-prd-10-193-189-153.v-bj-4.vivo.lan-PC_NAME:rep3_vol-client-30-RECON_NO:-0</span><br><span class="line">     option fops-version 1298437</span><br><span class="line">     option ping-timeout 42</span><br><span class="line">     option remote-host 10.193.189.153</span><br><span class="line">     option remote-subvolume &#x2F;data11&#x2F;brick_rep3_vol</span><br><span class="line">     option transport-type socket</span><br><span class="line">     option transport.address-family inet</span><br><span class="line">     option username bdb0a45d-e70d-445d-8fe6-76118dfdb738</span><br><span class="line">     option password 7e9a1877-0837-4563-b73d-aa4cde754c91</span><br><span class="line">     option transport.socket.ssl-enabled off</span><br><span class="line">     option transport.tcp-user-timeout 0</span><br><span class="line">     option transport.socket.keepalive-time 20</span><br><span class="line">     option transport.socket.keepalive-interval 2</span><br><span class="line">     option transport.socket.keepalive-count 9</span><br><span class="line">     option send-gids true</span><br><span class="line"> end-volume</span><br><span class="line">  </span><br><span class="line"> volume rep3_vol-client-31</span><br><span class="line">     type protocol&#x2F;client</span><br><span class="line">     option opversion 70200</span><br><span class="line">     option clnt-lk-version 1</span><br><span class="line">     option volfile-checksum 0</span><br><span class="line">     option volfile-key rep3_vol</span><br><span class="line">     option client-version 2020.05.12</span><br><span class="line">     option process-name fuse</span><br><span class="line">     option process-uuid CTX_ID:da279c3e-54cc-4d0e-b921-1395feeeae9a-GRAPH_ID:0-PID:93273-HOST:ai-storage-prd-10-193-189-153.v-bj-4.vivo.lan-PC_NAME:rep3_vol-client-31-RECON_NO:-0</span><br><span class="line">     option fops-version 1298437</span><br><span class="line">     option ping-timeout 42</span><br><span class="line">     option remote-host 10.193.189.154</span><br><span class="line">     option remote-subvolume &#x2F;data11&#x2F;brick_rep3_vol</span><br><span class="line">     option transport-type socket</span><br><span class="line">     option transport.address-family inet</span><br><span class="line">     option username bdb0a45d-e70d-445d-8fe6-76118dfdb738</span><br><span class="line">     option password 7e9a1877-0837-4563-b73d-aa4cde754c91</span><br><span class="line">     option transport.socket.ssl-enabled off</span><br><span class="line">     option transport.tcp-user-timeout 0</span><br><span class="line">     option transport.socket.keepalive-time 20</span><br><span class="line">     option transport.socket.keepalive-interval 2</span><br><span class="line">     option transport.socket.keepalive-count 9</span><br><span class="line">     option send-gids true</span><br><span class="line"> end-volume</span><br><span class="line">  </span><br><span class="line"> volume rep3_vol-client-32</span><br><span class="line">     type protocol&#x2F;client</span><br><span class="line">     option opversion 70200</span><br><span class="line">     option clnt-lk-version 1</span><br><span class="line">     option volfile-checksum 0</span><br><span class="line">     option volfile-key rep3_vol</span><br><span class="line">     option client-version 2020.05.12</span><br><span class="line">     option process-name fuse</span><br><span class="line">     option process-uuid CTX_ID:da279c3e-54cc-4d0e-b921-1395feeeae9a-GRAPH_ID:0-PID:93273-HOST:ai-storage-prd-10-193-189-153.v-bj-4.vivo.lan-PC_NAME:rep3_vol-client-32-RECON_NO:-0</span><br><span class="line">     option fops-version 1298437</span><br><span class="line">     option ping-timeout 42</span><br><span class="line">     option remote-host 10.193.189.155</span><br><span class="line">     option remote-subvolume &#x2F;data11&#x2F;brick_rep3_vol</span><br><span class="line">     option transport-type socket</span><br><span class="line">     option transport.address-family inet</span><br><span class="line">     option username bdb0a45d-e70d-445d-8fe6-76118dfdb738</span><br><span class="line">     option password 7e9a1877-0837-4563-b73d-aa4cde754c91</span><br><span class="line">     option transport.socket.ssl-enabled off</span><br><span class="line">     option transport.tcp-user-timeout 0</span><br><span class="line">     option transport.socket.keepalive-time 20</span><br><span class="line">     option transport.socket.keepalive-interval 2</span><br><span class="line">     option transport.socket.keepalive-count 9</span><br><span class="line">0-06-10 08:15:10.480043] D [MSGID: 0] [common-utils.c:532:gf_resolve_ip6] 0-resolver: returning ip-10.193.189.154 (port-24007) for hostname: 10.193.189.154 and port: 24007 </span><br><span class="line">     option send-gids true</span><br><span class="line"> end-volume</span><br><span class="line">  </span><br><span class="line"> volume rep3_vol-replicate-10</span><br><span class="line">     type cluster&#x2F;replicate</span><br><span class="line">     option afr-pending-xattr rep3_vol-client-30,rep3_vol-client-31,rep3_vol-client-32</span><br><span class="line">     option use-compound-fops off</span><br><span class="line">     subvolumes rep3_vol-client-30 rep3_vol-client-31 rep3_vol-client-32</span><br><span class="line"> end-volume</span><br><span class="line">  </span><br><span class="line"> volume rep3_vol-client-33</span><br><span class="line">     type protocol&#x2F;client</span><br><span class="line">     option opversion 70200</span><br><span class="line">     option clnt-lk-version 1</span><br><span class="line">     option volfile-checksum 0</span><br><span class="line">     option volfile-key rep3_vol</span><br><span class="line">     option client-version 2020.05.12</span><br><span class="line">     option process-name fuse</span><br><span class="line">     option process-uuid CTX_ID:da279c3e-54cc-4d0e-b921-1395feeeae9a-GRAPH_ID:0-PID:93273-HOST:ai-storage-prd-10-193-189-153.v-bj-4.vivo.lan-PC_NAME:rep3_vol-client-33-RECON_NO:-0</span><br><span class="line">     option fops-version 1298437</span><br><span class="line">     option ping-timeout 42</span><br><span class="line">     option remote-host 10.193.189.153</span><br><span class="line">     option remote-subvolume &#x2F;data12&#x2F;brick_rep3_vol</span><br><span class="line">     option transport-type socket</span><br><span class="line">     option transport.address-family inet</span><br><span class="line">     option username bdb0a45d-e70d-445d-8fe6-76118dfdb738</span><br><span class="line">     option password 7e9a1877-0837-4563-b73d-aa4cde754c91</span><br><span class="line">     option transport.socket.ssl-enabled off</span><br><span class="line">     option transport.tcp-user-timeout 0</span><br><span class="line">     option transport.socket.keepalive-time 20</span><br><span class="line">     option transport.socket.keepalive-interval 2</span><br><span class="line">     option transport.socket.keepalive-count 9</span><br><span class="line">     option send-gids true</span><br><span class="line"> end-volume</span><br><span class="line">  </span><br><span class="line"> volume rep3_vol-client-34</span><br><span class="line">     type protocol&#x2F;client</span><br><span class="line">     option ping-timeout 42</span><br><span class="line">     option remote-host 10.193.189.154</span><br><span class="line">     option remote-subvolume &#x2F;data12&#x2F;brick_rep3_vol</span><br><span class="line">     option transport-type socket</span><br><span class="line">     option transport.address-family inet</span><br><span class="line">     option username bdb0a45d-e70d-445d-8fe6-76118dfdb738</span><br><span class="line">     option password 7e9a1877-0837-4563-b73d-aa4cde754c91</span><br><span class="line">     option transport.socket.ssl-enabled off</span><br><span class="line">     option transport.tcp-user-timeout 0</span><br><span class="line">     option transport.socket.keepalive-time 20</span><br><span class="line">     option transport.socket.keepalive-interval 2</span><br><span class="line">     option transport.socket.keepalive-count 9</span><br><span class="line">     option send-gids true</span><br><span class="line"> end-volume</span><br><span class="line">  </span><br><span class="line"> volume rep3_vol-client-35</span><br><span class="line">     type protocol&#x2F;client</span><br><span class="line">     option ping-timeout 42</span><br><span class="line">     option remote-host 10.193.189.155</span><br><span class="line">     option remote-subvolume &#x2F;data12&#x2F;brick_rep3_vol</span><br><span class="line">     option transport-type socket</span><br><span class="line">     option transport.address-family inet</span><br><span class="line">     option username bdb0a45d-e70d-445d-8fe6-76118dfdb738</span><br><span class="line">     option password 7e9a1877-0837-4563-b73d-aa4cde754c91</span><br><span class="line">     option transport.socket.ssl-enabled off</span><br><span class="line">     option transport.tcp-user-timeout 0</span><br><span class="line">     option transport.socket.keepalive-time 20</span><br><span class="line">     option transport.socket.keepalive-interval 2</span><br><span class="line">     option transport.socket.keepalive-count 9</span><br><span class="line">     option send-gids true</span><br><span class="line"> end-volume</span><br><span class="line">  </span><br><span class="line"> volume rep3_vol-replicate-11</span><br><span class="line">     type cluster&#x2F;replicate</span><br><span class="line">     option afr-pending-xattr rep3_vol-client-33,rep3_vol-client-34,rep3_vol-client-35</span><br><span class="line">     option use-compound-fops off</span><br><span class="line">     subvolumes rep3_vol-client-33 rep3_vol-client-34 rep3_vol-client-35</span><br><span class="line"> end-volume</span><br><span class="line">  </span><br><span class="line"> volume rep3_vol-dht</span><br><span class="line">     type cluster&#x2F;distribute</span><br><span class="line">     option lock-migration off</span><br><span class="line">     option force-migration off</span><br><span class="line">0-06-10 08:15:10.480240] I [MSGID: 114046] [client-handshake.c:1105:client_setvolume_cbk] 0-rep3_vol-client-33: Connected to rep3_vol-client-33, attached to remote volume &#39;&#x2F;data12&#x2F;brick_rep3_vol&#39;. </span><br><span class="line">     subvolumes rep3_vol-replicate-0 rep3_vol-replicate-1 rep3_vol-replicate-2 rep3_vol-replicate-3 rep3_vol-replicate-4 rep3_vol-replicate-5 rep3_vol-replicate-6 rep3_vol-replicate-7 rep3_vol-replicate-8 rep3_vol-replicate-9 rep3_vol-replicate-10 rep3_vol-replicate-11</span><br><span class="line"> end-volume</span><br><span class="line">  </span><br><span class="line">0-06-10 08:15:10.480280] D [MSGID: 0] [client-handshake.c:945:client_post_handshake] 0-rep3_vol-client-33: No fds to open - notifying all parents child up </span><br><span class="line"> volume rep3_vol-shard</span><br><span class="line">     type features&#x2F;shard</span><br><span class="line">     option shard-block-size 8GB</span><br><span class="line">     subvolumes rep3_vol-dht</span><br><span class="line"> end-volume</span><br><span class="line">  </span><br><span class="line"> volume rep3_vol-utime</span><br><span class="line">0-06-10 08:15:10.480305] D [MSGID: 0] [afr-common.c:5209:afr_get_halo_latency] 0-rep3_vol-replicate-11: Using halo latency 5 </span><br><span class="line">     type features&#x2F;utime</span><br><span class="line">     option noatime on</span><br><span class="line">0-06-10 08:15:10.480343] I [MSGID: 108005] [afr-common.c:5293:__afr_handle_child_up_event] 0-rep3_vol-replicate-11: Subvolume &#39;rep3_vol-client-33&#39; came back up; going online. </span><br><span class="line">     subvolumes rep3_vol-shard</span><br><span class="line"> end-volume</span><br><span class="line">  </span><br><span class="line"> volume rep3_vol-write-behind</span><br><span class="line">     type performance&#x2F;write-behind</span><br><span class="line">     subvolumes rep3_vol-utime</span><br><span class="line"> end-volume</span><br><span class="line">  </span><br><span class="line"> volume rep3_vol-read-ahead</span><br><span class="line">     type performance&#x2F;read-ahead</span><br><span class="line">     subvolumes rep3_vol-write-behind</span><br><span class="line"> end-volume</span><br><span class="line">  </span><br><span class="line"> volume rep3_vol-readdir-ahead</span><br><span class="line">     type performance&#x2F;readdir-ahead</span><br><span class="line">     option parallel-readdir off</span><br><span class="line">     option rda-request-size 131072</span><br><span class="line">     option rda-cache-limit 10MB</span><br><span class="line">     subvolumes rep3_vol-read-ahead</span><br><span class="line"> end-volume</span><br><span class="line">  </span><br><span class="line"> volume rep3_vol-io-cache</span><br><span class="line">0-06-10 08:15:10.480407] D [MSGID: 0] [client.c:2323:client_rpc_notify] 0-rep3_vol-client-35: got RPC_CLNT_CONNECT </span><br><span class="line">     type performance&#x2F;io-cache</span><br><span class="line">     subvolumes rep3_vol-readdir-ahead</span><br><span class="line"> end-volume</span><br><span class="line">  </span><br><span class="line"> volume rep3_vol-open-behind</span><br><span class="line">     type performance&#x2F;open-behind</span><br><span class="line">     subvolumes rep3_vol-io-cache</span><br><span class="line"> end-volume</span><br><span class="line">  </span><br><span class="line"> volume rep3_vol-quick-read</span><br><span class="line">     type performance&#x2F;quick-read</span><br><span class="line">     subvolumes rep3_vol-open-behind</span><br><span class="line"> end-volume</span><br><span class="line">  </span><br><span class="line"> volume rep3_vol-md-cache</span><br><span class="line">     type performance&#x2F;md-cache</span><br><span class="line">     option cache-posix-acl true</span><br><span class="line">     subvolumes rep3_vol-quick-read</span><br><span class="line"> end-volume</span><br><span class="line">  </span><br><span class="line"> volume rep3_vol</span><br><span class="line">     type debug&#x2F;io-stats</span><br><span class="line">     option log-level DEBUG</span><br><span class="line">     option threads 16</span><br><span class="line">     option latency-measurement off</span><br><span class="line">     option count-fop-hits off</span><br><span class="line">     option global-threading off</span><br><span class="line">     subvolumes rep3_vol-md-cache</span><br><span class="line"> end-volume</span><br><span class="line">  </span><br><span class="line"> volume posix-acl-autoload</span><br><span class="line">     type system&#x2F;posix-acl</span><br><span class="line">     subvolumes rep3_vol</span><br><span class="line"> end-volume</span><br><span class="line">  </span><br><span class="line"> volume meta-autoload</span><br><span class="line">     type meta</span><br><span class="line">     subvolumes posix-acl-autoload</span><br><span class="line"> end-volume</span><br><span class="line">  </span><br><span class="line">+------------------------------------------------------------------------------+</span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/06/10/glusterfs%E5%AE%A2%E6%88%B7%E7%AB%AF%E5%A6%82%E4%BD%95cp%E4%B8%80%E4%B8%AA%E6%96%87%E4%BB%B6/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="perrynzhou">
      <meta itemprop="description" content="擅长C/Go编程;https://github.com/perrynzhou。">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="perrynzhou">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/06/10/glusterfs%E5%AE%A2%E6%88%B7%E7%AB%AF%E5%A6%82%E4%BD%95cp%E4%B8%80%E4%B8%AA%E6%96%87%E4%BB%B6/" class="post-title-link" itemprop="url">glusterfs客户端如何cp一个文件?</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2020-06-10 17:31:05 / 修改时间：17:35:53" itemprop="dateCreated datePublished" datetime="2020-06-10T17:31:05+08:00">2020-06-10</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h3 id="glusterfs-fuse简单介绍"><a href="#glusterfs-fuse简单介绍" class="headerlink" title="glusterfs fuse简单介绍"></a>glusterfs fuse简单介绍</h3><pre><code>xlator是glusterfs核心的概念，每个xlator对用一系列函数处理对应的文件操作,glusterfs/glusterfsd/glusterd的三个二进制的入口都是相同的(glusterfs/src/glusterfsd.c)，但是在不同模块的逻辑上处理会加载不同的xlator来完成对应模块功能的操作。glusterfs客户端实现是基于fuse实现了自己的API。如下是glusterfs客户单核心函数调用链(glusterfs/src/glusterfsd.c)</code></pre><h3 id="fuse-请求转发流程"><a href="#fuse-请求转发流程" class="headerlink" title="fuse 请求转发流程"></a>fuse 请求转发流程</h3><p><img src="/2020/06/10/glusterfs%E5%AE%A2%E6%88%B7%E7%AB%AF%E5%A6%82%E4%BD%95cp%E4%B8%80%E4%B8%AA%E6%96%87%E4%BB%B6/glusterfs-process.png" alt></p>
<ul>
<li><p>1.main</p>
<ul>
<li>glusterfs入口函数</li>
</ul>
</li>
<li><p>2.create_fuse_mount</p>
<ul>
<li>设置mount/fuse xlator,调用xlator_set_type初始化这个mount/fuse的模块(实际调用mount/fuse中的xlator的init方法)，这个也是后面我们着重需要讲清楚的模块</li>
</ul>
</li>
<li><p>3.glusterfs_volumes_init</p>
<ul>
<li>根据挂载时候的提供的节点IP，初始化glusterfs客户端需要的信息，比如服务端brick的元数据局，客户端需要加载的哪些xlators</li>
</ul>
</li>
<li><p>4.glusterfs_mgmt_init</p>
<ul>
<li>依据挂载(mount)时候提供的IP，和节点所在glusterd通信获取服务端的brick信息以及需要xlators</li>
</ul>
</li>
<li><p>5.glusterfs_process_volfp</p>
</li>
<li><p>依据获取到的服务端提供的元数据，调用xlator_init初始化，整个客户端glustefs初始化完成,glusterfs 第一个访问的是mount/fuse xlator（这个xlator的配置信息不需要从glusterd请求获取) ，最后访问的是protocol/client的xlator</p>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;* client.so 对应的protocol&#x2F;client 的xlator *&#x2F;</span><br><span class="line">&#x2F;usr&#x2F;local&#x2F;lib&#x2F;glusterfs&#x2F;2020.05.12&#x2F;xlator&#x2F;protocol&#x2F;client.so</span><br><span class="line">&#x2F;* replicate.so 对应cluster&#x2F;replicate,也就是cluster&#x2F;afr 副本卷这块实现 *&#x2F;</span><br><span class="line">&#x2F;usr&#x2F;local&#x2F;lib&#x2F;glusterfs&#x2F;2020.05.12&#x2F;xlator&#x2F;cluster&#x2F;replicate.so</span><br><span class="line">&#x2F;* distribute.so 对应cluster&#x2F;distribute,也就是cluster&#x2F;dht哈希卷的实现 *&#x2F;</span><br><span class="line">&#x2F;usr&#x2F;local&#x2F;lib&#x2F;glusterfs&#x2F;2020.05.12&#x2F;xlator&#x2F;cluster&#x2F;distribute.so</span><br><span class="line">&#x2F;usr&#x2F;local&#x2F;lib&#x2F;glusterfs&#x2F;2020.05.12&#x2F;xlator&#x2F;features&#x2F;utime.so</span><br><span class="line">&#x2F;usr&#x2F;local&#x2F;lib&#x2F;glusterfs&#x2F;2020.05.12&#x2F;xlator&#x2F;performance&#x2F;write-behind.so</span><br><span class="line">&#x2F;usr&#x2F;local&#x2F;lib&#x2F;glusterfs&#x2F;2020.05.12&#x2F;xlator&#x2F;performance&#x2F;read-ahead.so</span><br><span class="line">&#x2F;usr&#x2F;local&#x2F;lib&#x2F;glusterfs&#x2F;2020.05.12&#x2F;xlator&#x2F;performance&#x2F;readdir-ahead.so</span><br><span class="line">&#x2F;usr&#x2F;local&#x2F;lib&#x2F;glusterfs&#x2F;2020.05.12&#x2F;xlator&#x2F;performance&#x2F;io-cache.so</span><br><span class="line">&#x2F;usr&#x2F;local&#x2F;lib&#x2F;glusterfs&#x2F;2020.05.12&#x2F;xlator&#x2F;performance&#x2F;open-behind.so</span><br><span class="line">&#x2F;usr&#x2F;local&#x2F;lib&#x2F;glusterfs&#x2F;2020.05.12&#x2F;xlator&#x2F;performance&#x2F;quick-read.so</span><br><span class="line">&#x2F;usr&#x2F;local&#x2F;lib&#x2F;glusterfs&#x2F;2020.05.12&#x2F;xlator&#x2F;performance&#x2F;md-cache.so</span><br><span class="line">	&#x2F;usr&#x2F;local&#x2F;lib&#x2F;glusterfs&#x2F;2020.05.12&#x2F;xlator&#x2F;debug&#x2F;io-stats.so</span><br></pre></td></tr></table></figure>
<ul>
<li><p>glusterfs_graph_activate</p>
<ul>
<li><p>ctx-&gt;master在初始化时候已经把mount/fuse的xlator赋值给master了，然后在xlator graph激活时候，如果master不为空就执行xlator_notify函数，第一个参数就是mount/fuse的xlator的结构体指针</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">glusterfs_graph_activate(glusterfs_graph_t *graph, glusterfs_ctx_t *ctx)</span><br><span class="line">&#123;</span><br><span class="line">    &#x2F;&#x2F;fuse-bridge.c:notify在这里调用</span><br><span class="line">    if (ctx-&gt;master) &#123;</span><br><span class="line">        ret &#x3D; xlator_notify(ctx-&gt;master, GF_EVENT_GRAPH_NEW, graph)</span><br><span class="line">        ((xlator_t *)ctx-&gt;master)-&gt;next &#x3D; graph-&gt;top;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p>xlator_notify</p>
<ul>
<li>xlator_notify函数主要是调用mount/fuse这个xlator的notify函数多个线程读取/dev/fuse中数据</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">xlator_notify(xlator_t *xl, int event, void *data, ...)</span><br><span class="line">&#123;</span><br><span class="line">	&#x2F;&#x2F;调用mount&#x2F;fuse xlator中的notify函数</span><br><span class="line">     xl-&gt;notify(xl, event, data);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



</li>
</ul>
<ul>
<li><p>notify</p>
<ul>
<li><p>该函数是mount/fuse中的notify函数</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;mount&#x2F;fuse中notify的函数</span><br><span class="line">notify(xlator_t *this, int32_t event, void *data, ...) </span><br><span class="line">&#123;</span><br><span class="line"> 	&#x2F;&#x2F;fork子进程在多线程中执行fuse_thread_proc</span><br><span class="line">	 for (i &#x3D; 0; i &lt; private-&gt;reader_thread_count; i++) &#123;</span><br><span class="line">      	ret &#x3D; gf_thread_create(&amp;private-&gt;fuse_thread[i], 	NULL,fuse_thread_proc, this, &quot;fuseproc&quot;);         </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



</li>
</ul>
</li>
</ul>
<ul>
<li><p>fuse_thread_proc</p>
<ul>
<li>读取/dev/fuse中的数据，转发给对应的fuse_xxx的函数</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;启动线程轮训读取数据，在转发给对应的fuse_xxx函数</span><br><span class="line">fuse_thread_proc(void *data)</span><br><span class="line">&#123;</span><br><span class="line"> 	xlator_t *this &#x3D; NULL;</span><br><span class="line"> 	fuse_private_t *priv &#x3D; NULL;</span><br><span class="line"> 	this &#x3D; data;</span><br><span class="line">  priv &#x3D; this-&gt;private;</span><br><span class="line"></span><br><span class="line">  THIS &#x3D; this;</span><br><span class="line">  &#x2F;&#x2F;在xlator&#x2F;mount&#x2F;fuse源代码模块中init函数中已经把priv-&gt;fd设置为&#x2F;dev&#x2F;fuse的文件描述符</span><br><span class="line">	res &#x3D; sys_readv(priv-&gt;fd, iov_in, 2);</span><br><span class="line">  gf_async(&amp;fasync-&gt;async, this, fuse_dispatch);</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



</li>
</ul>
<ul>
<li><p>fuse_dispatch</p>
<ul>
<li><p>主要是读取到/dev/fuse的数据转发给对应的fuse_xxx函数,比如fuse初始化挂载操作会转发请求到fuse_init函数</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;读取到的数据转发到对应的fuse_ops函数中</span><br><span class="line">fuse_dispatch(xlator_t *xl, gf_async_t *async)</span><br><span class="line">&#123;</span><br><span class="line">	    priv-&gt;fuse_ops[finh-&gt;opcode](xl, finh, fasync-&gt;msg, iobuf);</span><br><span class="line">    &#x2F;&#x2F;priv-&gt;fuse_ops对应的是fuse_std_ops函数指针数组</span><br><span class="line">    priv-&gt;fuse_ops[finh-&gt;opcode](xl, finh, fasync-&gt;msg, iobuf);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li><p>其中priv-&gt;fuse_ops中定义了fuse一系列操作，具体的定义如下</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line">static fuse_handler_t *fuse_std_ops[FUSE_OP_HIGH] &#x3D; &#123;</span><br><span class="line">    [FUSE_LOOKUP] &#x3D; fuse_lookup,</span><br><span class="line">    [FUSE_FORGET] &#x3D; fuse_forget,</span><br><span class="line">    [FUSE_GETATTR] &#x3D; fuse_getattr,</span><br><span class="line">    [FUSE_SETATTR] &#x3D; fuse_setattr,</span><br><span class="line">    [FUSE_READLINK] &#x3D; fuse_readlink,</span><br><span class="line">    [FUSE_SYMLINK] &#x3D; fuse_symlink,</span><br><span class="line">    [FUSE_MKNOD] &#x3D; fuse_mknod,</span><br><span class="line">    [FUSE_MKDIR] &#x3D; fuse_mkdir,</span><br><span class="line">    [FUSE_UNLINK] &#x3D; fuse_unlink,</span><br><span class="line">    [FUSE_RMDIR] &#x3D; fuse_rmdir,</span><br><span class="line">    [FUSE_RENAME] &#x3D; fuse_rename,</span><br><span class="line">    [FUSE_LINK] &#x3D; fuse_link,</span><br><span class="line">    [FUSE_OPEN] &#x3D; fuse_open,</span><br><span class="line">    [FUSE_READ] &#x3D; fuse_readv,</span><br><span class="line">    [FUSE_WRITE] &#x3D; fuse_write,</span><br><span class="line">    [FUSE_STATFS] &#x3D; fuse_statfs,</span><br><span class="line">    [FUSE_RELEASE] &#x3D; fuse_release,</span><br><span class="line">    [FUSE_FSYNC] &#x3D; fuse_fsync,</span><br><span class="line">    [FUSE_SETXATTR] &#x3D; fuse_setxattr,</span><br><span class="line">    [FUSE_GETXATTR] &#x3D; fuse_getxattr,</span><br><span class="line">    [FUSE_LISTXATTR] &#x3D; fuse_listxattr,</span><br><span class="line">    [FUSE_REMOVEXATTR] &#x3D; fuse_removexattr,</span><br><span class="line">    [FUSE_FLUSH] &#x3D; fuse_flush,</span><br><span class="line">    [FUSE_INIT] &#x3D; fuse_init,</span><br><span class="line">    [FUSE_OPENDIR] &#x3D; fuse_opendir,</span><br><span class="line">    [FUSE_READDIR] &#x3D; fuse_readdir,</span><br><span class="line">    [FUSE_RELEASEDIR] &#x3D; fuse_releasedir,</span><br><span class="line">    [FUSE_FSYNCDIR] &#x3D; fuse_fsyncdir,</span><br><span class="line">    [FUSE_GETLK] &#x3D; fuse_getlk,</span><br><span class="line">    [FUSE_SETLK] &#x3D; fuse_setlk,</span><br><span class="line">    [FUSE_SETLKW] &#x3D; fuse_setlk,</span><br><span class="line">    [FUSE_ACCESS] &#x3D; fuse_access,</span><br><span class="line">    [FUSE_CREATE] &#x3D; fuse_create,</span><br><span class="line">    [FUSE_INTERRUPT] &#x3D; fuse_interrupt,</span><br><span class="line">    &#x2F;* [FUSE_BMAP] *&#x2F;</span><br><span class="line">    [FUSE_DESTROY] &#x3D; fuse_destroy,</span><br><span class="line">&#x2F;* [FUSE_IOCTL] *&#x2F;</span><br><span class="line">&#x2F;* [FUSE_POLL] *&#x2F;</span><br><span class="line">&#x2F;* [FUSE_NOTIFY_REPLY] *&#x2F;</span><br><span class="line"></span><br><span class="line">#if FUSE_KERNEL_MINOR_VERSION &gt;&#x3D; 16</span><br><span class="line">    [FUSE_BATCH_FORGET] &#x3D; fuse_batch_forget,</span><br><span class="line">#endif</span><br><span class="line"></span><br><span class="line">#if FUSE_KERNEL_MINOR_VERSION &gt;&#x3D; 19</span><br><span class="line">#ifdef FALLOC_FL_KEEP_SIZE</span><br><span class="line">    [FUSE_FALLOCATE] &#x3D; fuse_fallocate,</span><br><span class="line">#endif &#x2F;* FALLOC_FL_KEEP_SIZE *&#x2F;</span><br><span class="line">#endif</span><br><span class="line"></span><br><span class="line">#if FUSE_KERNEL_MINOR_VERSION &gt;&#x3D; 21</span><br><span class="line">    [FUSE_READDIRPLUS] &#x3D; fuse_readdirp,</span><br><span class="line">#endif</span><br><span class="line"></span><br><span class="line">#if FUSE_KERNEL_MINOR_VERSION &gt;&#x3D; 24 &amp;&amp; HAVE_SEEK_HOLE</span><br><span class="line">    [FUSE_LSEEK] &#x3D; fuse_lseek,</span><br><span class="line">#endif</span><br><span class="line"></span><br><span class="line">#if FUSE_KERNEL_MINOR_VERSION &gt;&#x3D; 28</span><br><span class="line">    [FUSE_COPY_FILE_RANGE] &#x3D; fuse_copy_file_range,</span><br><span class="line">#endif</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
</ul>
</li>
<li><p>FUSE_FOP</p>
<ul>
<li>FUSE_FOP用于转发当前操作到下一个xlator的fops函数，比如下一个xlator是cluster/dht，dht下一个xlator是cluster/afr,afr最后一个是protocol/client，procotol/client对应的是client4_0_writev函数，把数据通过网络push到对应某个glusterfsd进程。<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">FUSE_FOP(state, fuse_writev_cbk, GF_FOP_WRITE, writev, state-&gt;fd,</span><br><span class="line">            &amp;state-&gt;vector, 1, state-&gt;off, state-&gt;io_flags, iobref,</span><br><span class="line">            state-&gt;xdata);</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>dht_writev<br>  *dht_writev按照哈希卷的方式写入数据</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;cluster&#x2F;dht 的xlator中的dht_writev方法</span><br><span class="line">int dht_writev(call_frame_t *frame, xlator_t *this, fd_t *fd, struct iovec *vector,</span><br><span class="line">           int count, off_t off, uint32_t flags, struct iobref *iobref,</span><br><span class="line">           dict_t *xdata)</span><br><span class="line">&#123;</span><br><span class="line">   	&#x2F;&#x2F;下一个xlator的调用申请</span><br><span class="line">   STACK_WIND_COOKIE(frame, dht_writev_cbk, subvol, subvol,</span><br><span class="line">                      subvol-&gt;fops-&gt;writev, fd, local-&gt;rebalance.vector,</span><br><span class="line">                      local-&gt;rebalance.count, local-&gt;rebalance.offset,</span><br><span class="line">                      local-&gt;rebalance.flags, local-&gt;rebalance.iobref,</span><br><span class="line">                      local-&gt;xattr_req);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>afr_writev</p>
<ul>
<li>副本卷执行写入操作的方法     <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">int afr_writev(call_frame_t *frame, xlator_t *this,...)</span><br><span class="line">&#123;</span><br><span class="line">	 afr_do_writev(frame, this);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>client4_0_writev(protocol/client xlator)</p>
<ul>
<li>procotcol/client中的client4_0_writev是把数据push到某个节点的glusterfsd进程<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; procotol&#x2F;client的xlator的writev方法</span><br><span class="line">int32_t client4_0_writev(call_frame_t *frame, xlator_t *this, void *data)</span><br><span class="line">&#123;</span><br><span class="line">    ret &#x3D; client_submit_request(this, &amp;req, frame, conf-&gt;fops, GFS3_OP_WRITE, client4_0_writev_cbk, &amp;cp,(xdrproc_t)xdr_gfx_write_req);</span><br><span class="line">&#125;</span><br><span class="line">&#x2F;&#x2F;(gdb) p conf-&gt;fops</span><br><span class="line">$99 &#x3D; (rpc_clnt_prog_t *) 0x7fffe9b79c20 &lt;clnt4_0_fop_prog&gt;</span><br></pre></td></tr></table></figure>

</li>
</ul>
</li>
</ul>
<h3 id="mount-fuse-cp文件流程"><a href="#mount-fuse-cp文件流程" class="headerlink" title="mount/fuse cp文件流程"></a>mount/fuse cp文件流程</h3><ul>
<li><p>设计基本思路</p>
<ul>
<li>mount/fuse 这个xlator的实现在xlator/src/mount模块中，该模块以fuse_开头的函数并么有在这个模块中显性中调用，都是通过fuse_std_ops初始化这个一些列函数，在具体执行时候根据这个数组的指针来隐形的调用。针对每个文件系统的操作（比如,ls,rm）都会转发到对应的fuse的函数处理，处理完毕后在走mount/fuse的下一个xlator,走对应xlator的一些列函数。</li>
</ul>
</li>
<li><p>gdb 堆栈的信息</p>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;简化版本</span><br><span class="line">(gdb) bt</span><br><span class="line">#0  afr_writev  at afr-inode-write.c:491</span><br><span class="line">#1  dht_writev  at dht-inode-write.c:223</span><br><span class="line">#2  shard_common_inode_write_wind at shard.c:5397</span><br><span class="line">#3  shard_common_inode_write_do at shard.c:5527</span><br><span class="line">#4 wb_writev at write-behind.c:1897</span><br><span class="line">#5 ra_writev at read-ahead.c:650</span><br><span class="line">#6  rda_writev  at readdir-ahead.c:788</span><br><span class="line">#7 ioc_writev at io-cache.c:1303</span><br><span class="line">#8 default_writev_resume at defaults.c:1983</span><br><span class="line">#9 call_resume_wind  at call-stub.c:2085</span><br><span class="line">#10 call_resume  at call-stub.c:2555</span><br><span class="line">#11 open_and_resume at open-behind.c:485</span><br><span class="line">#12 ob_writev at open-behind.c:683</span><br><span class="line">#13 qr_writev  at quick-read.c:849</span><br><span class="line">#14 mdc_writev  at md-cache.c:2082</span><br><span class="line">#15 io_stats_writev  at io-stats.c:2882</span><br><span class="line">#16 default_writev at defaults.c:2735</span><br><span class="line">#17 meta_writev at meta.c:131</span><br><span class="line">#18  fuse_write_resume  at fuse-bridge.c:2959</span><br><span class="line">#19 fuse_fop_resume at fuse-bridge.c:1030</span><br><span class="line">#20 fuse_resolve_done at fuse-resolve.c:629</span><br><span class="line">#21 fuse_resolve_all at fuse-resolve.c:653</span><br><span class="line">#22 fuse_resolve  at fuse-resolve.c:620</span><br><span class="line">#23 fuse_resolve_all  at fuse-resolve.c:650</span><br><span class="line">#24 fuse_resolve_continue at fuse-resolve.c:668</span><br><span class="line">#25 fuse_resolve_fd at fuse-resolve.c:543</span><br><span class="line">#26 fuse_resolve at fuse-resolve.c:611</span><br><span class="line">#27 fuse_resolve_all  at fuse-resolve.c:644</span><br><span class="line">#28 fuse_resolve_and_resume at fuse-resolve.c:680</span><br><span class="line">#29 fuse_write at fuse-bridge.c:3011</span><br><span class="line">#30 fuse_dispatch at fuse-bridge.c:5838</span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/"><i class="fa fa-angle-left" aria-label="上一页"></i></a><a class="page-number" href="/">1</a><span class="page-number current">2</span><a class="page-number" href="/page/3/">3</a><span class="space">&hellip;</span><a class="page-number" href="/page/6/">6</a><a class="extend next" rel="next" href="/page/3/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">perrynzhou</p>
  <div class="site-description" itemprop="description">擅长C/Go编程;https://github.com/perrynzhou。</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">52</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-tags">
        <span class="site-state-item-count">11</span>
        <span class="site-state-item-name">标签</span>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>



<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">perrynzhou</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://pisces.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Pisces</a> 强力驱动
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  

</body>
</html>
