<!DOCTYPE html>
<html lang="zh-CN">





<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/favicon.png">
  <link rel="icon" type="image/png" href="/img/favicon.png">
  <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="description" content="擅长C/Go编程;https://github.com/perrynzhou。">
  <meta name="author" content="perrynzhou">
  <meta name="keywords" content="C, Go, nginx,glusterfs,redis">
  <title>glusterfsd启动过程 - perrynzhou</title>

  <link  rel="stylesheet" href="https://cdn.staticfile.org/twitter-bootstrap/4.4.1/css/bootstrap.min.css" />


  <link  rel="stylesheet" href="https://cdn.staticfile.org/github-markdown-css/4.0.0/github-markdown.min.css" />
  <link  rel="stylesheet" href="/lib/hint/hint.min.css" />

  
    <link  rel="stylesheet" href="https://cdn.staticfile.org/highlight.js/10.0.0/styles/github-gist.min.css" />
  

  


<!-- 主题依赖的图标库，不要自行修改 -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_yg9cfy8wd6.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_pjno9b9zyxs.css">


<link  rel="stylesheet" href="/css/main.css" />

<!-- 自定义样式保持在最底部 -->


  <script  src="/js/utils.js" ></script>
<meta name="generator" content="Hexo 4.2.0"></head>


<body>
  <header style="height: 70vh;">
    <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand"
       href="/">&nbsp;<strong>Fluid</strong>&nbsp;</a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/">
                <i class="iconfont icon-home-fill"></i>
                首页
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/">
                <i class="iconfont icon-archive-fill"></i>
                归档
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/">
                <i class="iconfont icon-category-fill"></i>
                分类
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/">
                <i class="iconfont icon-tags-fill"></i>
                标签
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/">
                <i class="iconfont icon-user-fill"></i>
                关于
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" data-toggle="modal" data-target="#modalSearch">&nbsp;&nbsp;<i
                class="iconfont icon-search"></i>&nbsp;&nbsp;</a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

    <div class="view intro-2" id="background" parallax=true
         style="background: url('/img/default.png') no-repeat center center;
           background-size: cover;">
      <div class="full-bg-img">
        <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
          <div class="container text-center white-text fadeInUp">
            <span class="h2" id="subtitle">
              
            </span>

            
              
  <div class="mt-3 post-meta">
    <i class="iconfont icon-date-fill" aria-hidden="true"></i>
    <time datetime="2020-04-16 17:11">
      2020年4月16日 下午
    </time>
  </div>


<div class="mt-1">
  
    
    <span class="post-meta mr-2">
      <i class="iconfont icon-chart"></i>
      3.3k 字
    </span>
  

  
    
    <span class="post-meta mr-2">
      <i class="iconfont icon-clock-fill"></i>
      
      
      62
       分钟
    </span>
  

  
  
</div>

            
          </div>

          
        </div>
      </div>
    </div>
  </header>

  <main>
    
      

<div class="container-fluid">
  <div class="row">
    <div class="d-none d-lg-block col-lg-2"></div>
    <div class="col-lg-8 nopadding-md">
      <div class="container nopadding-md" id="board-ctn">
        <div class="py-5" id="board">
          <div class="post-content mx-auto" id="post">
            
            <article class="markdown-body">
              <h6 id="0-存在的疑惑"><a href="#0-存在的疑惑" class="headerlink" title="0.存在的疑惑"></a>0.存在的疑惑</h6><ul>
<li>glusterd启动后怎么把glusterfsd的brick进程拉起来？</li>
<li>glusterfsd启动的参数从哪里获取？</li>
<li>glusterfsd如何加载的呢？</li>
<li>glusterfsd和glusterd启动后各自都是什么角色？(后续再讨论)<h6 id="1-glusterfs的入口函数解释"><a href="#1-glusterfs的入口函数解释" class="headerlink" title="1. glusterfs的入口函数解释"></a>1. glusterfs的入口函数解释</h6></li>
<li>glusterfsd中main方法加载xlator {name = 0x687dd0 “management”, type = 0x687f50 “mgmt/glusterd”}，然后fork一个子进程加载mgmt/glusterd中的init方法<h6 id="2-glusterd启动过程"><a href="#2-glusterd启动过程" class="headerlink" title="2.glusterd启动过程"></a>2.glusterd启动过程</h6></li>
<li>子进程中调用mgmt/glusterd对应源文件中glusterd.c中的init,针对glusterd进行初始化，依次会调用如下方法:<ul>
<li>glusterfs_volumes_init   </li>
<li>glusterd.c:init</li>
<li>glusterd_spawn_daemons</li>
<li>glusterd_restart_bricks</li>
<li>glusterd_brick_start</li>
<li>glusterd_volume_start_glusterfs</li>
<li>runner_run</li>
<li>runner_start:fork子进程，调用execvp加载/usr/local/sbin/glusterfsd二进制文件<pre><code class="hljs reasonml"> <span class="hljs-built_in">int</span> runner<span class="hljs-constructor">_start(<span class="hljs-params">runner_t</span> <span class="hljs-operator">*</span><span class="hljs-params">runner</span>)</span>
 &#123;
        <span class="hljs-comment">//-----忽略----------------</span>
execvp(runner-&gt;argv<span class="hljs-literal">[<span class="hljs-number">0</span>]</span>, runner-&gt;argv);
        <span class="hljs-comment">//-----忽略----------------</span>
 &#125;</code></pre>
<h6 id="3-glusterfsd如何加载xlator"><a href="#3-glusterfsd如何加载xlator" class="headerlink" title="3.glusterfsd如何加载xlator"></a>3.glusterfsd如何加载xlator</h6></li>
</ul>
</li>
<li>glusterfsd是通过读取配置文件/var/lib/glusterd/vols/dht_vol/dht_vol.172.17.0.2.data-brick.vol来加载glusterfsd运行期间需要的xlator，这些配置信息是用户创建volume时候系统生成的<br><img src="/2020/04/16/glusterfsd%E5%90%AF%E5%8A%A8%E8%BF%87%E7%A8%8B/2582954-d6d03fa2881d4dfe.png" srcset="/img/loading.gif" alt></li>
</ul>
<h6 id="4-glusterd启动后进程列表"><a href="#4-glusterd启动后进程列表" class="headerlink" title="4. glusterd启动后进程列表"></a>4. glusterd启动后进程列表</h6><ul>
<li>runner_start后继续glusterfsd.c中的main方法，启动对应的服务，glusterfsd正式启动了，就如systemctl start glusterd后出现如下的结果:<br><img src="/2020/04/16/glusterfsd%E5%90%AF%E5%8A%A8%E8%BF%87%E7%A8%8B/2582954-bb00ca85ed37cff0.png" srcset="/img/loading.gif" alt></li>
</ul>
<h6 id="5-glusterfsd启动流程"><a href="#5-glusterfsd启动流程" class="headerlink" title="5.glusterfsd启动流程"></a>5.glusterfsd启动流程</h6><ul>
<li>上个步骤通过runner_start加载glusterfsd的二进制进程，glusterfsd进入初始化节点，首先 glusterfs_listener_init 初始化tcp连接</li>
<li>glusterfsd通过tcp连接到glusterd获取volume xlator信息，准备构建xlator的graph.</li>
</ul>
<pre><code class="hljs taggerscript">
volume xlator信息如下:

(gdb) p rsp.spec       
$6 = 0x7fffe4002fc0 "volume dht_vol-posix<span class="hljs-symbol">\n</span>    type storage/posix<span class="hljs-symbol">\n</span>    option shared-brick-count 1<span class="hljs-symbol">\n</span>    option volume-id 25305c2d-317f-45e9-8e60-be322ed69ee1<span class="hljs-symbol">\n</span>    option directory /data/brick<span class="hljs-symbol">\n</span>end-volume<span class="hljs-symbol">\n</span><span class="hljs-symbol">\n</span>volume dht_vol-trash<span class="hljs-symbol">\n</span>    type features/trash<span class="hljs-symbol">\n</span>    option trash-internal-op off<span class="hljs-symbol">\n</span>    option brick-path /data/brick<span class="hljs-symbol">\n</span>    option trash-dir .trashcan<span class="hljs-symbol">\n</span>    subvolumes dht_vol-posix<span class="hljs-symbol">\n</span>end-volume<span class="hljs-symbol">\n</span><span class="hljs-symbol">\n</span>volume dht_vol-changelog<span class="hljs-symbol">\n</span>    type features/changelog<span class="hljs-symbol">\n</span>    option changelog-barrier-timeout 120<span class="hljs-symbol">\n</span>    option changelog-dir /data/brick/.glusterfs/changelogs<span class="hljs-symbol">\n</span>    option changelog-brick /data/brick<span class="hljs-symbol">\n</span>    subvolumes dht_vol-trash<span class="hljs-symbol">\n</span>end-volume<span class="hljs-symbol">\n</span><span class="hljs-symbol">\n</span>volume dht_vol-bitrot-stub<span class="hljs-symbol">\n</span>    type features/bitrot-stub<span class="hljs-symbol">\n</span>    option bitrot disable<span class="hljs-symbol">\n</span>    option export /data/brick<span class="hljs-symbol">\n</span>    subvolumes dht_vol-changelog<span class="hljs-symbol">\n</span>end-volume<span class="hljs-symbol">\n</span><span class="hljs-symbol">\n</span>volume dht_vol-access-control<span class="hljs-symbol">\n</span>    type features/access-control<span class="hljs-symbol">\n</span>    subvolumes dht_vol-bitrot-stub<span class="hljs-symbol">\n</span>end-volume<span class="hljs-symbol">\n</span><span class="hljs-symbol">\n</span>volume dht_vol-locks<span class="hljs-symbol">\n</span>    type features/locks<span class="hljs-symbol">\n</span>    option enforce-mandatory-lock off<span class="hljs-symbol">\n</span>    subvolumes dht_vol-access-control<span class="hljs-symbol">\n</span>end-volume<span class="hljs-symbol">\n</span><span class="hljs-symbol">\n</span>volume dht_vol-worm<span class="hljs-symbol">\n</span>    type features/worm<span class="hljs-symbol">\n</span>    option worm-files-deletable on<span class="hljs-symbol">\n</span>    option worm-file-level off<span class="hljs-symbol">\n</span>    option worm off<span class="hljs-symbol">\n</span>    subvolumes dht_vol-locks<span class="hljs-symbol">\n</span>end-volume<span class="hljs-symbol">\n</span><span class="hljs-symbol">\n</span>volume dht_vol-read-only<span class="hljs-symbol">\n</span>    type features/read-only<span class="hljs-symbol">\n</span>    option read-only off<span class="hljs-symbol">\n</span>    subvolumes dht_vol-worm<span class="hljs-symbol">\n</span>end-volume<span class="hljs-symbol">\n</span><span class="hljs-symbol">\n</span>volume dht_vol-leases<span class="hljs-symbol">\n</span>    type features/leases<span class="hljs-symbol">\n</span>    option leases off<span class="hljs-symbol">\n</span>    subvolumes dht_vol-read-only<span class="hljs-symbol">\n</span>end-volume<span class="hljs-symbol">\n</span><span class="hljs-symbol">\n</span>volume dht_vol-upcall<span class="hljs-symbol">\n</span>    type features/upcall<span class="hljs-symbol">\n</span>    option cache-invalidation off<span class="hljs-symbol">\n</span>    subvolumes dht_vol-leases<span class="hljs-symbol">\n</span>end-volume<span class="hljs-symbol">\n</span><span class="hljs-symbol">\n</span>volume dht_vol-io-threads<span class="hljs-symbol">\n</span>    type performance/io-threads<span class="hljs-symbol">\n</span>    subvolumes dht_vol-upcall<span class="hljs-symbol">\n</span>end-volume<span class="hljs-symbol">\n</span><span class="hljs-symbol">\n</span>volume dht_vol-selinux<span class="hljs-symbol">\n</span>    type features/selinux<span class="hljs-symbol">\n</span>    option selinux on<span class="hljs-symbol">\n</span>    subvolumes dht_vol-io-threads<span class="hljs-symbol">\n</span>end-volume<span class="hljs-symbol">\n</span><span class="hljs-symbol">\n</span>volume dht_vol-marker<span class="hljs-symbol">\n</span>    type features/marker<span class="hljs-symbol">\n</span>    option inode-quota off<span class="hljs-symbol">\n</span>    option quota off<span class="hljs-symbol">\n</span>    option gsync-force-xtime off<span class="hljs-symbol">\n</span>    option xtime off<span class="hljs-symbol">\n</span>    option quota-version 0<span class="hljs-symbol">\n</span>    option timestamp-file /var/lib/glusterd/vols/dht_vol/marker.tstamp<span class="hljs-symbol">\n</span>    option volume-uuid 25305c2d-317f-45e9-8e60-be322ed69ee1<span class="hljs-symbol">\n</span>    subvolumes dht_vol-selinux<span class="hljs-symbol">\n</span>end-volume<span class="hljs-symbol">\n</span><span class="hljs-symbol">\n</span>volume dht_vol-barrier<span class="hljs-symbol">\n</span>    type features/barrier<span class="hljs-symbol">\n</span>    option barrier-timeout 120<span class="hljs-symbol">\n</span>    option barrier disable<span class="hljs-symbol">\n</span>    subvolumes dht_vol-marker<span class="hljs-symbol">\n</span>end-volume<span class="hljs-symbol">\n</span><span class="hljs-symbol">\n</span>volume dht_vol-index<span class="hljs-symbol">\n</span>    type features/index<span class="hljs-symbol">\n</span>    option xattrop-pending-watchlist trusted.afr.dht_vol-<span class="hljs-symbol">\n</span>    option xattrop-dirty-watchlist trusted.afr.dirty<span class="hljs-symbol">\n</span>    option index-base /data/brick/.glusterfs/indices<span class="hljs-symbol">\n</span>    subvolumes dht_vol-barrier<span class="hljs-symbol">\n</span>end-volume<span class="hljs-symbol">\n</span><span class="hljs-symbol">\n</span>volume dht_vol-quota<span class="hljs-symbol">\n</span>    type features/quota<span class="hljs-symbol">\n</span>    option deem-statfs off<span class="hljs-symbol">\n</span>    option server-quota off<span class="hljs-symbol">\n</span>    option volume-uuid dht_vol<span class="hljs-symbol">\n</span>    subvolumes dht_vol-index<span class="hljs-symbol">\n</span>end-volume<span class="hljs-symbol">\n</span><span class="hljs-symbol">\n</span>volume dht_vol-io-stats<span class="hljs-symbol">\n</span>    type debug/io-stats<span class="hljs-symbol">\n</span>    option count-fop-hits off<span class="hljs-symbol">\n</span>    option latency-measurement off<span class="hljs-symbol">\n</span>    option log-level INFO<span class="hljs-symbol">\n</span>    option unique-id /data/brick<span class="hljs-symbol">\n</span>    subvolumes dht_vol-quota<span class="hljs-symbol">\n</span>end-volume<span class="hljs-symbol">\n</span><span class="hljs-symbol">\n</span>volume /data/brick<span class="hljs-symbol">\n</span>    type performance/decompounder<span class="hljs-symbol">\n</span>    subvolumes dht_vol-io-stats<span class="hljs-symbol">\n</span>end-volume<span class="hljs-symbol">\n</span><span class="hljs-symbol">\n</span>volume dht_vol-server<span class="hljs-symbol">\n</span>    type protocol/server<span class="hljs-symbol">\n</span>    option transport.listen-backlog 1024<span class="hljs-symbol">\n</span>    option transport.socket.keepalive-count 9<span class="hljs-symbol">\n</span>    option transport.socket.keepalive-interval 2<span class="hljs-symbol">\n</span>    option transport.socket.keepalive-time 20<span class="hljs-symbol">\n</span>    option transport.socket.ssl-enabled off<span class="hljs-symbol">\n</span>    option transport.socket.keepalive 1<span class="hljs-symbol">\n</span>    option auth.addr./data/brick.allow *<span class="hljs-symbol">\n</span>    option auth-path /data/brick<span class="hljs-symbol">\n</span>    option auth.login.b26ac1fd-40a4-4c6e-b211-a9f2b58beedc.password 4eda9afe-9466-4283-b175-6020d5981994<span class="hljs-symbol">\n</span>    option auth.login./data/brick.allow b26ac1fd-40a4-4c6e-b211-a9f2b58beedc<span class="hljs-symbol">\n</span>    option transport.address-family inet<span class="hljs-symbol">\n</span>    option transport-type tcp<span class="hljs-symbol">\n</span>    subvolumes /data/brick<span class="hljs-symbol">\n</span>end-volume<span class="hljs-symbol">\n</span>"</code></pre>
<ul>
<li>根据xlator获取初构建graph信息，初始化每个xlator的init方法，这个时候glusterfsd初始化成功<h6 id="6-gdb-调试方法"><a href="#6-gdb-调试方法" class="headerlink" title="6. gdb 调试方法"></a>6. gdb 调试方法</h6></li>
<li>gdb break 信息<pre><code class="hljs vim"><span class="hljs-keyword">set</span> <span class="hljs-keyword">print</span> pretty <span class="hljs-keyword">on</span>
//调试子进程,子进程会加载执行mgmt/glusterd/src/glusterd.<span class="hljs-keyword">c</span>:init
<span class="hljs-keyword">set</span> follow-fork-<span class="hljs-keyword">mode</span> child  
<span class="hljs-keyword">set</span> detach-<span class="hljs-keyword">on</span>-fork off
<span class="hljs-keyword">br</span> glusterfsd.<span class="hljs-keyword">c</span>:main
<span class="hljs-keyword">br</span>  <span class="hljs-keyword">br</span> glusterfs_volumes_init   //glusterd和glusterfsd都会调用该方法
<span class="hljs-keyword">br</span> glusterd.<span class="hljs-keyword">c</span>:init
//------ 进入init函数后执行如下------
/* 进入这个函数后设置调试父进程   
  <span class="hljs-keyword">set</span> follow-fork-<span class="hljs-keyword">mode</span> parent
  <span class="hljs-keyword">set</span> detach-<span class="hljs-keyword">on</span>-fork <span class="hljs-keyword">on</span>
 */
<span class="hljs-keyword">br</span> glusterd_spawn_daemons
<span class="hljs-keyword">br</span> glusterd_restart_bricks
<span class="hljs-keyword">br</span> glusterd_brick_start
<span class="hljs-keyword">br</span> glusterd_volume_start_glusterfs
/* 进入这个函数后设置调试父进程   
  <span class="hljs-keyword">set</span> follow-fork-<span class="hljs-keyword">mode</span> child
  <span class="hljs-keyword">set</span> detach-<span class="hljs-keyword">on</span>-fork <span class="hljs-keyword">on</span>
 */
<span class="hljs-keyword">br</span> runner_run
<span class="hljs-keyword">br</span> runner_log

<span class="hljs-keyword">br</span> runner_start 

/** 进入runner_start 后设置如下断点，glusterfsd启动以后会按照如下的调用链进行 */
<span class="hljs-keyword">br</span> glusterfs_volumes_init   
<span class="hljs-keyword">br</span> glusterfs_listener_init  //glusterd不会调用该方法
<span class="hljs-keyword">br</span> glusterfs_mgmt_init      //glusterd不会调用该方法
<span class="hljs-keyword">br</span> mgmt_rpc_notify
<span class="hljs-keyword">br</span> glusterfs_volfile_fetch
<span class="hljs-keyword">br</span> glusterfs_volfile_fetch_one
<span class="hljs-keyword">br</span> mgmt_getspec_cbk 
<span class="hljs-keyword">br</span> glusterfs_process_volfp
<span class="hljs-keyword">br</span> glusterfs_graph_activate
<span class="hljs-keyword">br</span> glusterfs_graph_init</code></pre></li>
<li>1.glusterd gdb日志<pre><code class="hljs angelscript">[<span class="hljs-symbol">root@</span>b94a78ebfc80 ~]$ gdb glusterd
GNU gdb (GDB) Red Hat Enterprise Linux <span class="hljs-number">7.6</span><span class="hljs-number">.1</span><span class="hljs-number">-115.</span>el7
Copyright (C) <span class="hljs-number">2013</span> Free Software Foundation, Inc.
License GPLv3+: GNU GPL version <span class="hljs-number">3</span> <span class="hljs-keyword">or</span> later &lt;http:<span class="hljs-comment">//gnu.org/licenses/gpl.html&gt;</span>
This <span class="hljs-keyword">is</span> free software: you are free to change <span class="hljs-keyword">and</span> redistribute it.
There <span class="hljs-keyword">is</span> NO WARRANTY, to the extent permitted by law.  Type <span class="hljs-string">"show copying"</span>
<span class="hljs-keyword">and</span> <span class="hljs-string">"show warranty"</span> <span class="hljs-keyword">for</span> details.
This GDB was configured as <span class="hljs-string">"x86_64-redhat-linux-gnu"</span>.
For bug reporting instructions, please see:
&lt;http:<span class="hljs-comment">//www.gnu.org/software/gdb/bugs/&gt;...</span>
Reading symbols <span class="hljs-keyword">from</span> /usr/local/sbin/glusterfsd...done.
(gdb) br glusterfsd.c:main
Breakpoint <span class="hljs-number">1</span> at <span class="hljs-number">0x40b71d</span>: file glusterfsd.c, line <span class="hljs-number">2746.</span>
(gdb) br glusterd.c:init
No source file named glusterd.c.
Make breakpoint pending on future <span class="hljs-keyword">shared</span> library load? (y <span class="hljs-keyword">or</span> [n]) y
Breakpoint <span class="hljs-number">2</span> (glusterd.c:init) pending.
(gdb) <span class="hljs-keyword">set</span> print pretty on
(gdb) <span class="hljs-keyword">set</span> follow-fork-mode child  
(gdb) <span class="hljs-keyword">set</span> detach-on-fork off
(gdb) c
The program <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> being run.
(gdb) r
Starting program: /usr/local/sbin/glusterd 
[Thread debugging using libthread_db enabled]
Using host libthread_db library <span class="hljs-string">"/lib64/libthread_db.so.1"</span>.

Breakpoint <span class="hljs-number">1</span>, main (argc=<span class="hljs-number">1</span>, argv=<span class="hljs-number">0x7fffffffe778</span>) at glusterfsd.c:<span class="hljs-number">2746</span>
<span class="hljs-number">2746</span>        glusterfs_ctx_t *ctx = NULL;
Missing separate debuginfos, use: debuginfo-install glibc<span class="hljs-number">-2.17</span><span class="hljs-number">-292.</span>el7.x86_64 libuuid<span class="hljs-number">-2.23</span><span class="hljs-number">.2</span><span class="hljs-number">-61.</span>el7_7<span class="hljs-number">.1</span>.x86_64 openssl-libs<span class="hljs-number">-1.0</span><span class="hljs-number">.2</span>k<span class="hljs-number">-19.</span>el7.x86_64 zlib<span class="hljs-number">-1.2</span><span class="hljs-number">.7</span><span class="hljs-number">-18.</span>el7.x86_64
(gdb) c
Continuing.
[New process <span class="hljs-number">956</span>]
[Thread debugging using libthread_db enabled]
Using host libthread_db library <span class="hljs-string">"/lib64/libthread_db.so.1"</span>.
[New Thread <span class="hljs-number">0x7ffff5431700</span> (LWP <span class="hljs-number">957</span>)]
[New Thread <span class="hljs-number">0x7ffff4c30700</span> (LWP <span class="hljs-number">958</span>)]
[New Thread <span class="hljs-number">0x7ffff442f700</span> (LWP <span class="hljs-number">959</span>)]
[New Thread <span class="hljs-number">0x7ffff3c2e700</span> (LWP <span class="hljs-number">960</span>)]
[New Thread <span class="hljs-number">0x7ffff342d700</span> (LWP <span class="hljs-number">961</span>)]
[New Thread <span class="hljs-number">0x7ffff2c2c700</span> (LWP <span class="hljs-number">962</span>)]
Reading symbols <span class="hljs-keyword">from</span> /usr/local/lib/glusterfs<span class="hljs-comment">//xlator/mgmt/glusterd.so...done.</span>
[Switching to Thread <span class="hljs-number">0x7ffff7fea4c0</span> (LWP <span class="hljs-number">956</span>)]

Breakpoint <span class="hljs-number">2</span>, init (<span class="hljs-keyword">this</span>=<span class="hljs-number">0x686d40</span>) at glusterd.c:<span class="hljs-number">1373</span>
<span class="hljs-number">1373</span>        <span class="hljs-built_in">int</span>32_t ret = <span class="hljs-number">-1</span>;
Missing separate debuginfos, use: debuginfo-install glibc<span class="hljs-number">-2.17</span><span class="hljs-number">-292.</span>el7.x86_64 libuuid<span class="hljs-number">-2.23</span><span class="hljs-number">.2</span><span class="hljs-number">-61.</span>el7_7<span class="hljs-number">.1</span>.x86_64 libxml2<span class="hljs-number">-2.9</span><span class="hljs-number">.1</span><span class="hljs-number">-6.</span>el7_2<span class="hljs-number">.3</span>.x86_64 openssl-libs<span class="hljs-number">-1.0</span><span class="hljs-number">.2</span>k<span class="hljs-number">-19.</span>el7.x86_64 userspace-rcu<span class="hljs-number">-0.7</span><span class="hljs-number">.16</span><span class="hljs-number">-1.</span>el7.x86_64 xz-libs<span class="hljs-number">-5.2</span><span class="hljs-number">.2</span><span class="hljs-number">-1.</span>el7.x86_64 zlib<span class="hljs-number">-1.2</span><span class="hljs-number">.7</span><span class="hljs-number">-18.</span>el7.x86_64
(gdb)  <span class="hljs-keyword">set</span> follow-fork-mode parent
(gdb)   <span class="hljs-keyword">set</span> detach-on-fork on
(gdb) br glusterd_spawn_daemons
Breakpoint <span class="hljs-number">3</span> at <span class="hljs-number">0x7ffff1f79f85</span>: file glusterd-utils.c, line <span class="hljs-number">3619.</span>
(gdb) br glusterd_restart_bricks
Breakpoint <span class="hljs-number">4</span> at <span class="hljs-number">0x7ffff1f832e3</span>: file glusterd-utils.c, line <span class="hljs-number">6334.</span>
(gdb) br glusterd_brick_start
Breakpoint <span class="hljs-number">5</span> at <span class="hljs-number">0x7ffff1f826cd</span>: file glusterd-utils.c, line <span class="hljs-number">6107.</span>
(gdb) br glusterd_volume_start_glusterfs
Breakpoint <span class="hljs-number">6</span> at <span class="hljs-number">0x7ffff1f73f5f</span>: file glusterd-utils.c, line <span class="hljs-number">2024.</span>
(gdb) c
Continuing.
Reading symbols <span class="hljs-keyword">from</span> /usr/local/lib/glusterfs<span class="hljs-comment">//rpc-transport/socket.so...done.</span>
Reading symbols <span class="hljs-keyword">from</span> /usr/local/lib/glusterfs<span class="hljs-comment">//rpc-transport/rdma.so...done.</span>
Detaching after fork <span class="hljs-keyword">from</span> child process <span class="hljs-number">964.</span>
Detaching after fork <span class="hljs-keyword">from</span> child process <span class="hljs-number">965.</span>
Detaching after fork <span class="hljs-keyword">from</span> child process <span class="hljs-number">966.</span>
Detaching after fork <span class="hljs-keyword">from</span> child process <span class="hljs-number">967.</span>
Detaching after fork <span class="hljs-keyword">from</span> child process <span class="hljs-number">968.</span>
Detaching after fork <span class="hljs-keyword">from</span> child process <span class="hljs-number">969.</span>
Detaching after fork <span class="hljs-keyword">from</span> child process <span class="hljs-number">970.</span>
Detaching after fork <span class="hljs-keyword">from</span> child process <span class="hljs-number">971.</span>
Detaching after fork <span class="hljs-keyword">from</span> child process <span class="hljs-number">972.</span>
Detaching after fork <span class="hljs-keyword">from</span> child process <span class="hljs-number">973.</span>
Detaching after fork <span class="hljs-keyword">from</span> child process <span class="hljs-number">974.</span>
Detaching after fork <span class="hljs-keyword">from</span> child process <span class="hljs-number">975.</span>
Detaching after fork <span class="hljs-keyword">from</span> child process <span class="hljs-number">976.</span>
Detaching after fork <span class="hljs-keyword">from</span> child process <span class="hljs-number">977.</span>
Detaching after fork <span class="hljs-keyword">from</span> child process <span class="hljs-number">978.</span>
Detaching after fork <span class="hljs-keyword">from</span> child process <span class="hljs-number">979.</span>
Detaching after fork <span class="hljs-keyword">from</span> child process <span class="hljs-number">980.</span>
Detaching after fork <span class="hljs-keyword">from</span> child process <span class="hljs-number">981.</span>
Detaching after fork <span class="hljs-keyword">from</span> child process <span class="hljs-number">982.</span>
Detaching after fork <span class="hljs-keyword">from</span> child process <span class="hljs-number">983.</span>
Detaching after fork <span class="hljs-keyword">from</span> child process <span class="hljs-number">984.</span>
Detaching after fork <span class="hljs-keyword">from</span> child process <span class="hljs-number">985.</span>
Detaching after fork <span class="hljs-keyword">from</span> child process <span class="hljs-number">986.</span>
Detaching after fork <span class="hljs-keyword">from</span> child process <span class="hljs-number">987.</span>
Detaching after fork <span class="hljs-keyword">from</span> child process <span class="hljs-number">988.</span>
[Switching to Thread <span class="hljs-number">0x7ffff342d700</span> (LWP <span class="hljs-number">961</span>)]

Breakpoint <span class="hljs-number">3</span>, glusterd_spawn_daemons (opaque=<span class="hljs-number">0x0</span>) at glusterd-utils.c:<span class="hljs-number">3619</span>
<span class="hljs-number">3619</span>        glusterd_conf_t *conf = THIS-&gt;<span class="hljs-keyword">private</span>;
Missing separate debuginfos, use: debuginfo-install keyutils-libs<span class="hljs-number">-1.5</span><span class="hljs-number">.8</span><span class="hljs-number">-3.</span>el7.x86_64 krb5-libs<span class="hljs-number">-1.15</span><span class="hljs-number">.1</span><span class="hljs-number">-37.</span>el7_7<span class="hljs-number">.2</span>.x86_64 libcom_err<span class="hljs-number">-1.42</span><span class="hljs-number">.9</span><span class="hljs-number">-16.</span>el7.x86_64 libibverbs<span class="hljs-number">-22.1</span><span class="hljs-number">-3.</span>el7.x86_64 libnl3<span class="hljs-number">-3.2</span><span class="hljs-number">.28</span><span class="hljs-number">-4.</span>el7.x86_64 librdmacm<span class="hljs-number">-22.1</span><span class="hljs-number">-3.</span>el7.x86_64 libselinux<span class="hljs-number">-2.5</span><span class="hljs-number">-14.1</span>.el7.x86_64 pcre<span class="hljs-number">-8.32</span><span class="hljs-number">-17.</span>el7.x86_64
(gdb) n
<span class="hljs-number">3620</span>        <span class="hljs-built_in">int</span> ret = <span class="hljs-number">-1</span>;
(gdb) 
<span class="hljs-number">3622</span>        synclock_lock(&amp;conf-&gt;big_lock);
(gdb) 
[New Thread <span class="hljs-number">0x7fffef606700</span> (LWP <span class="hljs-number">989</span>)]
<span class="hljs-number">3623</span>        glusterd_restart_bricks();
(gdb) 

Breakpoint <span class="hljs-number">4</span>, glusterd_restart_bricks (opaque=<span class="hljs-number">0x7fffef9a9fc8</span>) at glusterd-utils.c:<span class="hljs-number">6334</span>
<span class="hljs-number">6334</span>        <span class="hljs-built_in">int</span> ret = <span class="hljs-number">0</span>;
(gdb) 
<span class="hljs-number">6335</span>        glusterd_volinfo_t *volinfo = NULL;
(gdb) 
<span class="hljs-number">6336</span>        glusterd_brickinfo_t *brickinfo = NULL;
(gdb)   <span class="hljs-keyword">set</span> follow-fork-mode child
(gdb)   <span class="hljs-keyword">set</span> detach-on-fork on
(gdb) br runner_run
Breakpoint <span class="hljs-number">7</span> at <span class="hljs-number">0x7ffff7b35f04</span>: runner_run. (<span class="hljs-number">2</span> locations)
(gdb) br runner_start
Breakpoint <span class="hljs-number">8</span> at <span class="hljs-number">0x7ffff7b35825</span>: runner_start. (<span class="hljs-number">2</span> locations)
(gdb) info <span class="hljs-keyword">break</span>
Num     Type           Disp Enb Address            What
<span class="hljs-number">1</span>       breakpoint     keep y   &lt;MULTIPLE&gt;         
        breakpoint already hit <span class="hljs-number">1</span> time
<span class="hljs-number">1.1</span>                         y     <span class="hljs-number">0x000000000040b71d</span> <span class="hljs-keyword">in</span> main at glusterfsd.c:<span class="hljs-number">2746</span> inf <span class="hljs-number">1</span>
<span class="hljs-number">1.2</span>                         y     <span class="hljs-number">0x000000000040b71d</span> <span class="hljs-keyword">in</span> main at glusterfsd.c:<span class="hljs-number">2746</span> inf <span class="hljs-number">2</span>
<span class="hljs-number">2</span>       breakpoint     keep y   <span class="hljs-number">0x00007ffff1f3a7ee</span> <span class="hljs-keyword">in</span> init at glusterd.c:<span class="hljs-number">1373</span> inf <span class="hljs-number">2</span>
        breakpoint already hit <span class="hljs-number">1</span> time
<span class="hljs-number">3</span>       breakpoint     keep y   <span class="hljs-number">0x00007ffff1f79f85</span> <span class="hljs-keyword">in</span> glusterd_spawn_daemons at glusterd-utils.c:<span class="hljs-number">3619</span> inf <span class="hljs-number">2</span>
        breakpoint already hit <span class="hljs-number">1</span> time
<span class="hljs-number">4</span>       breakpoint     keep y   <span class="hljs-number">0x00007ffff1f832e3</span> <span class="hljs-keyword">in</span> glusterd_restart_bricks at glusterd-utils.c:<span class="hljs-number">6334</span> inf <span class="hljs-number">2</span>
        breakpoint already hit <span class="hljs-number">1</span> time
<span class="hljs-number">5</span>       breakpoint     keep y   <span class="hljs-number">0x00007ffff1f826cd</span> <span class="hljs-keyword">in</span> glusterd_brick_start at glusterd-utils.c:<span class="hljs-number">6107</span> inf <span class="hljs-number">2</span>
<span class="hljs-number">6</span>       breakpoint     keep y   <span class="hljs-number">0x00007ffff1f73f5f</span> <span class="hljs-keyword">in</span> glusterd_volume_start_glusterfs at glusterd-utils.c:<span class="hljs-number">2024</span> inf <span class="hljs-number">2</span>
<span class="hljs-number">7</span>       breakpoint     keep y   &lt;MULTIPLE&gt;         
<span class="hljs-number">7.1</span>                         y     <span class="hljs-number">0x00007ffff7b35f04</span> <span class="hljs-keyword">in</span> runner_run at run.c:<span class="hljs-number">430</span> inf <span class="hljs-number">1</span>
<span class="hljs-number">7.2</span>                         y     <span class="hljs-number">0x00007ffff7b35f04</span> <span class="hljs-keyword">in</span> runner_run at run.c:<span class="hljs-number">430</span> inf <span class="hljs-number">2</span>
<span class="hljs-number">8</span>       breakpoint     keep y   &lt;MULTIPLE&gt;         
<span class="hljs-number">8.1</span>                         y     <span class="hljs-number">0x00007ffff7b35825</span> <span class="hljs-keyword">in</span> runner_start at run.c:<span class="hljs-number">259</span> inf <span class="hljs-number">1</span>
<span class="hljs-number">8.2</span>                         y     <span class="hljs-number">0x00007ffff7b35825</span> <span class="hljs-keyword">in</span> runner_start at run.c:<span class="hljs-number">259</span> inf <span class="hljs-number">2</span>
(gdb) c
Continuing.

Breakpoint <span class="hljs-number">5</span>, glusterd_brick_start (volinfo=<span class="hljs-number">0x6db4b0</span>, brickinfo=<span class="hljs-number">0x6ef490</span>, wait=<span class="hljs-literal">false</span>, only_connect=<span class="hljs-literal">false</span>) at glusterd-utils.c:<span class="hljs-number">6107</span>
<span class="hljs-number">6107</span>        <span class="hljs-built_in">int</span> ret = <span class="hljs-number">-1</span>;
(gdb) c
Continuing.
[New Thread <span class="hljs-number">0x7fffeee05700</span> (LWP <span class="hljs-number">991</span>)]

Breakpoint <span class="hljs-number">6</span>, glusterd_volume_start_glusterfs (volinfo=<span class="hljs-number">0x6db4b0</span>, brickinfo=<span class="hljs-number">0x6ef490</span>, wait=<span class="hljs-literal">false</span>) at glusterd-utils.c:<span class="hljs-number">2024</span>
<span class="hljs-number">2024</span>        <span class="hljs-built_in">int</span>32_t ret = <span class="hljs-number">-1</span>;
(gdb) c
Continuing.
[New process <span class="hljs-number">992</span>]
[Thread debugging using libthread_db enabled]
Using host libthread_db library <span class="hljs-string">"/lib64/libthread_db.so.1"</span>.
[Switching to Thread <span class="hljs-number">0x7ffff342d700</span> (LWP <span class="hljs-number">992</span>)]

Breakpoint <span class="hljs-number">8</span>, runner_start (runner=<span class="hljs-number">0x7fffef800e00</span>) at run.c:<span class="hljs-number">259</span>
<span class="hljs-number">259</span>         <span class="hljs-built_in">int</span> pi[<span class="hljs-number">3</span>][<span class="hljs-number">2</span>] = &#123;&#123;<span class="hljs-number">-1</span>, <span class="hljs-number">-1</span>&#125;, &#123;<span class="hljs-number">-1</span>, <span class="hljs-number">-1</span>&#125;, &#123;<span class="hljs-number">-1</span>, <span class="hljs-number">-1</span>&#125;&#125;;
(gdb) n
<span class="hljs-number">261</span>         <span class="hljs-built_in">int</span> ret = <span class="hljs-number">0</span>;
(gdb) 
<span class="hljs-number">262</span>         <span class="hljs-built_in">int</span> errno_priv = <span class="hljs-number">0</span>;
(gdb) 
<span class="hljs-number">263</span>         <span class="hljs-built_in">int</span> i = <span class="hljs-number">0</span>;
(gdb) 
<span class="hljs-number">266</span>         <span class="hljs-keyword">if</span> (runner-&gt;runerr || !runner-&gt;argv) &#123;
(gdb) 
<span class="hljs-number">271</span>         GF_ASSERT(runner-&gt;argv[<span class="hljs-number">0</span>]);
(gdb)  <span class="hljs-keyword">set</span> follow-fork-mode child
(gdb)   <span class="hljs-keyword">set</span> detach-on-fork on
(gdb) n
<span class="hljs-number">276</span>         ret = pipe(xpi);
(gdb) 
<span class="hljs-number">277</span>         <span class="hljs-keyword">if</span> (ret != <span class="hljs-number">-1</span>)
(gdb) 
<span class="hljs-number">278</span>             ret = fcntl(xpi[<span class="hljs-number">1</span>], F_SETFD, FD_CLOEXEC);
(gdb) 
<span class="hljs-number">280</span>         <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">3</span>; i++) &#123;
(gdb) 
<span class="hljs-number">281</span>             <span class="hljs-keyword">if</span> (runner-&gt;chfd[i] != <span class="hljs-number">-2</span>)
(gdb) 
<span class="hljs-number">282</span>                 <span class="hljs-keyword">continue</span>;
(gdb) 
<span class="hljs-number">280</span>         <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">3</span>; i++) &#123;
(gdb) 
<span class="hljs-number">281</span>             <span class="hljs-keyword">if</span> (runner-&gt;chfd[i] != <span class="hljs-number">-2</span>)
(gdb) 
<span class="hljs-number">282</span>                 <span class="hljs-keyword">continue</span>;
(gdb) 
<span class="hljs-number">280</span>         <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">3</span>; i++) &#123;
(gdb) 
<span class="hljs-number">281</span>             <span class="hljs-keyword">if</span> (runner-&gt;chfd[i] != <span class="hljs-number">-2</span>)
(gdb) 
<span class="hljs-number">282</span>                 <span class="hljs-keyword">continue</span>;
(gdb) 
<span class="hljs-number">280</span>         <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">3</span>; i++) &#123;
(gdb) 
<span class="hljs-number">291</span>         <span class="hljs-keyword">if</span> (ret != <span class="hljs-number">-1</span>)
(gdb) 
<span class="hljs-number">292</span>             runner-&gt;chpid = fork();
(gdb) 
[New process <span class="hljs-number">995</span>]
[Thread debugging using libthread_db enabled]
Using host libthread_db library <span class="hljs-string">"/lib64/libthread_db.so.1"</span>.
[Switching to Thread <span class="hljs-number">0x7ffff342d700</span> (LWP <span class="hljs-number">995</span>)]
<span class="hljs-number">293</span>         <span class="hljs-keyword">switch</span> (runner-&gt;chpid) &#123;
<span class="hljs-number">327</span>                 <span class="hljs-keyword">if</span> (ret != <span class="hljs-number">-1</span>) &#123;
(gdb) 
<span class="hljs-number">328</span>                     <span class="hljs-built_in">int</span> fdv[<span class="hljs-number">4</span>] = &#123;<span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">2</span>, xpi[<span class="hljs-number">1</span>]&#125;;
(gdb) 
<span class="hljs-number">330</span>                     ret = close_fds_except(fdv, sizeof(fdv) / sizeof(*fdv));
(gdb) 
<span class="hljs-number">333</span>                 <span class="hljs-keyword">if</span> (ret != <span class="hljs-number">-1</span>) &#123;
(gdb) 
<span class="hljs-number">335</span>                     sigemptyset(&amp;<span class="hljs-keyword">set</span>);
(gdb) 
<span class="hljs-number">336</span>                     sigprocmask(SIG_SETMASK, &amp;<span class="hljs-keyword">set</span>, NULL);
(gdb) 
<span class="hljs-number">338</span>                     execvp(runner-&gt;argv[<span class="hljs-number">0</span>], runner-&gt;argv);
(gdb) p runner-&gt;argv[<span class="hljs-number">0</span>]
$<span class="hljs-number">1</span> = <span class="hljs-number">0x7fffe8000c60</span> <span class="hljs-string">"/usr/local/sbin/glusterfsd"</span>
(gdb) p runner-&gt;argv
$<span class="hljs-number">2</span> = (char **) <span class="hljs-number">0x7fffe8000970</span>
(gdb) p/s  runner-&gt;argv
$<span class="hljs-number">3</span> = (char **) <span class="hljs-number">0x7fffe8000970</span>
(gdb) p/s  runner-&gt;argv[<span class="hljs-number">1</span>]
$<span class="hljs-number">4</span> = <span class="hljs-number">0x7fffe8000ce0</span> <span class="hljs-string">"-s"</span>
(gdb) p/s  runner-&gt;argv[<span class="hljs-number">2</span>]
$<span class="hljs-number">5</span> = <span class="hljs-number">0x7fffe8000d50</span> <span class="hljs-string">"172.17.0.2"</span>
(gdb) p/s  runner-&gt;argv[<span class="hljs-number">3</span>]
$<span class="hljs-number">6</span> = <span class="hljs-number">0x7fffe8000dc0</span> <span class="hljs-string">"--volfile-id"</span>
(gdb) p/s  runner-&gt;argv[<span class="hljs-number">4</span>]
$<span class="hljs-number">7</span> = <span class="hljs-number">0x7fffe8000e30</span> <span class="hljs-string">"dht_vol.172.17.0.2.data-brick"</span>
(gdb) p/s  runner-&gt;argv[<span class="hljs-number">5</span>]
$<span class="hljs-number">8</span> = <span class="hljs-number">0x7fffe8000eb0</span> <span class="hljs-string">"-p"</span>
(gdb) p/s  runner-&gt;argv[<span class="hljs-number">6</span>]
$<span class="hljs-number">9</span> = <span class="hljs-number">0x7fffe8000f20</span> <span class="hljs-string">"/var/run/gluster/vols/dht_vol/172.17.0.2-data-brick.pid"</span>
(gdb) p/s  runner-&gt;argv[<span class="hljs-number">7</span>]
$<span class="hljs-number">10</span> = <span class="hljs-number">0x7fffe8000fc0</span> <span class="hljs-string">"-S"</span>
(gdb) p/s  runner-&gt;argv[<span class="hljs-number">8</span>]
$<span class="hljs-number">11</span> = <span class="hljs-number">0x7fffe8001030</span> <span class="hljs-string">"/var/run/gluster/cb954c564295c3be.socket"</span>
(gdb) p/s  runner-&gt;argv[<span class="hljs-number">9</span>]
$<span class="hljs-number">12</span> = <span class="hljs-number">0x7fffe80010c0</span> <span class="hljs-string">"--brick-name"</span>
(gdb) p/s  runner-&gt;argv[<span class="hljs-number">10</span>]
$<span class="hljs-number">13</span> = <span class="hljs-number">0x7fffe8001130</span> <span class="hljs-string">"/data/brick"</span>
(gdb) p/s  runner-&gt;argv[<span class="hljs-number">11</span>]
$<span class="hljs-number">14</span> = <span class="hljs-number">0x7fffe80011a0</span> <span class="hljs-string">"-l"</span>
(gdb) p/s  runner-&gt;argv[<span class="hljs-number">12</span>]
$<span class="hljs-number">15</span> = <span class="hljs-number">0x7fffe8001210</span> <span class="hljs-string">"/var/log/glusterfs/bricks/data-brick.log"</span>
(gdb) p/s  runner-&gt;argv[<span class="hljs-number">13</span>]
$<span class="hljs-number">16</span> = <span class="hljs-number">0x7fffe80012a0</span> <span class="hljs-string">"--xlator-option"</span>
(gdb) p/s  runner-&gt;argv[<span class="hljs-number">14</span>]
$<span class="hljs-number">17</span> = <span class="hljs-number">0x7fffe8001310</span> <span class="hljs-string">"*-posix.glusterd-uuid=88efffbe-ce9e-4117-8d1a-77de0a8ecd75"</span>
(gdb) p/s  runner-&gt;argv[<span class="hljs-number">15</span>]
$<span class="hljs-number">18</span> = <span class="hljs-number">0x7fffe80013b0</span> <span class="hljs-string">"--process-name"</span>
(gdb) p/s  runner-&gt;argv[<span class="hljs-number">16</span>]
$<span class="hljs-number">19</span> = <span class="hljs-number">0x7fffe8001420</span> <span class="hljs-string">"brick"</span>
(gdb) p/s  runner-&gt;argv[<span class="hljs-number">17</span>]
$<span class="hljs-number">20</span> = <span class="hljs-number">0x7fffe8001490</span> <span class="hljs-string">"--brick-port"</span>
(gdb) p/s  runner-&gt;argv[<span class="hljs-number">18</span>]
$<span class="hljs-number">21</span> = <span class="hljs-number">0x7fffe8001500</span> <span class="hljs-string">"49152"</span>
(gdb) p/s  runner-&gt;argv[<span class="hljs-number">19</span>]
$<span class="hljs-number">22</span> = <span class="hljs-number">0x7fffe8001570</span> <span class="hljs-string">"--xlator-option"</span>
(gdb) p/s  runner-&gt;argv[<span class="hljs-number">20</span>]
$<span class="hljs-number">23</span> = <span class="hljs-number">0x7fffe80015e0</span> <span class="hljs-string">"dht_vol-server.listen-port=49152"</span>
(gdb) p/s  runner-&gt;argv[<span class="hljs-number">21</span>]
$<span class="hljs-number">24</span> = <span class="hljs-number">0x0</span>
(gdb)</code></pre></li>
<li>glusterfsd gdb 日志<pre><code class="hljs angelscript">(gdb) info <span class="hljs-keyword">break</span>
Num     Type           Disp Enb Address            What
<span class="hljs-number">1</span>       breakpoint     keep y   &lt;MULTIPLE&gt;         
        breakpoint already hit <span class="hljs-number">2</span> times
<span class="hljs-number">1.1</span>                         y     <span class="hljs-number">0x000000000040b71d</span> <span class="hljs-keyword">in</span> main at glusterfsd.c:<span class="hljs-number">2746</span> inf <span class="hljs-number">1</span>
<span class="hljs-number">1.2</span>                         y     <span class="hljs-number">0x000000000040b71d</span> <span class="hljs-keyword">in</span> main at glusterfsd.c:<span class="hljs-number">2746</span> inf <span class="hljs-number">5</span>, <span class="hljs-number">4</span>, <span class="hljs-number">3</span>
<span class="hljs-number">2</span>       breakpoint     keep y   &lt;PENDING&gt;          glusterd.c:init inf <span class="hljs-number">5</span>, <span class="hljs-number">4</span>, <span class="hljs-number">3</span>
        breakpoint already hit <span class="hljs-number">1</span> time
<span class="hljs-number">3</span>       breakpoint     keep y   &lt;PENDING&gt;          glusterd_spawn_daemons inf <span class="hljs-number">5</span>, <span class="hljs-number">4</span>, <span class="hljs-number">3</span>
        breakpoint already hit <span class="hljs-number">1</span> time
<span class="hljs-number">4</span>       breakpoint     keep y   &lt;PENDING&gt;          glusterd_restart_bricks inf <span class="hljs-number">5</span>, <span class="hljs-number">4</span>, <span class="hljs-number">3</span>
        breakpoint already hit <span class="hljs-number">1</span> time
<span class="hljs-number">5</span>       breakpoint     keep y   &lt;PENDING&gt;          glusterd_brick_start inf <span class="hljs-number">5</span>, <span class="hljs-number">4</span>, <span class="hljs-number">3</span>
        breakpoint already hit <span class="hljs-number">1</span> time
<span class="hljs-number">6</span>       breakpoint     keep y   &lt;PENDING&gt;          glusterd_volume_start_glusterfs inf <span class="hljs-number">5</span>, <span class="hljs-number">4</span>, <span class="hljs-number">3</span>
        breakpoint already hit <span class="hljs-number">1</span> time
<span class="hljs-number">7</span>       breakpoint     keep y   &lt;MULTIPLE&gt;         
<span class="hljs-number">7.1</span>                         y     <span class="hljs-number">0x00007ffff7b35f04</span> <span class="hljs-keyword">in</span> runner_run at run.c:<span class="hljs-number">430</span> inf <span class="hljs-number">1</span>
<span class="hljs-number">7.2</span>                         y     <span class="hljs-number">0x00007ffff7b35f04</span> <span class="hljs-keyword">in</span> runner_run at run.c:<span class="hljs-number">430</span> inf <span class="hljs-number">5</span>, <span class="hljs-number">4</span>, <span class="hljs-number">3</span>
<span class="hljs-number">8</span>       breakpoint     keep y   &lt;MULTIPLE&gt;         
        breakpoint already hit <span class="hljs-number">1</span> time
<span class="hljs-number">8.1</span>                         y     <span class="hljs-number">0x00007ffff7b35825</span> <span class="hljs-keyword">in</span> runner_start at run.c:<span class="hljs-number">259</span> inf <span class="hljs-number">1</span>
<span class="hljs-number">8.2</span>                         y     <span class="hljs-number">0x00007ffff7b35825</span> <span class="hljs-keyword">in</span> runner_start at run.c:<span class="hljs-number">259</span> inf <span class="hljs-number">5</span>, <span class="hljs-number">4</span>, <span class="hljs-number">3</span>
<span class="hljs-number">9</span>       breakpoint     keep y   &lt;PENDING&gt;          server-rpc-fops_v2.c:server4_0_mkdir
<span class="hljs-number">10</span>      breakpoint     keep y   &lt;PENDING&gt;          server-resolve.c:server_resolve
<span class="hljs-number">11</span>      breakpoint     keep y   &lt;MULTIPLE&gt;         
        breakpoint already hit <span class="hljs-number">1</span> time
<span class="hljs-number">11.1</span>                        y     <span class="hljs-number">0x000000000040b603</span> <span class="hljs-keyword">in</span> glusterfs_volumes_init at glusterfsd.c:<span class="hljs-number">2704</span> inf <span class="hljs-number">1</span>
<span class="hljs-number">11.2</span>                        y     <span class="hljs-number">0x000000000040b603</span> <span class="hljs-keyword">in</span> glusterfs_volumes_init at glusterfsd.c:<span class="hljs-number">2704</span> inf <span class="hljs-number">5</span>, <span class="hljs-number">4</span>, <span class="hljs-number">3</span>
<span class="hljs-number">12</span>      breakpoint     keep y   &lt;MULTIPLE&gt;         
<span class="hljs-number">12.1</span>                        y     <span class="hljs-number">0x000000000040b390</span> <span class="hljs-keyword">in</span> glusterfs_process_volfp at glusterfsd.c:<span class="hljs-number">2626</span> inf <span class="hljs-number">1</span>
<span class="hljs-number">12.2</span>                        y     <span class="hljs-number">0x000000000040b390</span> <span class="hljs-keyword">in</span> glusterfs_process_volfp at glusterfsd.c:<span class="hljs-number">2626</span> inf <span class="hljs-number">5</span>, <span class="hljs-number">4</span>, <span class="hljs-number">3</span>
<span class="hljs-number">13</span>      breakpoint     keep y   &lt;MULTIPLE&gt;         
<span class="hljs-number">13.1</span>                        y     <span class="hljs-number">0x000000000040710f</span> <span class="hljs-keyword">in</span> get_volfp at glusterfsd.c:<span class="hljs-number">781</span> inf <span class="hljs-number">1</span>
<span class="hljs-number">13.2</span>                        y     <span class="hljs-number">0x000000000040710f</span> <span class="hljs-keyword">in</span> get_volfp at glusterfsd.c:<span class="hljs-number">781</span> inf <span class="hljs-number">5</span>, <span class="hljs-number">4</span>, <span class="hljs-number">3</span>
<span class="hljs-number">14</span>      breakpoint     keep y   &lt;MULTIPLE&gt;         
        breakpoint already hit <span class="hljs-number">1</span> time
<span class="hljs-number">14.1</span>                        y     <span class="hljs-number">0x0000000000412581</span> <span class="hljs-keyword">in</span> glusterfs_mgmt_init at glusterfsd-mgmt.c:<span class="hljs-number">2648</span> inf <span class="hljs-number">1</span>
<span class="hljs-number">14.2</span>                        y     <span class="hljs-number">0x0000000000412581</span> <span class="hljs-keyword">in</span> glusterfs_mgmt_init at glusterfsd-mgmt.c:<span class="hljs-number">2648</span> inf <span class="hljs-number">5</span>, <span class="hljs-number">4</span>, <span class="hljs-number">3</span>
<span class="hljs-number">15</span>      breakpoint     keep y   &lt;MULTIPLE&gt;         
        breakpoint already hit <span class="hljs-number">1</span> time
---Type &lt;<span class="hljs-keyword">return</span>&gt; to <span class="hljs-keyword">continue</span>, <span class="hljs-keyword">or</span> q &lt;<span class="hljs-keyword">return</span>&gt; to quit---
<span class="hljs-number">15.1</span>                        y     <span class="hljs-number">0x0000000000411848</span> <span class="hljs-keyword">in</span> glusterfs_volfile_fetch at glusterfsd-mgmt.c:<span class="hljs-number">2270</span> inf <span class="hljs-number">1</span>
<span class="hljs-number">15.2</span>                        y     <span class="hljs-number">0x0000000000411848</span> <span class="hljs-keyword">in</span> glusterfs_volfile_fetch at glusterfsd-mgmt.c:<span class="hljs-number">2270</span> inf <span class="hljs-number">5</span>, <span class="hljs-number">4</span>, <span class="hljs-number">3</span>
<span class="hljs-number">16</span>      breakpoint     keep y   &lt;MULTIPLE&gt;         
        breakpoint already hit <span class="hljs-number">1</span> time
<span class="hljs-number">16.1</span>                        y     <span class="hljs-number">0x00000000004114ed</span> <span class="hljs-keyword">in</span> glusterfs_volfile_fetch_one at glusterfsd-mgmt.c:<span class="hljs-number">2166</span> inf <span class="hljs-number">1</span>
<span class="hljs-number">16.2</span>                        y     <span class="hljs-number">0x00000000004114ed</span> <span class="hljs-keyword">in</span> glusterfs_volfile_fetch_one at glusterfsd-mgmt.c:<span class="hljs-number">2166</span> inf <span class="hljs-number">5</span>, <span class="hljs-number">4</span>, <span class="hljs-number">3</span>
<span class="hljs-number">17</span>      breakpoint     keep y   &lt;MULTIPLE&gt;         
        breakpoint already hit <span class="hljs-number">1</span> time
<span class="hljs-number">17.1</span>                        y     <span class="hljs-number">0x0000000000410a85</span> <span class="hljs-keyword">in</span> mgmt_getspec_cbk at glusterfsd-mgmt.c:<span class="hljs-number">1922</span> inf <span class="hljs-number">1</span>
<span class="hljs-number">17.2</span>                        y     <span class="hljs-number">0x0000000000410a85</span> <span class="hljs-keyword">in</span> mgmt_getspec_cbk at glusterfsd-mgmt.c:<span class="hljs-number">1922</span> inf <span class="hljs-number">5</span>, <span class="hljs-number">4</span>, <span class="hljs-number">3</span>
<span class="hljs-number">18</span>      breakpoint     keep y   &lt;MULTIPLE&gt;         
<span class="hljs-number">18.1</span>                        y     <span class="hljs-number">0x000000000040b390</span> <span class="hljs-keyword">in</span> glusterfs_process_volfp at glusterfsd.c:<span class="hljs-number">2626</span> inf <span class="hljs-number">1</span>
<span class="hljs-number">18.2</span>                        y     <span class="hljs-number">0x000000000040b390</span> <span class="hljs-keyword">in</span> glusterfs_process_volfp at glusterfsd.c:<span class="hljs-number">2626</span> inf <span class="hljs-number">5</span>, <span class="hljs-number">4</span>, <span class="hljs-number">3</span>
(gdb)</code></pre>
</li>
</ul>

            </article>
            <hr>
            <div>
              <div class="post-metas mb-3">
                
                
              </div>
              
                <p class="note note-warning">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-sa/4.0/deed.zh" target="_blank" rel="nofollow noopener noopener">CC BY-SA 4.0 协议</a> ，转载请注明出处！</p>
              
              
                <div class="post-prevnext row">
                  <div class="post-prev col-6">
                    
                    
                      <a href="/2020/04/16/fork%E4%B9%8B%E5%89%8D%E7%9A%84%E7%BC%93%E5%86%B2%E5%8C%BA%E9%97%AE%E9%A2%98/">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">fork之前的缓冲区问题</span>
                        <span class="visible-mobile">上一篇</span>
                      </a>
                    
                  </div>
                  <div class="post-next col-6">
                    
                    
                      <a href="/2020/04/15/global-threading%E5%90%8E%E5%AF%BC%E8%87%B4mount%E5%AE%A2%E6%88%B7%E7%AB%AFcrash/">
                        <span class="hidden-mobile">global-threading后导致mount客户端crash</span>
                        <span class="visible-mobile">下一篇</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </div>
                </div>
              
            </div>

            
          </div>
        </div>
      </div>
    </div>
    
      <div class="d-none d-lg-block col-lg-2 toc-container" id="toc-ctn">
        <div id="toc">
  <p class="toc-header"><i class="iconfont icon-list"></i>&nbsp;目录</p>
  <div id="tocbot"></div>
</div>

      </div>
    
  </div>
</div>

<!-- Custom -->


    
  </main>

  
    <a id="scroll-top-button" href="#" role="button">
      <i class="iconfont icon-arrowup" aria-hidden="true"></i>
    </a>
  

  
    <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v"
                 for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>
  

  

  

  <footer class="mt-5">
  <div class="text-center py-3">
    <div>
      <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a>
      <i class="iconfont icon-love"></i>
      <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener">
        <span>Fluid</span></a>
    </div>
    
  <div class="statistics">
    
    

    
      
        <!-- 不蒜子统计PV -->
        <span id="busuanzi_container_site_pv" style="display: none">
            总访问量 
            <span id="busuanzi_value_site_pv"></span>
             次
          </span>
      
      
        <!-- 不蒜子统计UV -->
        <span id="busuanzi_container_site_uv" style="display: none">
            总访客数 
            <span id="busuanzi_value_site_uv"></span>
             人
          </span>
      
    
  </div>


    

    
  </div>
</footer>

<!-- SCRIPTS -->
<script  src="https://cdn.staticfile.org/jquery/3.4.1/jquery.min.js" ></script>
<script  src="https://cdn.staticfile.org/twitter-bootstrap/4.4.1/js/bootstrap.min.js" ></script>
<script  src="/js/debouncer.js" ></script>
<script  src="/js/main.js" ></script>

<!-- Plugins -->


  
    <script  src="/js/lazyload.js" ></script>
  



  <script defer src="https://cdn.staticfile.org/clipboard.js/2.0.6/clipboard.min.js" ></script>
  <script  src="/js/clipboard-use.js" ></script>



  <script defer src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" ></script>





  <script  src="https://cdn.staticfile.org/tocbot/4.11.1/tocbot.min.js" ></script>
  <script>
    $(document).ready(function () {
      var boardCtn = $('#board-ctn');
      var boardTop = boardCtn.offset().top;

      tocbot.init({
        tocSelector: '#tocbot',
        contentSelector: 'article.markdown-body',
        headingSelector: 'h1,h2,h3,h4,h5,h6',
        linkClass: 'tocbot-link',
        activeLinkClass: 'tocbot-active-link',
        listClass: 'tocbot-list',
        isCollapsedClass: 'tocbot-is-collapsed',
        collapsibleClass: 'tocbot-is-collapsible',
        collapseDepth: 0,
        scrollSmooth: true,
        headingsOffset: -boardTop
      });
      if ($('.toc-list-item').length > 0) {
        $('#toc').css('visibility', 'visible');
      }
    });
  </script>



  <script  src="https://cdn.staticfile.org/typed.js/2.0.11/typed.min.js" ></script>
  <script>
    var typed = new Typed('#subtitle', {
      strings: [
        '  ',
        "glusterfsd启动过程&nbsp;",
      ],
      cursorChar: "_",
      typeSpeed: 70,
      loop: false,
    });
    typed.stop();
    $(document).ready(function () {
      $(".typed-cursor").addClass("h2");
      typed.start();
    });
  </script>



  <script  src="https://cdn.staticfile.org/anchor-js/4.2.2/anchor.min.js" ></script>
  <script>
    anchors.options = {
      placement: "right",
      visible: "hover",
      
    };
    var el = "h1,h2,h3,h4,h5,h6".split(",");
    var res = [];
    for (item of el) {
      res.push(".markdown-body > " + item)
    }
    anchors.add(res.join(", "))
  </script>



  <script  src="/js/local-search.js" ></script>
  <script>
    var path = "/local-search.xml";
    var inputArea = document.querySelector("#local-search-input");
    inputArea.onclick = function () {
      searchFunc(path, 'local-search-input', 'local-search-result');
      this.onclick = null
    }
  </script>



  <script  src="https://cdn.staticfile.org/fancybox/3.5.7/jquery.fancybox.min.js" ></script>
  <link  rel="stylesheet" href="https://cdn.staticfile.org/fancybox/3.5.7/jquery.fancybox.min.css" />

  <script>
    $('#post img:not(.no-zoom img, img[no-zoom]), img[zoom]').each(
      function () {
        var element = document.createElement('a');
        $(element).attr('data-fancybox', 'images');
        $(element).attr('href', $(this).attr('src'));
        $(this).wrap(element);
      }
    );
  </script>




















</body>
</html>
